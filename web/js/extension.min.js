/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.3.5 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, https://github.com/requirejs/requirejs/blob/master/LICENSE
 */

!function(){var requirejs,require,define;!function(global,setTimeout){function commentReplace(e,t){return t||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1&&(!e[n]||!t(e[n],n,e));n-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,r){return t&&eachProp(t,function(t,i){!n&&hasProp(e,i)||(!r||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[i]=t:(e[i]||(e[i]={}),mixin(e[i],t,n,r)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,r){var i=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return i.requireType=e,i.requireModules=r,n&&(i.originalError=n),i}function newContext(e){function t(e){var t,n;for(t=0;t<e.length;t++)if("."===(n=e[t]))e.splice(t,1),t-=1;else if(".."===n){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function n(e,n,r){var i,o,a,s,u,c,f,l,d,h,p,m=n&&n.split("/"),v=w.map,g=v&&v["*"];if(e&&(e=e.split("/"),c=e.length-1,w.nodeIdCompat&&jsSuffixRegExp.test(e[c])&&(e[c]=e[c].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&m&&(p=m.slice(0,m.length-1),e=p.concat(e)),t(e),e=e.join("/")),r&&v&&(m||g)){o=e.split("/");e:for(a=o.length;a>0;a-=1){if(u=o.slice(0,a).join("/"),m)for(s=m.length;s>0;s-=1)if((i=getOwn(v,m.slice(0,s).join("/")))&&(i=getOwn(i,u))){f=i,l=a;break e}!d&&g&&getOwn(g,u)&&(d=getOwn(g,u),h=a)}!f&&d&&(f=d,l=h),f&&(o.splice(0,l,f),e=o.join("/"))}return getOwn(w.pkgs,e)||e}function r(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===b.contextName)return t.parentNode.removeChild(t),!0})}function i(e){var t=getOwn(w.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),b.require.undef(e),b.makeRequire(null,{skipMap:!0})([e]),!0}function o(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function a(e,t,r,i){var a,s,u,c,f=null,l=t?t.name:null,d=e,h=!0,p="";return e||(h=!1,e="_@r"+(C+=1)),c=o(e),f=c[0],e=c[1],f&&(f=n(f,l,i),s=getOwn(A,f)),e&&(f?p=r?e:s&&s.normalize?s.normalize(e,function(e){return n(e,l,i)}):-1===e.indexOf("!")?n(e,l,i):e:(p=n(e,l,i),c=o(p),f=c[0],p=c[1],r=!0,a=b.nameToUrl(p))),u=!f||s||r?"":"_unnormalized"+(k+=1),{prefix:f,name:p,parentMap:t,unnormalized:!!u,url:a,originalName:d,isDefine:h,id:(f?f+"!"+p:p)+u}}function s(e){var t=e.id,n=getOwn(I,t);return n||(n=I[t]=new b.Module(e)),n}function u(e,t,n){var r=e.id,i=getOwn(I,r);!hasProp(A,r)||i&&!i.defineEmitComplete?(i=s(e),i.error&&"error"===t?n(i.error):i.on(t,n)):"defined"===t&&n(A[r])}function c(e,t){var n=e.requireModules,r=!1;t?t(e):(each(n,function(t){var n=getOwn(I,t);n&&(n.error=e,n.events.error&&(r=!0,n.emit("error",e)))}),r||req.onError(e))}function f(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(b.defQueueMap[t]=!0),M.push(e)}),globalDefQueue=[])}function l(e){delete I[e],delete x[e]}function d(e,t,n){var r=e.map.id;e.error?e.emit("error",e.error):(t[r]=!0,each(e.depMaps,function(r,i){var o=r.id,a=getOwn(I,o);!a||e.depMatched[i]||n[o]||(getOwn(t,o)?(e.defineDep(i,A[o]),e.check()):d(a,t,n))}),n[r]=!0)}function h(){var e,t,n=1e3*w.waitSeconds,o=n&&b.startTime+n<(new Date).getTime(),a=[],s=[],u=!1,f=!0;if(!y){if(y=!0,eachProp(x,function(e){var n=e.map,c=n.id;if(e.enabled&&(n.isDefine||s.push(e),!e.error))if(!e.inited&&o)i(c)?(t=!0,u=!0):(a.push(c),r(c));else if(!e.inited&&e.fetched&&n.isDefine&&(u=!0,!n.prefix))return f=!1}),o&&a.length)return e=makeError("timeout","Load timeout for modules: "+a,null,a),e.contextName=b.contextName,c(e);f&&each(s,function(e){d(e,{},{})}),o&&!t||!u||!isBrowser&&!isWebWorker||S||(S=setTimeout(function(){S=0,h()},50)),y=!1}}function p(e){hasProp(A,e[0])||s(a(e[0],null,!0)).init(e[1],e[2])}function m(e,t,n,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(n,t,!1)}function v(e){var t=e.currentTarget||e.srcElement;return m(t,b.onScriptLoad,"load","onreadystatechange"),m(t,b.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function g(){var e;for(f();M.length;){if(e=M.shift(),null===e[0])return c(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));p(e)}b.defQueueMap={}}var y,_,b,E,S,w={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},I={},x={},O={},M=[],A={},T={},L={},C=1,k=1;return E={require:function(e){return e.require?e.require:e.require=b.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?A[e.map.id]=e.exports:e.exports=A[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(w.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},_=function(e){this.events=getOwn(O,e.id)||{},this.map=e,this.shim=getOwn(w.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},_.prototype={init:function(e,t,n,r){r=r||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,b.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();b.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;T[e]||(T[e]=!0,b.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id,r=this.depExports,i=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{i=b.execCb(n,o,r,i)}catch(t){e=t}else i=b.execCb(n,o,r,i);if(this.map.isDefine&&void 0===i&&(t=this.module,t?i=t.exports:this.usingExports&&(i=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",c(this.error=e)}else i=o;if(this.exports=i,this.map.isDefine&&!this.ignore&&(A[n]=i,req.onResourceLoad)){var a=[];each(this.depMaps,function(e){a.push(e.normalizedMap||e)}),req.onResourceLoad(b,this.map,a)}l(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(b.defQueueMap,n)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,r=a(e.prefix);this.depMaps.push(r),u(r,"defined",bind(this,function(r){var i,o,f,d=getOwn(L,this.map.id),h=this.map.name,p=this.map.parentMap?this.map.parentMap.name:null,m=b.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(r.normalize&&(h=r.normalize(h,function(e){return n(e,p,!0)})||""),o=a(e.prefix+"!"+h,this.map.parentMap,!0),u(o,"defined",bind(this,function(e){this.map.normalizedMap=o,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),void((f=getOwn(I,o.id))&&(this.depMaps.push(o),this.events.error&&f.on("error",bind(this,function(e){this.emit("error",e)})),f.enable()))):d?(this.map.url=b.nameToUrl(d),void this.load()):(i=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),i.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(I,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&l(e.map.id)}),c(e)}),i.fromText=bind(this,function(n,r){var o=e.name,u=a(o),f=useInteractive;r&&(n=r),f&&(useInteractive=!1),s(u),hasProp(w.config,t)&&(w.config[o]=w.config[t]);try{req.exec(n)}catch(e){return c(makeError("fromtexteval","fromText eval for "+t+" failed: "+e,e,[t]))}f&&(useInteractive=!0),this.depMaps.push(u),b.completeLoad(o),m([o],i)}),void r.load(e.name,m,i,w))})),b.enable(r,this),this.pluginMaps[r.id]=r},enable:function(){x[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,r,i;if("string"==typeof e){if(e=a(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,i=getOwn(E,e.id))return void(this.depExports[t]=i(this));this.depCount+=1,u(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?u(e,"error",bind(this,this.errback)):this.events.error&&u(e,"error",bind(this,function(e){this.emit("error",e)}))}n=e.id,r=I[n],hasProp(E,n)||!r||r.enabled||b.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(I,e.id);t&&!t.enabled&&b.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},b={config:w,contextName:e,registry:I,defined:A,urlFetched:T,defQueue:M,defQueueMap:{},Module:_,makeModuleMap:a,nextTick:req.nextTick,onError:c,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,n){return(-1===n.indexOf("?")?"?":"&")+t}}var n=w.shim,r={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){r[t]?(w[t]||(w[t]={}),mixin(w[t],e,!0,!0)):w[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(L[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=b.makeShimExports(e)),n[t]=e}),w.shim=n),e.packages&&each(e.packages,function(e){var t,n;e="string"==typeof e?{name:e}:e,n=e.name,t=e.location,t&&(w.paths[n]=e.location),w.pkgs[n]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(I,function(e,t){e.inited||e.map.unnormalized||(e.map=a(t,null,!0))}),(e.deps||e.callback)&&b.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,i){function o(n,r,u){var f,l,d;return i.enableBuildCallback&&r&&isFunction(r)&&(r.__requireJsBuild=!0),"string"==typeof n?isFunction(r)?c(makeError("requireargs","Invalid require call"),u):t&&hasProp(E,n)?E[n](I[t.id]):req.get?req.get(b,n,t,o):(l=a(n,t,!1,!0),f=l.id,hasProp(A,f)?A[f]:c(makeError("notloaded",'Module name "'+f+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(g(),b.nextTick(function(){g(),d=s(a(null,t)),d.skipMap=i.skipMap,d.init(n,r,u,{enabled:!0}),h()}),o)}return i=i||{},mixin(o,{isBrowser:isBrowser,toUrl:function(e){var r,i=e.lastIndexOf("."),o=e.split("/")[0],a="."===o||".."===o;return-1!==i&&(!a||i>1)&&(r=e.substring(i,e.length),e=e.substring(0,i)),b.nameToUrl(n(e,t&&t.id,!0),r,!0)},defined:function(e){return hasProp(A,a(e,t,!1,!0).id)},specified:function(e){return e=a(e,t,!1,!0).id,hasProp(A,e)||hasProp(I,e)}}),t||(o.undef=function(e){f();var n=a(e,t,!0),i=getOwn(I,e);i.undefed=!0,r(e),delete A[e],delete T[n.url],delete O[e],eachReverse(M,function(t,n){t[0]===e&&M.splice(n,1)}),delete b.defQueueMap[e],i&&(i.events.defined&&(O[e]=i.events),l(e))}),o},enable:function(e){getOwn(I,e.id)&&s(e).enable()},completeLoad:function(e){var t,n,r,o=getOwn(w.shim,e)||{},a=o.exports;for(f();M.length;){if(n=M.shift(),null===n[0]){if(n[0]=e,t)break;t=!0}else n[0]===e&&(t=!0);p(n)}if(b.defQueueMap={},r=getOwn(I,e),!t&&!hasProp(A,e)&&r&&!r.inited){if(!(!w.enforceDefine||a&&getGlobal(a)))return i(e)?void 0:c(makeError("nodefine","No define call for "+e,null,[e]));p([e,o.deps||[],o.exportsFn])}h()},nameToUrl:function(e,t,n){var r,i,o,a,s,u,c,f=getOwn(w.pkgs,e);if(f&&(e=f),c=getOwn(L,e))return b.nameToUrl(c,t,n);if(req.jsExtRegExp.test(e))s=e+(t||"");else{for(r=w.paths,i=e.split("/"),o=i.length;o>0;o-=1)if(a=i.slice(0,o).join("/"),u=getOwn(r,a)){isArray(u)&&(u=u[0]),i.splice(0,o,u);break}s=i.join("/"),s+=t||(/^data\:|^blob\:|\?/.test(s)||n?"":".js"),s=("/"===s.charAt(0)||s.match(/^[\w\+\.\-]+:/)?"":w.baseUrl)+s}return w.urlArgs&&!/^blob\:/.test(s)?s+w.urlArgs(e,s):s},load:function(e,t){req.load(b,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=v(e);b.completeLoad(t.id)}},onScriptError:function(e){var t=v(e);if(!i(t.id)){var n=[];return eachProp(I,function(e,r){0!==r.indexOf("_@r")&&each(e.depMaps,function(e){if(e.id===t.id)return n.push(r),!0})}),c(makeError("scripterror",'Script error for "'+t.id+(n.length?'", needed by: '+n.join(", "):'"'),e,[t.id]))}}},b.require=b.makeRequire(),b}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.5",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,n,r){var i,o,a=defContextName;return isArray(e)||"string"==typeof e||(o=e,isArray(t)?(e=t,t=n,n=r):e=[]),o&&o.context&&(a=o.context),i=getOwn(contexts,a),i||(i=contexts[a]=req.s.newContext(a)),o&&i.configure(o),i.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick=void 0!==setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],(baseElement=document.getElementsByTagName("base")[0])&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,n){var r=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return r.type=e.scriptType||"text/javascript",r.charset="utf-8",r.async=!0,r},req.load=function(e,t,n){var r,i=e&&e.config||{};if(isBrowser)return r=req.createNode(i,t,n),r.setAttribute("data-requirecontext",e.contextName),r.setAttribute("data-requiremodule",t),!r.attachEvent||r.attachEvent.toString&&r.attachEvent.toString().indexOf("[native code")<0||isOpera?(r.addEventListener("load",e.onScriptLoad,!1),r.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,r.attachEvent("onreadystatechange",e.onScriptLoad)),r.src=n,i.onNodeCreated&&i.onNodeCreated(r,i,t,n),currentlyAddingScript=r,baseElement?head.insertBefore(r,baseElement):head.appendChild(r),currentlyAddingScript=null,r;if(isWebWorker)try{setTimeout(function(){},0),importScripts(n),e.completeLoad(t)}catch(r){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,r,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,n){var r,i;"string"!=typeof e&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(r=currentlyAddingScript||getInteractiveScript())&&(e||(e=r.getAttribute("data-requiremodule")),i=contexts[r.getAttribute("data-requirecontext")]),i?(i.defQueue.push([e,t,n]),i.defQueueMap[e]=!0):globalDefQueue.push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this,"undefined"==typeof setTimeout?void 0:setTimeout),define("requirejs",function(){}),define("ImageServiceAttributesFactory",[],function(){return function(e){var t=this,n=e.attribute,r=e.events,i=e.model;t.create=function(e){return new i(Object.assign({config:{events:r},model:{attribute:n}},e))}}}),define("ImageServiceImageModelFactory",[],function(){return function(e){var t=this,n=e.presetters||[],r=e.host,i=e.config.events;t.statuses={DELETED:"deleted",NEW:"new",CLEAN:"clean",DIRTY:"dirty",EXCLUDE:"exclude"};var o={id:null,service:e.defaults.service,status:t.statuses.NEW,attributes:{},tags:[],options:[],info:{height:null,width:null,size:null,format:null,source:null,created:null}};t.init=function(){r.on(i.PRESETTERREGISTER,function(e,t){n.push(t)})},t.create=function(e){e=e||{};var t=JSON.parse(JSON.stringify(o));return n.forEach(function(e){e.apply(t)}),Object.assign(t,e)},t.init()}}),define("ImageServiceUniqueId",[],function(){return function(e){var t=this;return t.prefix=e,t.generate=function(e){return(t.prefix?t.prefix+"_":"")+String(e).replace(/[^a-z0-9\_\-]+/gi,"")},t}}),define("ImageServiceListItemFactory",["ImageServiceUniqueId"],function(e){return function(t){var n=this,r=t.model,i=t.events,o=t.actions,a=t.preview,s=t.attributes,u=t.dataModel,c=t.definitions.attributes,f=t.service;n.create=function(t){var n=new e(t.prefix);return new r(Object.assign({config:{events:i},factory:{dataModel:u,attributes:s,idGenerator:n},model:{actions:o,preview:a},definitions:c,service:f},t))}}}),define("ImageServiceConnector",[],function(){return function(e){var t=this,n=e.factory.errors;return t.defaults=e.defaults||{},t.serviceName=e.serviceName,t.baseUrl=e.baseUrl,t.imageSave=function(e){var r=e.items,i=e.files,o=e.callback,a=e.warning,s=e.error,u=e.async||!0,c=new FormData,f="";if(i instanceof Object)for(var l in i){if("new"==r[l].status&&!i[l])return s("nofile"),void console.error("[ImageServiceConnector::imageSave] One of the new items does not have a valid file attached");"new"==r[l].status&&(f=t.slugify(i[l].name),r[l].id=f,c.append(f,i[l],i[l].name))}return c.append("items",JSON.stringify(r)),$.ajax({type:"POST",url:t.baseUrl+"/imageprocess",data:c,dataType:"json",contentType:!1,processData:!1,async:u,success:function(e){if(!0!==e.success||!e.messages||!e.messages.length||a(e.messages,e.items))return!1===e.success&&e.messages&&e.messages.length?s(n.create(e.messages[0].code)):!0===e.success&&"function"==typeof o?o(e.items):void 0},error:function(e,t,n){return s(n)}})},t.getImageUrl=function(e){var n={};return n.promise=new Promise(function(e,t){n.resolve=e,n.reject=t}),t.defaults.hasOwnProperty("urls")&&t.defaults.urls.hasOwnProperty(e)?n.resolve(t.defaults.urls[e]):$.ajax({url:t.baseUrl+"/imageurl",data:{imageid:e,width:null,height:null,service:t.serviceName},success:function(e){n.resolve(e.url)}}),n.promise},t.imageFind=function(e){var n={};n.promise=new Promise(function(e,t){n.resolve=e,n.reject=t});var r=Object.assign({service:t.serviceName},e);return $.ajax({url:t.baseUrl+"/imagesearch",data:r,success:function(e){n.resolve(e)},error:function(e){n.reject(e)}}),n.promise},t.slugify=function(e){return e.replace(/[^a-z0-9\_\-]+/gim,"")},t}}),define("ImageServiceUploader",[],function(){return function(e){var t=this,n=e.config.events,r=e.factory.model,i=e.config.labels,o=e.host,a=null,s=null,u=e.maxFileSize||null,c=e.allowedExtensions||["jpg","jpeg","png","gif"];t.init=function(){var e=t.render();o.append(e)},t.validateFile=function(e){return!e||(u&&e.size>u?(a.trigger(n.MESSAGEERROR,"File size too big "+e.size+" File: "+e.name),!1):!(c.indexOf(e.type.replace("image/",""))<0)||(a.trigger(n.MESSAGEERROR,"File type not known "+e.type+" File: "+e.name),!1))},t.processFile=function(e){if(t.validateFile(e)){var i=e.name,a=r.create({id:i,info:{source:null,height:null,width:null,size:e.size,format:e.type}});o.trigger(n.ITEMADDED,{item:a,file:e})}},t.addFieldListener=function(e){e.on("change",function(){for(var e=s[0].files.length,n=0;n<e;n++)t.processFile(s[0].files[n]);$(this).val(null)})},t.addUploadField=function(){s=$('<input name="files[]" type="file" multiple/>'),t.addFieldListener(s),a.append(s)},t.render=function(){return a=$('<span class="btn btn-primary fileinput-button"><i class="fa fa-plus"></i><span> '+i.button.itemUpload+" </span></span>"),t.addUploadField(),$('<div class="imageservice-uploader col-xs-12 col-md-2"></div>').append(a)},this.init()}}),define("ImageServiceSettings",["require"],function(e){return function(e){var t=this,n=e.host,r=[],i=null,o=e.data,a=e.config.events,s=e.config.labels;this.init=function(){var e=$('<div class="col-sm-1 col-xs-12 imageservice-settings-trigger"><button class="btn btn-secondary"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>');i=$('<div class="col-xs-12 imageservice-settings" ><h4>'+s.title+"</h4></div>"),e.on("click",function(e){e.preventDefault(),e.stopPropagation(),$(i).animate({height:"toggle"})}),n.append(e),n.append(i.hide()),n.on(a.SETTINGREGISTER,function(e,n){n.setValues(o[n.getIdentifier()]||{}),t.addComponent(n)})},this.addComponent=function(e){var t=$('<div class="imageservice-settings-component"></div>').append(e.render());r.push(e),i.append(t)},this.getData=function(){var e=[];return r.forEach(function(t){e[t.getIdentifier()]=t.getValues()}),e},this.init()}}),define("ImageServiceFinder",["require"],function(e){return function(e){var t=this,n=e.config.events,r=e.config.labels;return t.host=e.host,t.dataService=e.service,t.container=null,t.select=null,t.containerClass=e.containerClass,t.rowTemplate=function(e){if(e.hasOwnProperty("id")){var t=$('<div class="imageservice-finder-result col-xs-12"></div>'),n=$('<div class="col-xs-3 preview" style="background-image: url('+e.info.source+');"></div>'),r=$('<ul class="col-xs-9" ></ul>');for(var i in e.attributes)r.append($("<li><span>"+e.attributes[i]+"</span></li>"));return t.append(n),t.append(r),t}return e.text},t.repoTemplate=function(e){if(e.hasOwnProperty("text"))return e.text},t.addEventListeners=function(){t.select.select2().on("select2:select",function(e){e.params.data&&t.host.trigger(n.ITEMADDED,{item:jQuery.extend({},e.params.data)})})},t.initScelect2=function(){t.select.select2({width:"100%",placeholder:r.fields.itemFind,allowClear:!0,ajax:{delay:120,data:function(e){return{q:e.term.replace(/(^\s+)|(\s+$)/gim,""),page:e.page}},transport:function(e,n,r){return t.dataService.imageFind(e.data).then(n)},processResults:function(e,t){var n=[];t.page=t.page||1;for(var r in e.items)n.push(e.items[r]);return{results:n,pagination:{more:!1}}},cache:!0},minimumInputLength:1,templateResult:t.rowTemplate,templateSelection:t.repoTemplate})},t.initHTML=function(){t.container=$('<div class="imageservice-finder col-xs-12 col-md-9"></div>'),t.select=$("<select></select>"),t.container.append(t.select),t.addEventListeners(),$(t.host).append(t.container)},t.init=function(){t.initHTML(),t.initScelect2()},t.init(),t}}),define("ImageServiceSettingsInterface",[],function(){return function(e){this.Events=e.config.events,this.host=e.host,this.name="ImageServiceSettings",this.attributes=e.factory.attributes.create({definitions:e.attributes,dataService:e.service,values:e.values,prefix:this.name}),this.getIdentifier=function(){return this.name},this.getValues=function(){return this.attributes.getValues()},this.setValues=function(e){this.attributes.setValues(e)},this.render=function(){},this.registerSetting=function(){this.host.trigger(this.Events.SETTINGREGISTER,this)}}}),define("ImageServicePresets",["ImageServiceSettingsInterface"],function(e){return function(t){var n=this;e.call(this,t);var r=t.config.labels;n.container=null,n.name="defaults",n.attributes={},n.apply=function(e){if(!e.hasOwnProperty("attributes"))return e;var t=n.attributes.getValues();return e.tags=t.tags,delete t.tags,Object.assign(e.attributes,t)},n.render=function(){return n.container&&n.container.remove(),n.container=$('<div class="imageservice-attributes-global"><h5>'+r.title+"</h5><hr/></div>"),n.container.append(n.attributes.render()),n.host.append(n.container),n.container},n.init=function(){n.attributes=t.factory.attributes.create({definitions:t.attributes,dataService:t.service,values:t.values,prefix:n.name}),this.registerSetting(),n.host.trigger(n.Events.PRESETTERREGISTER,n)},n.init()}}),define("ImageServiceMessaging",[],function(){return function(e){var t={};return t.host=e.host,t.messageLife=e.messageLife||15e5,t.container=$('<div class="imageservice-message"></div>'),t.events={error:e.events.error||"imageservice-error",warning:e.events.warning||"imageservice-warning",info:e.events.info||"imageservice-info"},t.init=function(){t.host.prepend(t.container),t.host.on(t.events.error,function(e,n){var r=n;n instanceof Object&&(r=n.error),t.error(r)}),t.host.on(t.events.info,function(e,n){var r=n;n instanceof Object&&(r=n.error),t.info(r)}),t.host.on(t.events.warning,function(e,n){var r=n;n instanceof Object&&(r=n.error),t.warning(r)})},t.remove=function(e){$(e).animate({height:0,opacity:0},500,function(){e.remove()})},t.addListeners=function(e){setTimeout(function(){t.remove(e)},t.messageLife),e.on("click",function(){t.remove(e)})},t.error=function(e){var n=$('<div class="alert alert-danger alert-dismissible"><button type="button" class="close" data-dismiss="alert">×</button>'+e+"</div>");t.addListeners(n),t.container.append(n)},t.info=function(e){var n=$('<div class="alert alert-success alert-dismissible"><button type="button" class="close" data-dismiss="alert">×</button>'+e+"</div>");t.addListeners(n),t.container.append(n)},t.warning=function(e){var n=$('<div class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert">×</button>'+e+"</div>");t.addListeners(n),t.container.append(n)},t.init(),t}}),define("ImageServiceList",[],function(){return function(e){var t=this,n=e.config.events,r=e.factory.listItem,i=e.factory.model;return t.dirty=!1,t.host=e.hostElement,t.imageEntities=[],t.container=null,t.maxItems=e.maxItems||null,t.init=function(){t.reset(e.items.items),t.addListeners()},t.reset=function(e){e=e||[],null!=t.container&&t.container.remove(),t.container=$('<div class="imageservice-list"></div>'),$(t.host).append(t.container),t.imageEntities=[];for(var n=0;n<e.length;n++)t.addItem(e[n]);$.fn.sortable&&t.container.sortable({update:t.onListSorted,cancel:".no-drag"}),t.dirty=!1},t.addListeners=function(){$(t.host).on(n.LISTSAVED,function(e,n){t.reset(n.items)}),$(t.host).on("change",function(e){t.dirty=!0}),$(t.host).on(n.ITEMADDED,function(e,n){if(n.hasOwnProperty("item")){var r=t.addItem(n.item,n.file||null);if(!r)return;var i=r.getOffsets();t.container.animate({scrollTop:i.top},500),t.dirty=!0}}),$(t.host).on(n.ITEMDELETED,function(e,n){t.dirty=!0,n.getData().status==i.statuses.EXCLUDE&&t.removeItem(n)}),$(t.host).on(n.ITEMEXCLUDED,function(e,n){t.dirty=!0,t.removeItem(n)})},t.onListSorted=function(e,n){var r=t.container.sortable("toArray"),i=[];t.imageEntities.forEach(function(e){var t=r.indexOf(e.getId());i[t]=e}),t.imageEntities=i,t.dirty=!0},t.getData=function(){var e=[],n=[];return t.imageEntities.forEach(function(t){e.push(t.getData()),n.push(t.getFile()||null)}),{items:e,files:n}},t.removeItem=function(e){var n=t.imageEntities.indexOf(e);n>=0&&t.imageEntities.splice(n,1)},t.addItem=function(e,o){if(e.status==i.statuses.DELETED)return void t.container.trigger(n.MESSAGEWARNING,"Added image has a delete status");if(1==t.maxItems&&t.getListLength()>=t.maxItems)t.imageEntities[0].onItemDelete(!1);else if(t.maxItems&&t.getListLength()>=t.maxItems)return void t.container.trigger(n.MESSAGEWARNING,"Maximal number of list items reached.");var a=r.create({item:jQuery.extend({},e),file:o,prefix:t.host.attr("id")+"_"+t.imageEntities.length});return t.imageEntities.push(a),t.container.append(a.render()),a},t.getListLength=function(){return $(t.imageEntities).filter(function(e,t){if(t.getData().status!=i.statuses.DELETED)return!0}).length},t.init(),t}}),define("ImageServiceConfig",{systemAttributes:{tags:{type:"tag",label:"Tags"}},labels:{ImageServiceFinder:{fields:{itemFind:"Search in the library"}},ImageServiceUploader:{button:{itemUpload:"Upload Image"}},ImageServicePresets:{title:"Defaults"},ImageServiceGlobals:{title:"Globals"},ImageServiceSettings:{title:"Settings"}},events:{LISTSAVED:"imageservice-listsaved",LISTSAVEFAILED:"imageservice-listsavefailed",LISTCHANGED:"imageservice-listchanged",LISTREADY:"imageservice-listready",LISTREMOVED:"imageservice-listremoved",LISTSAVINGSKIPPED:"imageservice-listsavingskipped",ITEMUPLOADED:"imageservice-itemuploaded",ITEMCHANGED:"imageservice-itemchanged",ITEMSAVED:"imageservice-itemsaved",ITEMADDED:"imageservice-itemadded",ITEMDELETED:"imageservice-itemdeleted",ITEMDELETE:"imageservice-itemdelete",ITEMTOGGLE:"imageservice-itemtoggle",ITEMEXCLUDE:"imageservice-itemexclude",ITEMEXCLUDED:"imageservice-itemexcluded",PREVIEWREADY:"imageservice-preview-ready",ATTRIBUTERENDERED:"imageservice-attribute-rendered",MESSAGEERROR:"imageservice-message-error",MESSAGEWARNING:"imageservice-message-warning",MESSAGEINFO:"imageservice-message-info",PRESETTERREGISTER:"imageservice-presetter-register",SETTINGREGISTER:"imageservice-setting-register"}}),define("ImageServiceErrors",[],function(){return function(e){var t=this,n={fileexists:"The image alsready exists. The existing copy has been taken. ",filesize:"The uploaded file is too big. Please choose a smaller one",nofile:"No file has been fount, for the new image",fileext:"The files extension is unknown",status:"Invalid image status",unknown:"Something went wrong. Try again and if the problem persits call an administrator",fileinvalid:"File is invalid. Either too big or the of an unsuported type",accessdenied:"You are not logged in!"};e instanceof Object&&e.hasOwnProperty("errors")&&(n=Object.assign(n,e.errors)),t.create=function(e){return n.hasOwnProperty(e)?n[e]:n.unknown}}}),define("ImageServiceGlobals",["ImageServiceSettingsInterface"],function(e){return function(t){e.call(this,t);var n=this,r=t.config.labels;n.container=null,n.name="globals",this.render=function(){return n.container&&n.container.remove(),n.container=$('<div class="imageservice-attributes-global"><h5>'+r.title+"</h5><hr/></div>"),n.container.append(n.attributes.render()),n.host.append(n.container),n.container},n.init=function(){n.attributes.prefix=n.getIdentifier(),n.registerSetting()},n.init()}}),define("ImageServiceListItem",[],function(){
return function(e){var t=this,n=e.config.events,r=e.model.actions,i=e.model.preview,o=e.factory.attributes,a=e.factory.dataModel,s=(e.eventsArena,e.factory.idGenerator),u=!1,c=a.create(e.item),f=e.file||null,l=e.definitions,d=e.service,h=null,p="",m=null,v=null,g=null;t.init=function(){p=t.generateId(c.id);var s=jQuery.extend({},c.attributes,{tags:c.tags});t.presetImage(),h=$('<div id="'+p+'" class="col-xs-12 col-sm-12 col-md-12 imageservice-entity"></div>'),g=new r({config:{events:n}}),m=new i({item:c,config:{events:n},factory:{dataModel:a}}),v=o.create({prefix:p,values:s,definitions:e.definitions,dataService:d}),t.addListeners(),f&&t.loadTheFile()},t.getId=function(){return p},t.generateId=function(e){return s.generate(e)},t.getData=function(){var e=v.getValues();c.tags=e.tags;for(var t in l)c.attributes[t]=e[t];return c},t.getFile=function(){return f},t.getOffsets=function(){return{left:h[0].offsetLeft,top:h[0].offsetTop}},t.addListeners=function(){h.on("change",function(e){t.onImageUpdate(e)}),h.on(n.ITEMDELETE,function(){t.onItemDelete(!0)}),$(window).on(n.ITEMDELETED,function(e,n){t.onItemDeleted(n)}),h.on(n.ITEMEXCLUDE,function(){t.onItemDelete(!1)}),$(window).on(n.ITEMEXCLUDED,function(e,n){t.onItemExcluded(n)}),$(window).on(n.MESSAGEERROR,function(e,n){t.generateId(n.data.id)===t.getId()&&h.addClass("error")}),$(window).on(n.MESSAGEWARNING,function(e,n){t.generateId(n.data.id)===t.getId()&&h.addClass("warning")})},t.presetImage=function(){c.info.source||c.status!=a.statuses.CLEAN||(c.info.source=d.getImageUrl(c.id,c.service)),c.attributes instanceof Array&&(c.attributes={})},t.onImageUpdate=function(e){u=!0,c.status!=a.statuses.NEW&&(c.status=a.statuses.DIRTY)},t.onItemDelete=function(e){if(u=!0,e&&c.status!=a.statuses.NEW){c.status=a.statuses.DELETED;var r=n.ITEMDELETED}else var r=n.ITEMEXCLUDED;t.hide(function(){h.trigger(r,t)})},t.onItemDeleted=function(e){u=!0,e.getData().id==c.id&&(c.status!=a.statuses.DELETED&&(c.status=a.statuses.EXCLUDE,h.trigger(n.ITEMEXCLUDED,t)),t.hide())},t.onItemExcluded=function(e){},t.hide=function(e){$(h).animate({height:0,opacity:0},300,function(){$(h).hide(),"function"==typeof e&&e()})},t.loadTheFile=function(){var e=new FileReader;e.addEventListener("load",function(){var t=window.URL||window.webkitURL||!1;c.info.source=t?t.createObjectURL(f):e.result,m.update(c),h.trigger(n.PREVIEWREADY,c)}),e.readAsDataURL(f)},t.render=function(){var e=$('<div class="col-xs-12 col-sm-3 col-md-3"></div>').append(m.render()),t=$('<div class="col-xs-12 col-sm-8 col-md-8"></div>').append(v.render());return h.append(e),h.append(t),h.append(g.render()),h},t.init()}}),define("ImageServiceEntityAction",[],function(){return function(e){var t=this,n=e.config.events;e.item;t.renderDelete=function(){var e=$('<button class="btn delete btn-danger"><i class="fa fa-trash"></i></button>');return e.on("click",function(r){r.stopPropagation(),r.preventDefault(),confirm("Are you sure you want to delete this item from the service?")&&e.trigger(n.ITEMDELETE,t.item)}),e},t.renderExclude=function(){var e=$('<button class="btn btn-warning remove"><i class="fa fa-minus"></i></button>');return e.on("click",function(r){r.stopPropagation(),r.preventDefault(),confirm("Are you sure you want to exclude this item from the list?")&&e.trigger(n.ITEMEXCLUDE,t.item)}),e},t.render=function(){var e=$('<div class="col-xs-12 col-sm-1 col-md-1 imageservice-entity-actions"></div>');return e.append(t.renderDelete()),e.append(t.renderExclude()),e}}}),define("ImageServicePreview",["ImageServiceUniqueId"],function(e){return function(t){var n=this,r=t.item,i=null,o=null,a=t.config.events,s=t.factory.dataModel,u=new e("");return n.init=function(){o=$('<div class="imageservice-preview"></div>'),i=$('<img id="'+u.generate(r.id)+'"/>'),n.update(r),i.on("click",function(){$(this).trigger(a.ITEMTOGGLE)}),o.append(i)},n.update=function(e){r=e,r.info.source instanceof Promise&&r.status!=s.statuses.NEW?r.info.source.then(function(e){i.attr("src",String(e).replace(/^http(s?):\/\//i,"//")),r.info.source=e}):r.info.source instanceof Promise||i.attr("src",String(r.info.source).replace(/^http(s?):\/\//i,"//"))},n.render=function(){return o},n.init(),n}}),define("plugins/core/set-root-p-element",[],function(){"use strict";return function(){return function(e){""===e.getHTML().trim()&&e.setContent("<p><br></p>")}}}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("immutable",t):e.Immutable=t()}(this,function(){"use strict";function e(e,t){t&&(e.prototype=Object.create(t.prototype)),e.prototype.constructor=e}function t(e){return e.value=!1,e}function n(e){e&&(e.value=!0)}function r(){}function i(e,t){t=t||0;for(var n=Math.max(0,e.length-t),r=new Array(n),i=0;n>i;i++)r[i]=e[i+t];return r}function o(e){return void 0===e.size&&(e.size=e.__iterate(s)),e.size}function a(e,t){return t>=0?+t:o(e)+ +t}function s(){return!0}function u(e,t,n){return(0===e||void 0!==n&&-n>=e)&&(void 0===t||void 0!==n&&t>=n)}function c(e,t){return l(e,t,0)}function f(e,t){return l(e,t,t)}function l(e,t,n){return void 0===e?n:0>e?Math.max(0,t+e):void 0===t?e:Math.min(t,e)}function d(e){return v(e)?e:T(e)}function h(e){return g(e)?e:L(e)}function p(e){return y(e)?e:C(e)}function m(e){return v(e)&&!_(e)?e:k(e)}function v(e){return!(!e||!e[mn])}function g(e){return!(!e||!e[vn])}function y(e){return!(!e||!e[gn])}function _(e){return g(e)||y(e)}function b(e){return!(!e||!e[yn])}function E(e){this.next=e}function S(e,t,n,r){var i=0===e?t:1===e?n:[t,n];return r?r.value=i:r={value:i,done:!1},r}function w(){return{value:void 0,done:!0}}function I(e){return!!M(e)}function x(e){return e&&"function"==typeof e.next}function O(e){var t=M(e);return t&&t.call(e)}function M(e){var t=e&&(Sn&&e[Sn]||e[wn]);return"function"==typeof t?t:void 0}function A(e){return e&&"number"==typeof e.length}function T(e){return null===e||void 0===e?z():v(e)?e.toSeq():U(e)}function L(e){return null===e||void 0===e?z().toKeyedSeq():v(e)?g(e)?e.toSeq():e.fromEntrySeq():P(e)}function C(e){return null===e||void 0===e?z():v(e)?g(e)?e.entrySeq():e.toIndexedSeq():F(e)}function k(e){return(null===e||void 0===e?z():v(e)?g(e)?e.entrySeq():e:F(e)).toSetSeq()}function N(e){this._array=e,this.size=e.length}function D(e){var t=Object.keys(e);this._object=e,this._keys=t,this.size=t.length}function j(e){this._iterable=e,this.size=e.length||e.size}function R(e){this._iterator=e,this._iteratorCache=[]}function q(e){return!(!e||!e[xn])}function z(){return On||(On=new N([]))}function P(e){var t=Array.isArray(e)?new N(e).fromEntrySeq():x(e)?new R(e).fromEntrySeq():I(e)?new j(e).fromEntrySeq():"object"==typeof e?new D(e):void 0;if(!t)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+e);return t}function F(e){var t=$(e);if(!t)throw new TypeError("Expected Array or iterable object of values: "+e);return t}function U(e){var t=$(e)||"object"==typeof e&&new D(e);if(!t)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+e);return t}function $(e){return A(e)?new N(e):x(e)?new R(e):I(e)?new j(e):void 0}function B(e,t,n,r){var i=e._cache;if(i){for(var o=i.length-1,a=0;o>=a;a++){var s=i[n?o-a:a];if(!1===t(s[1],r?s[0]:a,e))return a+1}return a}return e.__iterateUncached(t,n)}function H(e,t,n,r){var i=e._cache;if(i){var o=i.length-1,a=0;return new E(function(){var e=i[n?o-a:a];return a++>o?w():S(t,r?e[0]:a-1,e[1])})}return e.__iteratorUncached(t,n)}function G(){throw TypeError("Abstract")}function K(){}function W(){}function V(){}function J(e,t){if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1;if("function"==typeof e.valueOf&&"function"==typeof t.valueOf){if(e=e.valueOf(),t=t.valueOf(),e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1}return!("function"!=typeof e.equals||"function"!=typeof t.equals||!e.equals(t))}function Q(e,t){return t?X(t,e,"",{"":e}):Y(e)}function X(e,t,n,r){return Array.isArray(t)?e.call(r,n,C(t).map(function(n,r){return X(e,n,r,t)})):Z(t)?e.call(r,n,L(t).map(function(n,r){return X(e,n,r,t)})):t}function Y(e){return Array.isArray(e)?C(e).map(Y).toList():Z(e)?L(e).map(Y).toMap():e}function Z(e){return e&&(e.constructor===Object||void 0===e.constructor)}function ee(e){return e>>>1&1073741824|3221225471&e}function te(e){if(!1===e||null===e||void 0===e)return 0;if("function"==typeof e.valueOf&&(!1===(e=e.valueOf())||null===e||void 0===e))return 0;if(!0===e)return 1;var t=typeof e;if("number"===t){var n=0|e;for(n!==e&&(n^=4294967295*e);e>4294967295;)e/=4294967295,n^=e;return ee(n)}return"string"===t?e.length>Dn?ne(e):re(e):"function"==typeof e.hashCode?e.hashCode():ie(e)}function ne(e){var t=qn[e];return void 0===t&&(t=re(e),Rn===jn&&(Rn=0,qn={}),Rn++,qn[e]=t),t}function re(e){for(var t=0,n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return ee(t)}function ie(e){var t;if(Cn&&void 0!==(t=Mn.get(e)))return t;if(void 0!==(t=e[Nn]))return t;if(!Ln){if(void 0!==(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[Nn]))return t;if(void 0!==(t=oe(e)))return t}if(t=++kn,1073741824&kn&&(kn=0),Cn)Mn.set(e,t);else{if(void 0!==Tn&&!1===Tn(e))throw new Error("Non-extensible objects are not allowed as keys.");if(Ln)Object.defineProperty(e,Nn,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[Nn]=t;else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[Nn]=t}}return t}function oe(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function ae(e,t){if(!e)throw new Error(t)}function se(e){ae(e!==1/0,"Cannot perform this action with an infinite size.")}function ue(e,t){this._iter=e,this._useKeys=t,this.size=e.size}function ce(e){this._iter=e,this.size=e.size}function fe(e){this._iter=e,this.size=e.size}function le(e){this._iter=e,this.size=e.size}function de(e){var t=Ne(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.includes(t)},t.includes=function(t){return e.has(t)},t.cacheResult=De,t.__iterateUncached=function(t,n){var r=this;return e.__iterate(function(e,n){return!1!==t(n,e,r)},n)},t.__iteratorUncached=function(t,n){if(t===En){var r=e.__iterator(t,n);return new E(function(){var e=r.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e})}return e.__iterator(t===bn?_n:bn,n)},t}function he(e,t,n){var r=Ne(e);return r.size=e.size,r.has=function(t){return e.has(t)},r.get=function(r,i){var o=e.get(r,dn);return o===dn?i:t.call(n,o,r,e)},r.__iterateUncached=function(r,i){var o=this;return e.__iterate(function(e,i,a){return!1!==r(t.call(n,e,i,a),i,o)},i)},r.__iteratorUncached=function(r,i){var o=e.__iterator(En,i);return new E(function(){var i=o.next();if(i.done)return i;var a=i.value,s=a[0];return S(r,s,t.call(n,a[1],s,e),i)})},r}function pe(e,t){var n=Ne(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var t=de(e);return t.reverse=function(){return e.flip()},t}),n.get=function(n,r){return e.get(t?n:-1-n,r)},n.has=function(n){return e.has(t?n:-1-n)},n.includes=function(t){return e.includes(t)},n.cacheResult=De,n.__iterate=function(t,n){var r=this;return e.__iterate(function(e,n){return t(e,n,r)},!n)},n.__iterator=function(t,n){return e.__iterator(t,!n)},n}function me(e,t,n,r){var i=Ne(e);return r&&(i.has=function(r){var i=e.get(r,dn);return i!==dn&&!!t.call(n,i,r,e)},i.get=function(r,i){var o=e.get(r,dn);return o!==dn&&t.call(n,o,r,e)?o:i}),i.__iterateUncached=function(i,o){var a=this,s=0;return e.__iterate(function(e,o,u){return t.call(n,e,o,u)?(s++,i(e,r?o:s-1,a)):void 0},o),s},i.__iteratorUncached=function(i,o){var a=e.__iterator(En,o),s=0;return new E(function(){for(;;){var o=a.next();if(o.done)return o;var u=o.value,c=u[0],f=u[1];if(t.call(n,f,c,e))return S(i,r?c:s++,f,o)}})},i}function ve(e,t,n){var r=qe().asMutable();return e.__iterate(function(i,o){r.update(t.call(n,i,o,e),0,function(e){return e+1})}),r.asImmutable()}function ge(e,t,n){var r=g(e),i=(b(e)?wt():qe()).asMutable();e.__iterate(function(o,a){i.update(t.call(n,o,a,e),function(e){return e=e||[],e.push(r?[a,o]:o),e})});var o=ke(e);return i.map(function(t){return Te(e,o(t))})}function ye(e,t,n,r){var i=e.size;if(u(t,n,i))return e;var o=c(t,i),s=f(n,i);if(o!==o||s!==s)return ye(e.toSeq().cacheResult(),t,n,r);var l,d=s-o;d===d&&(l=0>d?0:d);var h=Ne(e);return h.size=l,!r&&q(e)&&l>=0&&(h.get=function(t,n){return t=a(this,t),t>=0&&l>t?e.get(t+o,n):n}),h.__iterateUncached=function(t,n){var i=this;if(0===l)return 0;if(n)return this.cacheResult().__iterate(t,n);var a=0,s=!0,u=0;return e.__iterate(function(e,n){return s&&(s=a++<o)?void 0:(u++,!1!==t(e,r?n:u-1,i)&&u!==l)}),u},h.__iteratorUncached=function(t,n){if(0!==l&&n)return this.cacheResult().__iterator(t,n);var i=0!==l&&e.__iterator(t,n),a=0,s=0;return new E(function(){for(;a++<o;)i.next();if(++s>l)return w();var e=i.next();return r||t===bn?e:t===_n?S(t,s-1,void 0,e):S(t,s-1,e.value[1],e)})},h}function _e(e,t,n){var r=Ne(e);return r.__iterateUncached=function(r,i){var o=this;if(i)return this.cacheResult().__iterate(r,i);var a=0;return e.__iterate(function(e,i,s){return t.call(n,e,i,s)&&++a&&r(e,i,o)}),a},r.__iteratorUncached=function(r,i){var o=this;if(i)return this.cacheResult().__iterator(r,i);var a=e.__iterator(En,i),s=!0;return new E(function(){if(!s)return w();var e=a.next();if(e.done)return e;var i=e.value,u=i[0],c=i[1];return t.call(n,c,u,o)?r===En?e:S(r,u,c,e):(s=!1,w())})},r}function be(e,t,n,r){var i=Ne(e);return i.__iterateUncached=function(i,o){var a=this;if(o)return this.cacheResult().__iterate(i,o);var s=!0,u=0;return e.__iterate(function(e,o,c){return s&&(s=t.call(n,e,o,c))?void 0:(u++,i(e,r?o:u-1,a))}),u},i.__iteratorUncached=function(i,o){var a=this;if(o)return this.cacheResult().__iterator(i,o);var s=e.__iterator(En,o),u=!0,c=0;return new E(function(){var e,o,f;do{if(e=s.next(),e.done)return r||i===bn?e:i===_n?S(i,c++,void 0,e):S(i,c++,e.value[1],e);var l=e.value;o=l[0],f=l[1],u&&(u=t.call(n,f,o,a))}while(u);return i===En?e:S(i,o,f,e)})},i}function Ee(e,t){var n=g(e),r=[e].concat(t).map(function(e){return v(e)?n&&(e=h(e)):e=n?P(e):F(Array.isArray(e)?e:[e]),e}).filter(function(e){return 0!==e.size});if(0===r.length)return e;if(1===r.length){var i=r[0];if(i===e||n&&g(i)||y(e)&&y(i))return i}var o=new N(r);return n?o=o.toKeyedSeq():y(e)||(o=o.toSetSeq()),o=o.flatten(!0),o.size=r.reduce(function(e,t){if(void 0!==e){var n=t.size;if(void 0!==n)return e+n}},0),o}function Se(e,t,n){var r=Ne(e);return r.__iterateUncached=function(r,i){function o(e,u){var c=this;e.__iterate(function(e,i){return(!t||t>u)&&v(e)?o(e,u+1):!1===r(e,n?i:a++,c)&&(s=!0),!s},i)}var a=0,s=!1;return o(e,0),a},r.__iteratorUncached=function(r,i){var o=e.__iterator(r,i),a=[],s=0;return new E(function(){for(;o;){var e=o.next();if(!1===e.done){var u=e.value;if(r===En&&(u=u[1]),t&&!(a.length<t)||!v(u))return n?e:S(r,s++,u,e);a.push(o),o=u.__iterator(r,i)}else o=a.pop()}return w()})},r}function we(e,t,n){var r=ke(e);return e.toSeq().map(function(i,o){return r(t.call(n,i,o,e))}).flatten(!0)}function Ie(e,t){var n=Ne(e);return n.size=e.size&&2*e.size-1,n.__iterateUncached=function(n,r){var i=this,o=0;return e.__iterate(function(e,r){return(!o||!1!==n(t,o++,i))&&!1!==n(e,o++,i)},r),o},n.__iteratorUncached=function(n,r){var i,o=e.__iterator(bn,r),a=0;return new E(function(){return(!i||a%2)&&(i=o.next(),i.done)?i:a%2?S(n,a++,t):S(n,a++,i.value,i)})},n}function xe(e,t,n){t||(t=je);var r=g(e),i=0,o=e.toSeq().map(function(t,r){return[r,t,i++,n?n(t,r,e):t]}).toArray();return o.sort(function(e,n){return t(e[3],n[3])||e[2]-n[2]}).forEach(r?function(e,t){o[t].length=2}:function(e,t){o[t]=e[1]}),r?L(o):y(e)?C(o):k(o)}function Oe(e,t,n){if(t||(t=je),n){var r=e.toSeq().map(function(t,r){return[t,n(t,r,e)]}).reduce(function(e,n){return Me(t,e[1],n[1])?n:e});return r&&r[0]}return e.reduce(function(e,n){return Me(t,e,n)?n:e})}function Me(e,t,n){var r=e(n,t);return 0===r&&n!==t&&(void 0===n||null===n||n!==n)||r>0}function Ae(e,t,n){var r=Ne(e);return r.size=new N(n).map(function(e){return e.size}).min(),r.__iterate=function(e,t){for(var n,r=this.__iterator(bn,t),i=0;!(n=r.next()).done&&!1!==e(n.value,i++,this););return i},r.__iteratorUncached=function(e,r){var i=n.map(function(e){return e=d(e),O(r?e.reverse():e)}),o=0,a=!1;return new E(function(){var n;return a||(n=i.map(function(e){return e.next()}),a=n.some(function(e){return e.done})),a?w():S(e,o++,t.apply(null,n.map(function(e){return e.value})))})},r}function Te(e,t){return q(e)?t:e.constructor(t)}function Le(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function Ce(e){return se(e.size),o(e)}function ke(e){return g(e)?h:y(e)?p:m}function Ne(e){return Object.create((g(e)?L:y(e)?C:k).prototype)}function De(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):T.prototype.cacheResult.call(this)}function je(e,t){return e>t?1:t>e?-1:0}function Re(e){var t=O(e);if(!t){if(!A(e))throw new TypeError("Expected iterable or array-like: "+e);t=O(d(e))}return t}function qe(e){return null===e||void 0===e?Ve():ze(e)?e:Ve().withMutations(function(t){var n=h(e);se(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function ze(e){return!(!e||!e[zn])}function Pe(e,t){this.ownerID=e,this.entries=t}function Fe(e,t,n){this.ownerID=e,this.bitmap=t,this.nodes=n}function Ue(e,t,n){this.ownerID=e,this.count=t,this.nodes=n}function $e(e,t,n){this.ownerID=e,this.keyHash=t,this.entries=n}function Be(e,t,n){this.ownerID=e,this.keyHash=t,this.entry=n}function He(e,t,n){this._type=t,this._reverse=n,this._stack=e._root&&Ke(e._root)}function Ge(e,t){return S(e,t[0],t[1])}function Ke(e,t){return{node:e,index:0,__prev:t}}function We(e,t,n,r){var i=Object.create(Pn);return i.size=e,i._root=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function Ve(){return Fn||(Fn=We(0))}function Je(e,n,r){var i,o;if(e._root){var a=t(hn),s=t(pn);if(i=Qe(e._root,e.__ownerID,0,void 0,n,r,a,s),!s.value)return e;o=e.size+(a.value?r===dn?-1:1:0)}else{if(r===dn)return e;o=1,i=new Pe(e.__ownerID,[[n,r]])}return e.__ownerID?(e.size=o,e._root=i,e.__hash=void 0,e.__altered=!0,e):i?We(o,i):Ve()}function Qe(e,t,r,i,o,a,s,u){return e?e.update(t,r,i,o,a,s,u):a===dn?e:(n(u),n(s),new Be(t,i,[o,a]))}function Xe(e){return e.constructor===Be||e.constructor===$e}function Ye(e,t,n,r,i){if(e.keyHash===r)return new $e(t,r,[e.entry,i]);var o,a=(0===n?e.keyHash:e.keyHash>>>n)&ln,s=(0===n?r:r>>>n)&ln;return new Fe(t,1<<a|1<<s,a===s?[Ye(e,t,n+cn,r,i)]:(o=new Be(t,r,i),s>a?[e,o]:[o,e]))}function Ze(e,t,n,i){e||(e=new r);for(var o=new Be(e,te(n),[n,i]),a=0;a<t.length;a++){var s=t[a];o=o.update(e,0,void 0,s[0],s[1])}return o}function et(e,t,n,r){for(var i=0,o=0,a=new Array(n),s=0,u=1,c=t.length;c>s;s++,u<<=1){var f=t[s];void 0!==f&&s!==r&&(i|=u,a[o++]=f)}return new Fe(e,i,a)}function tt(e,t,n,r,i){for(var o=0,a=new Array(fn),s=0;0!==n;s++,n>>>=1)a[s]=1&n?t[o++]:void 0;return a[r]=i,new Ue(e,o+1,a)}function nt(e,t,n){for(var r=[],i=0;i<n.length;i++){var o=n[i],a=h(o);v(o)||(a=a.map(function(e){return Q(e)})),r.push(a)}return it(e,t,r)}function rt(e){return function(t,n,r){return t&&t.mergeDeepWith&&v(n)?t.mergeDeepWith(e,n):e?e(t,n,r):n}}function it(e,t,n){return n=n.filter(function(e){return 0!==e.size}),0===n.length?e:0!==e.size||e.__ownerID||1!==n.length?e.withMutations(function(e){for(var r=t?function(n,r){e.update(r,dn,function(e){return e===dn?n:t(e,n,r)})}:function(t,n){e.set(n,t)},i=0;i<n.length;i++)n[i].forEach(r)}):e.constructor(n[0])}function ot(e,t,n,r){var i=e===dn,o=t.next();if(o.done){var a=i?n:e,s=r(a);return s===a?e:s}ae(i||e&&e.set,"invalid keyPath");var u=o.value,c=i?dn:e.get(u,dn),f=ot(c,t,n,r);return f===c?e:f===dn?e.remove(u):(i?Ve():e).set(u,f)}function at(e){return e-=e>>1&1431655765,e=(858993459&e)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,127&(e+=e>>16)}function st(e,t,n,r){var o=r?e:i(e);return o[t]=n,o}function ut(e,t,n,r){var i=e.length+1;if(r&&t+1===i)return e[t]=n,e;for(var o=new Array(i),a=0,s=0;i>s;s++)s===t?(o[s]=n,a=-1):o[s]=e[s+a];return o}function ct(e,t,n){var r=e.length-1;if(n&&t===r)return e.pop(),e;for(var i=new Array(r),o=0,a=0;r>a;a++)a===t&&(o=1),i[a]=e[a+o];return i}function ft(e){var t=mt();if(null===e||void 0===e)return t;if(lt(e))return e;var n=p(e),r=n.size;return 0===r?t:(se(r),r>0&&fn>r?pt(0,r,cn,null,new dt(n.toArray())):t.withMutations(function(e){e.setSize(r),n.forEach(function(t,n){return e.set(n,t)})}))}function lt(e){return!(!e||!e[Hn])}function dt(e,t){this.array=e,this.ownerID=t}function ht(e,t){function n(e,t,n){return 0===t?r(e,n):i(e,t,n)}function r(e,n){var r=n===s?u&&u.array:e&&e.array,i=n>o?0:o-n,c=a-n;return c>fn&&(c=fn),function(){if(i===c)return Wn;var e=t?--c:i++;return r&&r[e]}}function i(e,r,i){var s,u=e&&e.array,c=i>o?0:o-i>>r,f=1+(a-i>>r);return f>fn&&(f=fn),function(){for(;;){if(s){var e=s();if(e!==Wn)return e;s=null}if(c===f)return Wn;var o=t?--f:c++;s=n(u&&u[o],r-cn,i+(o<<r))}}}var o=e._origin,a=e._capacity,s=St(a),u=e._tail;return n(e._root,e._level,0)}function pt(e,t,n,r,i,o,a){var s=Object.create(Gn);return s.size=t-e,s._origin=e,s._capacity=t,s._level=n,s._root=r,s._tail=i,s.__ownerID=o,s.__hash=a,s.__altered=!1,s}function mt(){return Kn||(Kn=pt(0,0,cn))}function vt(e,n,r){if((n=a(e,n))>=e.size||0>n)return e.withMutations(function(e){0>n?bt(e,n).set(0,r):bt(e,0,n+1).set(n,r)});n+=e._origin;var i=e._tail,o=e._root,s=t(pn);return n>=St(e._capacity)?i=gt(i,e.__ownerID,0,n,r,s):o=gt(o,e.__ownerID,e._level,n,r,s),s.value?e.__ownerID?(e._root=o,e._tail=i,e.__hash=void 0,e.__altered=!0,e):pt(e._origin,e._capacity,e._level,o,i):e}function gt(e,t,r,i,o,a){var s=i>>>r&ln,u=e&&s<e.array.length;if(!u&&void 0===o)return e;var c;if(r>0){var f=e&&e.array[s],l=gt(f,t,r-cn,i,o,a);return l===f?e:(c=yt(e,t),c.array[s]=l,c)}return u&&e.array[s]===o?e:(n(a),c=yt(e,t),void 0===o&&s===c.array.length-1?c.array.pop():c.array[s]=o,c)}function yt(e,t){return t&&e&&t===e.ownerID?e:new dt(e?e.array.slice():[],t)}function _t(e,t){if(t>=St(e._capacity))return e._tail;if(t<1<<e._level+cn){for(var n=e._root,r=e._level;n&&r>0;)n=n.array[t>>>r&ln],r-=cn;return n}}function bt(e,t,n){var i=e.__ownerID||new r,o=e._origin,a=e._capacity,s=o+t,u=void 0===n?a:0>n?a+n:o+n;if(s===o&&u===a)return e;if(s>=u)return e.clear();for(var c=e._level,f=e._root,l=0;0>s+l;)f=new dt(f&&f.array.length?[void 0,f]:[],i),c+=cn,l+=1<<c;l&&(s+=l,o+=l,u+=l,a+=l);for(var d=St(a),h=St(u);h>=1<<c+cn;)f=new dt(f&&f.array.length?[f]:[],i),c+=cn;var p=e._tail,m=d>h?_t(e,u-1):h>d?new dt([],i):p;if(p&&h>d&&a>s&&p.array.length){f=yt(f,i);for(var v=f,g=c;g>cn;g-=cn){var y=d>>>g&ln;v=v.array[y]=yt(v.array[y],i)}v.array[d>>>cn&ln]=p}if(a>u&&(m=m&&m.removeAfter(i,0,u)),s>=h)s-=h,u-=h,c=cn,f=null,m=m&&m.removeBefore(i,0,s);else if(s>o||d>h){for(l=0;f;){var _=s>>>c&ln;if(_!==h>>>c&ln)break;_&&(l+=(1<<c)*_),c-=cn,f=f.array[_]}f&&s>o&&(f=f.removeBefore(i,c,s-l)),f&&d>h&&(f=f.removeAfter(i,c,h-l)),l&&(s-=l,u-=l)}return e.__ownerID?(e.size=u-s,e._origin=s,e._capacity=u,e._level=c,e._root=f,e._tail=m,e.__hash=void 0,e.__altered=!0,e):pt(s,u,c,f,m)}function Et(e,t,n){for(var r=[],i=0,o=0;o<n.length;o++){var a=n[o],s=p(a);s.size>i&&(i=s.size),v(a)||(s=s.map(function(e){return Q(e)})),r.push(s)}return i>e.size&&(e=e.setSize(i)),it(e,t,r)}function St(e){return fn>e?0:e-1>>>cn<<cn}function wt(e){return null===e||void 0===e?Ot():It(e)?e:Ot().withMutations(function(t){var n=h(e);se(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function It(e){return ze(e)&&b(e)}function xt(e,t,n,r){var i=Object.create(wt.prototype);return i.size=e?e.size:0,i._map=e,i._list=t,i.__ownerID=n,i.__hash=r,i}function Ot(){return Vn||(Vn=xt(Ve(),mt()))}function Mt(e,t,n){var r,i,o=e._map,a=e._list,s=o.get(t),u=void 0!==s;if(n===dn){if(!u)return e;a.size>=fn&&a.size>=2*o.size?(i=a.filter(function(e,t){return void 0!==e&&s!==t}),r=i.toKeyedSeq().map(function(e){return e[0]}).flip().toMap(),e.__ownerID&&(r.__ownerID=i.__ownerID=e.__ownerID)):(r=o.remove(t),i=s===a.size-1?a.pop():a.set(s,void 0))}else if(u){if(n===a.get(s)[1])return e;r=o,i=a.set(s,[t,n])}else r=o.set(t,a.size),i=a.set(a.size,[t,n]);return e.__ownerID?(e.size=r.size,e._map=r,e._list=i,e.__hash=void 0,e):xt(r,i)}function At(e){return null===e||void 0===e?Ct():Tt(e)?e:Ct().unshiftAll(e)}function Tt(e){return!(!e||!e[Jn])}function Lt(e,t,n,r){var i=Object.create(Qn);return i.size=e,i._head=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function Ct(){return Xn||(Xn=Lt(0))}function kt(e){return null===e||void 0===e?Rt():Nt(e)?e:Rt().withMutations(function(t){var n=m(e);se(n.size),n.forEach(function(e){return t.add(e)})})}function Nt(e){return!(!e||!e[Yn])}function Dt(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function jt(e,t){var n=Object.create(Zn);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function Rt(){return er||(er=jt(Ve()))}function qt(e){return null===e||void 0===e?Ft():zt(e)?e:Ft().withMutations(function(t){var n=m(e);se(n.size),n.forEach(function(e){return t.add(e)})})}function zt(e){return Nt(e)&&b(e)}function Pt(e,t){var n=Object.create(tr);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function Ft(){return nr||(nr=Pt(Ot()))}function Ut(e,t){var n,r=function(o){if(o instanceof r)return o;if(!(this instanceof r))return new r(o);if(!n){n=!0;var a=Object.keys(e);Ht(i,a),i.size=a.length,i._name=t,i._keys=a,i._defaultValues=e}this._map=qe(o)},i=r.prototype=Object.create(rr);return i.constructor=r,r}function $t(e,t,n){var r=Object.create(Object.getPrototypeOf(e));return r._map=t,r.__ownerID=n,r}function Bt(e){return e._name||e.constructor.name||"Record"}function Ht(e,t){try{t.forEach(Gt.bind(void 0,e))}catch(e){}}function Gt(e,t){Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(e){ae(this.__ownerID,"Cannot set on an immutable record."),this.set(t,e)}})}function Kt(e,t){if(e===t)return!0;if(!v(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||g(e)!==g(t)||y(e)!==y(t)||b(e)!==b(t))return!1;if(0===e.size&&0===t.size)return!0;var n=!_(e);if(b(e)){var r=e.entries();return t.every(function(e,t){var i=r.next().value;return i&&J(i[1],e)&&(n||J(i[0],t))})&&r.next().done}var i=!1;if(void 0===e.size)if(void 0===t.size)"function"==typeof e.cacheResult&&e.cacheResult();else{i=!0;var o=e;e=t,t=o}var a=!0,s=t.__iterate(function(t,r){return(n?e.has(t):i?J(t,e.get(r,dn)):J(e.get(r,dn),t))?void 0:(a=!1,!1)});return a&&e.size===s}function Wt(e,t,n){if(!(this instanceof Wt))return new Wt(e,t,n);if(ae(0!==n,"Cannot step a Range by 0"),e=e||0,void 0===t&&(t=1/0),n=void 0===n?1:Math.abs(n),e>t&&(n=-n),this._start=e,this._end=t,this._step=n,this.size=Math.max(0,Math.ceil((t-e)/n-1)+1),0===this.size){if(ir)return ir;ir=this}}function Vt(e,t){if(!(this instanceof Vt))return new Vt(e,t);if(this._value=e,this.size=void 0===t?1/0:Math.max(0,t),0===this.size){if(or)return or;or=this}}function Jt(e,t){var n=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(n),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(n),e}function Qt(e,t){return t}function Xt(e,t){return[t,e]}function Yt(e){return function(){return!e.apply(this,arguments)}}function Zt(e){return function(){return-e.apply(this,arguments)}}function en(e){return"string"==typeof e?JSON.stringify(e):e}function tn(){return i(arguments)}function nn(e,t){return t>e?1:e>t?-1:0}function rn(e){if(e.size===1/0)return 0;var t=b(e),n=g(e),r=t?1:0;return on(e.__iterate(n?t?function(e,t){r=31*r+an(te(e),te(t))|0}:function(e,t){r=r+an(te(e),te(t))|0}:t?function(e){r=31*r+te(e)|0}:function(e){r=r+te(e)|0}),r)}function on(e,t){return t=An(t,3432918353),t=An(t<<15|t>>>-15,461845907),t=An(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=An(t^t>>>16,2246822507),t=An(t^t>>>13,3266489909),t=ee(t^t>>>16)}function an(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}var sn=Array.prototype.slice,un="delete",cn=5,fn=1<<cn,ln=fn-1,dn={},hn={value:!1},pn={value:!1};e(h,d),e(p,d),e(m,d),d.isIterable=v,d.isKeyed=g,d.isIndexed=y,d.isAssociative=_,d.isOrdered=b,d.Keyed=h,d.Indexed=p,d.Set=m;var mn="@@__IMMUTABLE_ITERABLE__@@",vn="@@__IMMUTABLE_KEYED__@@",gn="@@__IMMUTABLE_INDEXED__@@",yn="@@__IMMUTABLE_ORDERED__@@",_n=0,bn=1,En=2,Sn="function"==typeof Symbol&&Symbol.iterator,wn="@@iterator",In=Sn||wn;E.prototype.toString=function(){return"[Iterator]"},E.KEYS=_n,E.VALUES=bn,E.ENTRIES=En,E.prototype.inspect=E.prototype.toSource=function(){return this.toString()},E.prototype[In]=function(){return this},e(T,d),T.of=function(){return T(arguments)},T.prototype.toSeq=function(){return this},T.prototype.toString=function(){return this.__toString("Seq {","}")},T.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},T.prototype.__iterate=function(e,t){return B(this,e,t,!0)},T.prototype.__iterator=function(e,t){return H(this,e,t,!0)},e(L,T),L.prototype.toKeyedSeq=function(){return this},e(C,T),C.of=function(){return C(arguments)},C.prototype.toIndexedSeq=function(){return this},C.prototype.toString=function(){return this.__toString("Seq [","]")},C.prototype.__iterate=function(e,t){return B(this,e,t,!1)},C.prototype.__iterator=function(e,t){return H(this,e,t,!1)},e(k,T),k.of=function(){return k(arguments)},k.prototype.toSetSeq=function(){return this},T.isSeq=q,T.Keyed=L,T.Set=k,T.Indexed=C;var xn="@@__IMMUTABLE_SEQ__@@";T.prototype[xn]=!0,e(N,C),N.prototype.get=function(e,t){return this.has(e)?this._array[a(this,e)]:t},N.prototype.__iterate=function(e,t){for(var n=this._array,r=n.length-1,i=0;r>=i;i++)if(!1===e(n[t?r-i:i],i,this))return i+1;return i},N.prototype.__iterator=function(e,t){var n=this._array,r=n.length-1,i=0;return new E(function(){return i>r?w():S(e,i,n[t?r-i++:i++])})},e(D,L),D.prototype.get=function(e,t){return void 0===t||this.has(e)?this._object[e]:t},D.prototype.has=function(e){return this._object.hasOwnProperty(e)},D.prototype.__iterate=function(e,t){for(var n=this._object,r=this._keys,i=r.length-1,o=0;i>=o;o++){var a=r[t?i-o:o];if(!1===e(n[a],a,this))return o+1}return o},D.prototype.__iterator=function(e,t){var n=this._object,r=this._keys,i=r.length-1,o=0;return new E(function(){var a=r[t?i-o:o];return o++>i?w():S(e,a,n[a])})},D.prototype[yn]=!0,e(j,C),j.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var n=this._iterable,r=O(n),i=0;if(x(r))for(var o;!(o=r.next()).done&&!1!==e(o.value,i++,this););return i},j.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterable,r=O(n);if(!x(r))return new E(w);var i=0;return new E(function(){var t=r.next();return t.done?t:S(e,i++,t.value)})},e(R,C),R.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);for(var n=this._iterator,r=this._iteratorCache,i=0;i<r.length;)if(!1===e(r[i],i++,this))return i;for(var o;!(o=n.next()).done;){var a=o.value;if(r[i]=a,!1===e(a,i++,this))break}return i},R.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterator,r=this._iteratorCache,i=0;return new E(function(){if(i>=r.length){var t=n.next();if(t.done)return t;r[i]=t.value}return S(e,i,r[i++])})};var On;e(G,d),e(K,G),e(W,G),e(V,G),G.Keyed=K,G.Indexed=W,G.Set=V;var Mn,An="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(e,t){e|=0,t|=0;var n=65535&e,r=65535&t;return n*r+((e>>>16)*r+n*(t>>>16)<<16>>>0)|0},Tn=Object.isExtensible,Ln=function(){try{return Object.defineProperty({},"@",{}),!0
}catch(e){return!1}}(),Cn="function"==typeof WeakMap;Cn&&(Mn=new WeakMap);var kn=0,Nn="__immutablehash__";"function"==typeof Symbol&&(Nn=Symbol(Nn));var Dn=16,jn=255,Rn=0,qn={};e(ue,L),ue.prototype.get=function(e,t){return this._iter.get(e,t)},ue.prototype.has=function(e){return this._iter.has(e)},ue.prototype.valueSeq=function(){return this._iter.valueSeq()},ue.prototype.reverse=function(){var e=this,t=pe(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},ue.prototype.map=function(e,t){var n=this,r=he(this,e,t);return this._useKeys||(r.valueSeq=function(){return n._iter.toSeq().map(e,t)}),r},ue.prototype.__iterate=function(e,t){var n,r=this;return this._iter.__iterate(this._useKeys?function(t,n){return e(t,n,r)}:(n=t?Ce(this):0,function(i){return e(i,t?--n:n++,r)}),t)},ue.prototype.__iterator=function(e,t){if(this._useKeys)return this._iter.__iterator(e,t);var n=this._iter.__iterator(bn,t),r=t?Ce(this):0;return new E(function(){var i=n.next();return i.done?i:S(e,t?--r:r++,i.value,i)})},ue.prototype[yn]=!0,e(ce,C),ce.prototype.includes=function(e){return this._iter.includes(e)},ce.prototype.__iterate=function(e,t){var n=this,r=0;return this._iter.__iterate(function(t){return e(t,r++,n)},t)},ce.prototype.__iterator=function(e,t){var n=this._iter.__iterator(bn,t),r=0;return new E(function(){var t=n.next();return t.done?t:S(e,r++,t.value,t)})},e(fe,k),fe.prototype.has=function(e){return this._iter.includes(e)},fe.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){return e(t,t,n)},t)},fe.prototype.__iterator=function(e,t){var n=this._iter.__iterator(bn,t);return new E(function(){var t=n.next();return t.done?t:S(e,t.value,t.value,t)})},e(le,L),le.prototype.entrySeq=function(){return this._iter.toSeq()},le.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){if(t){Le(t);var r=v(t);return e(r?t.get(1):t[1],r?t.get(0):t[0],n)}},t)},le.prototype.__iterator=function(e,t){var n=this._iter.__iterator(bn,t);return new E(function(){for(;;){var t=n.next();if(t.done)return t;var r=t.value;if(r){Le(r);var i=v(r);return S(e,i?r.get(0):r[0],i?r.get(1):r[1],t)}}})},ce.prototype.cacheResult=ue.prototype.cacheResult=fe.prototype.cacheResult=le.prototype.cacheResult=De,e(qe,K),qe.prototype.toString=function(){return this.__toString("Map {","}")},qe.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},qe.prototype.set=function(e,t){return Je(this,e,t)},qe.prototype.setIn=function(e,t){return this.updateIn(e,dn,function(){return t})},qe.prototype.remove=function(e){return Je(this,e,dn)},qe.prototype.deleteIn=function(e){return this.updateIn(e,function(){return dn})},qe.prototype.update=function(e,t,n){return 1===arguments.length?e(this):this.updateIn([e],t,n)},qe.prototype.updateIn=function(e,t,n){n||(n=t,t=void 0);var r=ot(this,Re(e),t,n);return r===dn?void 0:r},qe.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Ve()},qe.prototype.merge=function(){return nt(this,void 0,arguments)},qe.prototype.mergeWith=function(e){return nt(this,e,sn.call(arguments,1))},qe.prototype.mergeIn=function(e){var t=sn.call(arguments,1);return this.updateIn(e,Ve(),function(e){return"function"==typeof e.merge?e.merge.apply(e,t):t[t.length-1]})},qe.prototype.mergeDeep=function(){return nt(this,rt(void 0),arguments)},qe.prototype.mergeDeepWith=function(e){var t=sn.call(arguments,1);return nt(this,rt(e),t)},qe.prototype.mergeDeepIn=function(e){var t=sn.call(arguments,1);return this.updateIn(e,Ve(),function(e){return"function"==typeof e.mergeDeep?e.mergeDeep.apply(e,t):t[t.length-1]})},qe.prototype.sort=function(e){return wt(xe(this,e))},qe.prototype.sortBy=function(e,t){return wt(xe(this,t,e))},qe.prototype.withMutations=function(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this},qe.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new r)},qe.prototype.asImmutable=function(){return this.__ensureOwner()},qe.prototype.wasAltered=function(){return this.__altered},qe.prototype.__iterator=function(e,t){return new He(this,e,t)},qe.prototype.__iterate=function(e,t){var n=this,r=0;return this._root&&this._root.iterate(function(t){return r++,e(t[1],t[0],n)},t),r},qe.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?We(this.size,this._root,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},qe.isMap=ze;var zn="@@__IMMUTABLE_MAP__@@",Pn=qe.prototype;Pn[zn]=!0,Pn[un]=Pn.remove,Pn.removeIn=Pn.deleteIn,Pe.prototype.get=function(e,t,n,r){for(var i=this.entries,o=0,a=i.length;a>o;o++)if(J(n,i[o][0]))return i[o][1];return r},Pe.prototype.update=function(e,t,r,o,a,s,u){for(var c=a===dn,f=this.entries,l=0,d=f.length;d>l&&!J(o,f[l][0]);l++);var h=d>l;if(h?f[l][1]===a:c)return this;if(n(u),(c||!h)&&n(s),!c||1!==f.length){if(!h&&!c&&f.length>=Un)return Ze(e,f,o,a);var p=e&&e===this.ownerID,m=p?f:i(f);return h?c?l===d-1?m.pop():m[l]=m.pop():m[l]=[o,a]:m.push([o,a]),p?(this.entries=m,this):new Pe(e,m)}},Fe.prototype.get=function(e,t,n,r){void 0===t&&(t=te(n));var i=1<<((0===e?t:t>>>e)&ln),o=this.bitmap;return 0==(o&i)?r:this.nodes[at(o&i-1)].get(e+cn,t,n,r)},Fe.prototype.update=function(e,t,n,r,i,o,a){void 0===n&&(n=te(r));var s=(0===t?n:n>>>t)&ln,u=1<<s,c=this.bitmap,f=0!=(c&u);if(!f&&i===dn)return this;var l=at(c&u-1),d=this.nodes,h=f?d[l]:void 0,p=Qe(h,e,t+cn,n,r,i,o,a);if(p===h)return this;if(!f&&p&&d.length>=$n)return tt(e,d,c,s,p);if(f&&!p&&2===d.length&&Xe(d[1^l]))return d[1^l];if(f&&p&&1===d.length&&Xe(p))return p;var m=e&&e===this.ownerID,v=f?p?c:c^u:c|u,g=f?p?st(d,l,p,m):ct(d,l,m):ut(d,l,p,m);return m?(this.bitmap=v,this.nodes=g,this):new Fe(e,v,g)},Ue.prototype.get=function(e,t,n,r){void 0===t&&(t=te(n));var i=(0===e?t:t>>>e)&ln,o=this.nodes[i];return o?o.get(e+cn,t,n,r):r},Ue.prototype.update=function(e,t,n,r,i,o,a){void 0===n&&(n=te(r));var s=(0===t?n:n>>>t)&ln,u=i===dn,c=this.nodes,f=c[s];if(u&&!f)return this;var l=Qe(f,e,t+cn,n,r,i,o,a);if(l===f)return this;var d=this.count;if(f){if(!l&&(d--,Bn>d))return et(e,c,d,s)}else d++;var h=e&&e===this.ownerID,p=st(c,s,l,h);return h?(this.count=d,this.nodes=p,this):new Ue(e,d,p)},$e.prototype.get=function(e,t,n,r){for(var i=this.entries,o=0,a=i.length;a>o;o++)if(J(n,i[o][0]))return i[o][1];return r},$e.prototype.update=function(e,t,r,o,a,s,u){void 0===r&&(r=te(o));var c=a===dn;if(r!==this.keyHash)return c?this:(n(u),n(s),Ye(this,e,t,r,[o,a]));for(var f=this.entries,l=0,d=f.length;d>l&&!J(o,f[l][0]);l++);var h=d>l;if(h?f[l][1]===a:c)return this;if(n(u),(c||!h)&&n(s),c&&2===d)return new Be(e,this.keyHash,f[1^l]);var p=e&&e===this.ownerID,m=p?f:i(f);return h?c?l===d-1?m.pop():m[l]=m.pop():m[l]=[o,a]:m.push([o,a]),p?(this.entries=m,this):new $e(e,this.keyHash,m)},Be.prototype.get=function(e,t,n,r){return J(n,this.entry[0])?this.entry[1]:r},Be.prototype.update=function(e,t,r,i,o,a,s){var u=o===dn,c=J(i,this.entry[0]);return(c?o===this.entry[1]:u)?this:(n(s),u?void n(a):c?e&&e===this.ownerID?(this.entry[1]=o,this):new Be(e,this.keyHash,[i,o]):(n(a),Ye(this,e,t,te(i),[i,o])))},Pe.prototype.iterate=$e.prototype.iterate=function(e,t){for(var n=this.entries,r=0,i=n.length-1;i>=r;r++)if(!1===e(n[t?i-r:r]))return!1},Fe.prototype.iterate=Ue.prototype.iterate=function(e,t){for(var n=this.nodes,r=0,i=n.length-1;i>=r;r++){var o=n[t?i-r:r];if(o&&!1===o.iterate(e,t))return!1}},Be.prototype.iterate=function(e,t){return e(this.entry)},e(He,E),He.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var n,r=t.node,i=t.index++;if(r.entry){if(0===i)return Ge(e,r.entry)}else if(r.entries){if((n=r.entries.length-1)>=i)return Ge(e,r.entries[this._reverse?n-i:i])}else if((n=r.nodes.length-1)>=i){var o=r.nodes[this._reverse?n-i:i];if(o){if(o.entry)return Ge(e,o.entry);t=this._stack=Ke(o,t)}continue}t=this._stack=this._stack.__prev}return w()};var Fn,Un=fn/4,$n=fn/2,Bn=fn/4;e(ft,W),ft.of=function(){return this(arguments)},ft.prototype.toString=function(){return this.__toString("List [","]")},ft.prototype.get=function(e,t){if(0>(e=a(this,e))||e>=this.size)return t;e+=this._origin;var n=_t(this,e);return n&&n.array[e&ln]},ft.prototype.set=function(e,t){return vt(this,e,t)},ft.prototype.remove=function(e){return this.has(e)?0===e?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},ft.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=cn,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):mt()},ft.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations(function(n){bt(n,0,t+e.length);for(var r=0;r<e.length;r++)n.set(t+r,e[r])})},ft.prototype.pop=function(){return bt(this,0,-1)},ft.prototype.unshift=function(){var e=arguments;return this.withMutations(function(t){bt(t,-e.length);for(var n=0;n<e.length;n++)t.set(n,e[n])})},ft.prototype.shift=function(){return bt(this,1)},ft.prototype.merge=function(){return Et(this,void 0,arguments)},ft.prototype.mergeWith=function(e){return Et(this,e,sn.call(arguments,1))},ft.prototype.mergeDeep=function(){return Et(this,rt(void 0),arguments)},ft.prototype.mergeDeepWith=function(e){var t=sn.call(arguments,1);return Et(this,rt(e),t)},ft.prototype.setSize=function(e){return bt(this,0,e)},ft.prototype.slice=function(e,t){var n=this.size;return u(e,t,n)?this:bt(this,c(e,n),f(t,n))},ft.prototype.__iterator=function(e,t){var n=0,r=ht(this,t);return new E(function(){var t=r();return t===Wn?w():S(e,n++,t)})},ft.prototype.__iterate=function(e,t){for(var n,r=0,i=ht(this,t);(n=i())!==Wn&&!1!==e(n,r++,this););return r},ft.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?pt(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this.__ownerID=e,this)},ft.isList=lt;var Hn="@@__IMMUTABLE_LIST__@@",Gn=ft.prototype;Gn[Hn]=!0,Gn[un]=Gn.remove,Gn.setIn=Pn.setIn,Gn.deleteIn=Gn.removeIn=Pn.removeIn,Gn.update=Pn.update,Gn.updateIn=Pn.updateIn,Gn.mergeIn=Pn.mergeIn,Gn.mergeDeepIn=Pn.mergeDeepIn,Gn.withMutations=Pn.withMutations,Gn.asMutable=Pn.asMutable,Gn.asImmutable=Pn.asImmutable,Gn.wasAltered=Pn.wasAltered,dt.prototype.removeBefore=function(e,t,n){if(n===t?1<<t:0===this.array.length)return this;var r=n>>>t&ln;if(r>=this.array.length)return new dt([],e);var i,o=0===r;if(t>0){var a=this.array[r];if((i=a&&a.removeBefore(e,t-cn,n))===a&&o)return this}if(o&&!i)return this;var s=yt(this,e);if(!o)for(var u=0;r>u;u++)s.array[u]=void 0;return i&&(s.array[r]=i),s},dt.prototype.removeAfter=function(e,t,n){if(n===t?1<<t:0===this.array.length)return this;var r=n-1>>>t&ln;if(r>=this.array.length)return this;var i,o=r===this.array.length-1;if(t>0){var a=this.array[r];if((i=a&&a.removeAfter(e,t-cn,n))===a&&o)return this}if(o&&!i)return this;var s=yt(this,e);return o||s.array.pop(),i&&(s.array[r]=i),s};var Kn,Wn={};e(wt,qe),wt.of=function(){return this(arguments)},wt.prototype.toString=function(){return this.__toString("OrderedMap {","}")},wt.prototype.get=function(e,t){var n=this._map.get(e);return void 0!==n?this._list.get(n)[1]:t},wt.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Ot()},wt.prototype.set=function(e,t){return Mt(this,e,t)},wt.prototype.remove=function(e){return Mt(this,e,dn)},wt.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},wt.prototype.__iterate=function(e,t){var n=this;return this._list.__iterate(function(t){return t&&e(t[1],t[0],n)},t)},wt.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},wt.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),n=this._list.__ensureOwner(e);return e?xt(t,n,e,this.__hash):(this.__ownerID=e,this._map=t,this._list=n,this)},wt.isOrderedMap=It,wt.prototype[yn]=!0,wt.prototype[un]=wt.prototype.remove;var Vn;e(At,W),At.of=function(){return this(arguments)},At.prototype.toString=function(){return this.__toString("Stack [","]")},At.prototype.get=function(e,t){var n=this._head;for(e=a(this,e);n&&e--;)n=n.next;return n?n.value:t},At.prototype.peek=function(){return this._head&&this._head.value},At.prototype.push=function(){if(0===arguments.length)return this;for(var e=this.size+arguments.length,t=this._head,n=arguments.length-1;n>=0;n--)t={value:arguments[n],next:t};return this.__ownerID?(this.size=e,this._head=t,this.__hash=void 0,this.__altered=!0,this):Lt(e,t)},At.prototype.pushAll=function(e){if(e=p(e),0===e.size)return this;se(e.size);var t=this.size,n=this._head;return e.reverse().forEach(function(e){t++,n={value:e,next:n}}),this.__ownerID?(this.size=t,this._head=n,this.__hash=void 0,this.__altered=!0,this):Lt(t,n)},At.prototype.pop=function(){return this.slice(1)},At.prototype.unshift=function(){return this.push.apply(this,arguments)},At.prototype.unshiftAll=function(e){return this.pushAll(e)},At.prototype.shift=function(){return this.pop.apply(this,arguments)},At.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):Ct()},At.prototype.slice=function(e,t){if(u(e,t,this.size))return this;var n=c(e,this.size);if(f(t,this.size)!==this.size)return W.prototype.slice.call(this,e,t);for(var r=this.size-n,i=this._head;n--;)i=i.next;return this.__ownerID?(this.size=r,this._head=i,this.__hash=void 0,this.__altered=!0,this):Lt(r,i)},At.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Lt(this.size,this._head,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},At.prototype.__iterate=function(e,t){if(t)return this.reverse().__iterate(e);for(var n=0,r=this._head;r&&!1!==e(r.value,n++,this);)r=r.next;return n},At.prototype.__iterator=function(e,t){if(t)return this.reverse().__iterator(e);var n=0,r=this._head;return new E(function(){if(r){var t=r.value;return r=r.next,S(e,n++,t)}return w()})},At.isStack=Tt;var Jn="@@__IMMUTABLE_STACK__@@",Qn=At.prototype;Qn[Jn]=!0,Qn.withMutations=Pn.withMutations,Qn.asMutable=Pn.asMutable,Qn.asImmutable=Pn.asImmutable,Qn.wasAltered=Pn.wasAltered;var Xn;e(kt,V),kt.of=function(){return this(arguments)},kt.fromKeys=function(e){return this(h(e).keySeq())},kt.prototype.toString=function(){return this.__toString("Set {","}")},kt.prototype.has=function(e){return this._map.has(e)},kt.prototype.add=function(e){return Dt(this,this._map.set(e,!0))},kt.prototype.remove=function(e){return Dt(this,this._map.remove(e))},kt.prototype.clear=function(){return Dt(this,this._map.clear())},kt.prototype.union=function(){var e=sn.call(arguments,0);return e=e.filter(function(e){return 0!==e.size}),0===e.length?this:0!==this.size||this.__ownerID||1!==e.length?this.withMutations(function(t){for(var n=0;n<e.length;n++)m(e[n]).forEach(function(e){return t.add(e)})}):this.constructor(e[0])},kt.prototype.intersect=function(){var e=sn.call(arguments,0);if(0===e.length)return this;e=e.map(function(e){return m(e)});var t=this;return this.withMutations(function(n){t.forEach(function(t){e.every(function(e){return e.includes(t)})||n.remove(t)})})},kt.prototype.subtract=function(){var e=sn.call(arguments,0);if(0===e.length)return this;e=e.map(function(e){return m(e)});var t=this;return this.withMutations(function(n){t.forEach(function(t){e.some(function(e){return e.includes(t)})&&n.remove(t)})})},kt.prototype.merge=function(){return this.union.apply(this,arguments)},kt.prototype.mergeWith=function(e){var t=sn.call(arguments,1);return this.union.apply(this,t)},kt.prototype.sort=function(e){return qt(xe(this,e))},kt.prototype.sortBy=function(e,t){return qt(xe(this,t,e))},kt.prototype.wasAltered=function(){return this._map.wasAltered()},kt.prototype.__iterate=function(e,t){var n=this;return this._map.__iterate(function(t,r){return e(r,r,n)},t)},kt.prototype.__iterator=function(e,t){return this._map.map(function(e,t){return t}).__iterator(e,t)},kt.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):(this.__ownerID=e,this._map=t,this)},kt.isSet=Nt;var Yn="@@__IMMUTABLE_SET__@@",Zn=kt.prototype;Zn[Yn]=!0,Zn[un]=Zn.remove,Zn.mergeDeep=Zn.merge,Zn.mergeDeepWith=Zn.mergeWith,Zn.withMutations=Pn.withMutations,Zn.asMutable=Pn.asMutable,Zn.asImmutable=Pn.asImmutable,Zn.__empty=Rt,Zn.__make=jt;var er;e(qt,kt),qt.of=function(){return this(arguments)},qt.fromKeys=function(e){return this(h(e).keySeq())},qt.prototype.toString=function(){return this.__toString("OrderedSet {","}")},qt.isOrderedSet=zt;var tr=qt.prototype;tr[yn]=!0,tr.__empty=Ft,tr.__make=Pt;var nr;e(Ut,K),Ut.prototype.toString=function(){return this.__toString(Bt(this)+" {","}")},Ut.prototype.has=function(e){return this._defaultValues.hasOwnProperty(e)},Ut.prototype.get=function(e,t){if(!this.has(e))return t;var n=this._defaultValues[e];return this._map?this._map.get(e,n):n},Ut.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var e=this.constructor;return e._empty||(e._empty=$t(this,Ve()))},Ut.prototype.set=function(e,t){if(!this.has(e))throw new Error('Cannot set unknown key "'+e+'" on '+Bt(this));var n=this._map&&this._map.set(e,t);return this.__ownerID||n===this._map?this:$t(this,n)},Ut.prototype.remove=function(e){if(!this.has(e))return this;var t=this._map&&this._map.remove(e);return this.__ownerID||t===this._map?this:$t(this,t)},Ut.prototype.wasAltered=function(){return this._map.wasAltered()},Ut.prototype.__iterator=function(e,t){var n=this;return h(this._defaultValues).map(function(e,t){return n.get(t)}).__iterator(e,t)},Ut.prototype.__iterate=function(e,t){var n=this;return h(this._defaultValues).map(function(e,t){return n.get(t)}).__iterate(e,t)},Ut.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map&&this._map.__ensureOwner(e);return e?$t(this,t,e):(this.__ownerID=e,this._map=t,this)};var rr=Ut.prototype;rr[un]=rr.remove,rr.deleteIn=rr.removeIn=Pn.removeIn,rr.merge=Pn.merge,rr.mergeWith=Pn.mergeWith,rr.mergeIn=Pn.mergeIn,rr.mergeDeep=Pn.mergeDeep,rr.mergeDeepWith=Pn.mergeDeepWith,rr.mergeDeepIn=Pn.mergeDeepIn,rr.setIn=Pn.setIn,rr.update=Pn.update,rr.updateIn=Pn.updateIn,rr.withMutations=Pn.withMutations,rr.asMutable=Pn.asMutable,rr.asImmutable=Pn.asImmutable,e(Wt,C),Wt.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(this._step>1?" by "+this._step:"")+" ]"},Wt.prototype.get=function(e,t){return this.has(e)?this._start+a(this,e)*this._step:t},Wt.prototype.includes=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},Wt.prototype.slice=function(e,t){return u(e,t,this.size)?this:(e=c(e,this.size),t=f(t,this.size),e>=t?new Wt(0,0):new Wt(this.get(e,this._end),this.get(t,this._end),this._step))},Wt.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step==0){var n=t/this._step;if(n>=0&&n<this.size)return n}return-1},Wt.prototype.lastIndexOf=function(e){return this.indexOf(e)},Wt.prototype.__iterate=function(e,t){for(var n=this.size-1,r=this._step,i=t?this._start+n*r:this._start,o=0;n>=o;o++){if(!1===e(i,o,this))return o+1;i+=t?-r:r}return o},Wt.prototype.__iterator=function(e,t){var n=this.size-1,r=this._step,i=t?this._start+n*r:this._start,o=0;return new E(function(){var a=i;return i+=t?-r:r,o>n?w():S(e,o++,a)})},Wt.prototype.equals=function(e){return e instanceof Wt?this._start===e._start&&this._end===e._end&&this._step===e._step:Kt(this,e)};var ir;e(Vt,C),Vt.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},Vt.prototype.get=function(e,t){return this.has(e)?this._value:t},Vt.prototype.includes=function(e){return J(this._value,e)},Vt.prototype.slice=function(e,t){var n=this.size;return u(e,t,n)?this:new Vt(this._value,f(t,n)-c(e,n))},Vt.prototype.reverse=function(){return this},Vt.prototype.indexOf=function(e){return J(this._value,e)?0:-1},Vt.prototype.lastIndexOf=function(e){return J(this._value,e)?this.size:-1},Vt.prototype.__iterate=function(e,t){for(var n=0;n<this.size;n++)if(!1===e(this._value,n,this))return n+1;return n},Vt.prototype.__iterator=function(e,t){var n=this,r=0;return new E(function(){return r<n.size?S(e,r++,n._value):w()})},Vt.prototype.equals=function(e){return e instanceof Vt?J(this._value,e._value):Kt(e)};var or;d.Iterator=E,Jt(d,{toArray:function(){se(this.size);var e=new Array(this.size||0);return this.valueSeq().__iterate(function(t,n){e[n]=t}),e},toIndexedSeq:function(){return new ce(this)},toJS:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJS?e.toJS():e}).__toJS()},toJSON:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJSON?e.toJSON():e}).__toJS()},toKeyedSeq:function(){return new ue(this,!0)},toMap:function(){return qe(this.toKeyedSeq())},toObject:function(){se(this.size);var e={};return this.__iterate(function(t,n){e[n]=t}),e},toOrderedMap:function(){return wt(this.toKeyedSeq())},toOrderedSet:function(){return qt(g(this)?this.valueSeq():this)},toSet:function(){return kt(g(this)?this.valueSeq():this)},toSetSeq:function(){return new fe(this)},toSeq:function(){return y(this)?this.toIndexedSeq():g(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return At(g(this)?this.valueSeq():this)},toList:function(){return ft(g(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(e,t){return 0===this.size?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){return Te(this,Ee(this,sn.call(arguments,0)))},contains:function(e){return this.includes(e)},includes:function(e){return this.some(function(t){return J(t,e)})},entries:function(){return this.__iterator(En)},every:function(e,t){se(this.size);var n=!0;return this.__iterate(function(r,i,o){return e.call(t,r,i,o)?void 0:(n=!1,!1)}),n},filter:function(e,t){return Te(this,me(this,e,t,!0))},find:function(e,t,n){var r=this.findEntry(e,t);return r?r[1]:n},findEntry:function(e,t){var n;return this.__iterate(function(r,i,o){return e.call(t,r,i,o)?(n=[i,r],!1):void 0}),n},findLastEntry:function(e,t){return this.toSeq().reverse().findEntry(e,t)},forEach:function(e,t){return se(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){se(this.size),e=void 0!==e?""+e:",";var t="",n=!0;return this.__iterate(function(r){n?n=!1:t+=e,t+=null!==r&&void 0!==r?r.toString():""}),t},keys:function(){return this.__iterator(_n)},map:function(e,t){return Te(this,he(this,e,t))},reduce:function(e,t,n){se(this.size);var r,i;return arguments.length<2?i=!0:r=t,this.__iterate(function(t,o,a){i?(i=!1,r=t):r=e.call(n,r,t,o,a)}),r},reduceRight:function(e,t,n){var r=this.toKeyedSeq().reverse();return r.reduce.apply(r,arguments)},reverse:function(){return Te(this,pe(this,!0))},slice:function(e,t){return Te(this,ye(this,e,t,!0))},some:function(e,t){return!this.every(Yt(e),t)},sort:function(e){return Te(this,xe(this,e))},values:function(){return this.__iterator(bn)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(e,t){return o(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return ve(this,e,t)},equals:function(e){return Kt(this,e)},entrySeq:function(){var e=this;if(e._cache)return new N(e._cache);var t=e.toSeq().map(Xt).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(Yt(e),t)},findLast:function(e,t,n){return this.toKeyedSeq().reverse().find(e,t,n)},first:function(){return this.find(s)},flatMap:function(e,t){return Te(this,we(this,e,t))},flatten:function(e){return Te(this,Se(this,e,!0))},fromEntrySeq:function(){return new le(this)},get:function(e,t){return this.find(function(t,n){return J(n,e)},void 0,t)},getIn:function(e,t){for(var n,r=this,i=Re(e);!(n=i.next()).done;){var o=n.value;if((r=r&&r.get?r.get(o,dn):dn)===dn)return t}return r},groupBy:function(e,t){return ge(this,e,t)},has:function(e){return this.get(e,dn)!==dn},hasIn:function(e){return this.getIn(e,dn)!==dn},isSubset:function(e){return e="function"==typeof e.includes?e:d(e),this.every(function(t){return e.includes(t)})},isSuperset:function(e){return e.isSubset(this)},keySeq:function(){return this.toSeq().map(Qt).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},max:function(e){return Oe(this,e)},maxBy:function(e,t){return Oe(this,t,e)},min:function(e){return Oe(this,e?Zt(e):nn)},minBy:function(e,t){return Oe(this,t?Zt(t):nn,e)},rest:function(){return this.slice(1)},skip:function(e){return this.slice(Math.max(0,e))},skipLast:function(e){return Te(this,this.toSeq().reverse().skip(e).reverse())},skipWhile:function(e,t){return Te(this,be(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(Yt(e),t)},sortBy:function(e,t){return Te(this,xe(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return Te(this,this.toSeq().reverse().take(e).reverse())},takeWhile:function(e,t){return Te(this,_e(this,e,t))},takeUntil:function(e,t){return this.takeWhile(Yt(e),t)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=rn(this))}});var ar=d.prototype;ar[mn]=!0,ar[In]=ar.values,ar.__toJS=ar.toArray,ar.__toStringMapper=en,ar.inspect=ar.toSource=function(){return this.toString()},ar.chain=ar.flatMap,function(){try{Object.defineProperty(ar,"length",{get:function(){if(!d.noLengthWarning){var e;try{throw new Error}catch(t){e=t.stack}if(-1===e.indexOf("_wrapObject"))return console&&console.warn&&console.warn("iterable.length has been deprecated, use iterable.size or iterable.count(). This warning will become a silent error in a future version. "+e),this.size}}})}catch(e){}}(),Jt(h,{flip:function(){return Te(this,de(this))},findKey:function(e,t){var n=this.findEntry(e,t);return n&&n[0]},findLastKey:function(e,t){return this.toSeq().reverse().findKey(e,t)},keyOf:function(e){return this.findKey(function(t){return J(t,e)})},lastKeyOf:function(e){return this.findLastKey(function(t){return J(t,e)})},mapEntries:function(e,t){var n=this,r=0;return Te(this,this.toSeq().map(function(i,o){return e.call(t,[o,i],r++,n)}).fromEntrySeq())},mapKeys:function(e,t){var n=this;return Te(this,this.toSeq().flip().map(function(r,i){return e.call(t,r,i,n)}).flip())}});var sr=h.prototype;return sr[vn]=!0,sr[In]=ar.entries,sr.__toJS=ar.toObject,sr.__toStringMapper=function(e,t){return JSON.stringify(t)+": "+en(e)},Jt(p,{toKeyedSeq:function(){return new ue(this,!1)},filter:function(e,t){return Te(this,me(this,e,t,!1))},findIndex:function(e,t){var n=this.findEntry(e,t);return n?n[0]:-1},indexOf:function(e){var t=this.toKeyedSeq().keyOf(e);return void 0===t?-1:t},lastIndexOf:function(e){return this.toSeq().reverse().indexOf(e)},reverse:function(){return Te(this,pe(this,!1))},slice:function(e,t){return Te(this,ye(this,e,t,!1))},splice:function(e,t){var n=arguments.length;if(t=Math.max(0|t,0),0===n||2===n&&!t)return this;e=c(e,this.size);var r=this.slice(0,e);return Te(this,1===n?r:r.concat(i(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var n=this.toKeyedSeq().findLastKey(e,t);return void 0===n?-1:n},first:function(){return this.get(0)},flatten:function(e){return Te(this,Se(this,e,!1))},get:function(e,t){return e=a(this,e),0>e||this.size===1/0||void 0!==this.size&&e>this.size?t:this.find(function(t,n){return n===e},void 0,t)},has:function(e){return(e=a(this,e))>=0&&(void 0!==this.size?this.size===1/0||e<this.size:-1!==this.indexOf(e))},interpose:function(e){return Te(this,Ie(this,e))},interleave:function(){var e=[this].concat(i(arguments)),t=Ae(this.toSeq(),C.of,e),n=t.flatten(!0);return t.size&&(n.size=t.size*e.length),Te(this,n)},last:function(){return this.get(-1)},skipWhile:function(e,t){return Te(this,be(this,e,t,!1))},zip:function(){return Te(this,Ae(this,tn,[this].concat(i(arguments))))},zipWith:function(e){var t=i(arguments);return t[0]=this,Te(this,Ae(this,e,t))}}),p.prototype[gn]=!0,p.prototype[yn]=!0,Jt(m,{get:function(e,t){return this.has(e)?e:t},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}}),m.prototype.has=ar.includes,Jt(L,h.prototype),Jt(C,p.prototype),Jt(k,m.prototype),Jt(K,h.prototype),Jt(W,p.prototype),Jt(V,m.prototype),{Iterable:d,Seq:T,Collection:G,Map:qe,OrderedMap:wt,List:ft,Stack:At,Set:kt,OrderedSet:qt,Record:Ut,Range:Wt,Repeat:Vt,is:J,fromJS:Q}}),define("plugins/core/formatters/html/enforce-p-elements",["immutable"],function(e){"use strict";return function(){return function(t){function n(t){var n=0;e.List(t.childNodes).filterNot(function(e){return i.isWhitespaceOnlyTextNode(Node,e)}).filter(function(e){return e.nodeType===Node.TEXT_NODE||!i.isBlockElement(e)}).groupBy(function(e,t,r){return 0===t||e.previousSibling===r.get(t-1)?n:n+=1}).forEach(function(e){i.wrap(e.toArray(),document.createElement("p"))})}function r(e){for(var t,r=0;t=e.children[r++];)"BLOCKQUOTE"===t.tagName&&n(t)}var i=t.node;t.registerHTMLFormatter("normalize",function(e){var t=document.createElement("div");return t.innerHTML=e,n(t),r(t),t.innerHTML})}}}),define("constants/inline-element-names",["immutable"],function(e){return e.Set.of("B","BIG","I","SMALL","TT","ABBR","ACRONYM","CITE","CODE","DFN","EM","KBD","STRONG","SAMP","VAR","A","BDO","BR","IMG","MAP","OBJECT","Q","SCRIPT","SPAN","SUB","SUP","BUTTON","INPUT","LABEL","SELECT","TEXTAREA")}),define("constants/block-element-names",["immutable"],function(e){return e.Set.of("ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","CANVAS","DD","DIV","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TD","TH","TFOOT","UL","VIDEO")}),define("node",["./constants/inline-element-names","./constants/block-element-names","immutable"],function(e,t,n){"use strict";function r(e){return t.includes(e.nodeName)}function i(t){return e.includes(t.nodeName)}function o(e){return!(e.children.length>1)&&((1!==e.children.length||""===e.textContent.trim())&&(0===e.children.length?""===e.textContent.trim():o(e.children[0])))}function a(e){return e.nodeType===Node.TEXT_NODE}function s(e){return a(e)&&""===e.data}function u(e){return e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function c(e,t){return e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING}function f(e,t){return function(n){return n.nodeType===e.ELEMENT_NODE&&n.className===t}}function l(e){return f(Node,"scribe-marker")(e)}function d(e){return f(Node,"caret-position")(e)}function h(e,t){return!(t.nodeType!==e.TEXT_NODE||!/^\s*$/.test(t.nodeValue))}function p(e){var t=e.firstChild;return t&&"BR"!==t.nodeName?p(t):e}function m(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}function v(e){return e.parentNode.removeChild(e)}function g(e,t,n){function r(e){return t===e}if(!r(e))for(var i=e.parentNode;i&&!r(i);){if(n(i))return i;i=i.parentNode}}function y(e){for(var t=n.List();e=e.nextSibling;)t=t.push(e);return t}function _(e,t){return e[0].parentNode.insertBefore(t,e[0]),e.forEach(function(e){t.appendChild(e)}),t}function b(e,t){for(;t.childNodes.length>0;)e.insertBefore(t.childNodes[0],t);e.removeChild(t)}function E(t){function r(e,t){return window.getComputedStyle(t).lineHeight===e.lineHeight}var i=n.List(t.querySelectorAll(e.map(function(e){return e+'[style*="line-height"]'}).join(",")));i=i.filter(r.bind(null,window.getComputedStyle(t)));var o=n.List();i.forEach(function(e){e.style.lineHeight=null,e.getAttribute("style")||e.removeAttribute("style"),"SPAN"===e.nodeName&&0===e.attributes.length&&(o=o.push(e))}),o.forEach(function(e){b(e.parentNode,e)})}return{isInlineElement:i,isBlockElement:r,isEmptyInlineElement:o,isText:a,isEmptyTextNode:s,isWhitespaceOnlyTextNode:h,isFragment:u,isBefore:c,isSelectionMarkerNode:l,isCaretPositionNode:d,
firstDeepestChild:p,insertAfter:m,removeNode:v,getAncestor:g,nextSiblings:y,wrap:_,unwrap:b,removeChromeArtifacts:E,elementHasClass:f}}),define("plugins/core/formatters/html/ensure-selectable-containers",["../../../../node","immutable"],function(e,t){"use strict";function n(t){return!!e.isCaretPositionNode(t)||""===t.parentNode.textContent.trim()}function r(t){for(var o=t.firstElementChild;o;)e.isSelectionMarkerNode(o)||(function(t){return!!(0===t.children.length&&e.isBlockElement(t)||1===t.children.length&&e.isSelectionMarkerNode(t.children[0]))||!e.isBlockElement(t)&&0===t.children.length&&n(t)}(o)&&""===o.textContent.trim()&&!i.includes(o.nodeName)?o.appendChild(document.createElement("br")):o.children.length>0&&r(o)),o=o.nextElementSibling}var i=t.Set.of("AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR");return function(){return function(e){e.registerHTMLFormatter("normalize",function(e){var t=document.createElement("div");return t.innerHTML=e,r(t),t.innerHTML})}}}),define("plugins/core/inline-elements-mode",[],function(){"use strict";function e(e){for(var t=document.createTreeWalker(e,NodeFilter.SHOW_ALL,null,!1);t.nextNode();)if(t.currentNode&&(~["br"].indexOf(t.currentNode.nodeName.toLowerCase())||t.currentNode.length>0))return!0;return!1}return function(){return function(t){t.el.addEventListener("keydown",function(n){if(13===n.keyCode){var r=new t.api.Selection,i=r.range;r.getContaining(function(e){return"LI"===e.nodeName||/^(H[1-6])$/.test(e.nodeName)})||(n.preventDefault(),t.transactionManager.run(function(){"BR"===t.el.lastChild.nodeName&&t.el.removeChild(t.el.lastChild);var n=document.createElement("br");i.insertNode(n),i.collapse(!1);var o=i.cloneRange();if(o.setEndAfter(t.el.lastChild,0),!e(o.cloneContents())){var a=document.createElement("br");i.insertNode(a)}var s=i.cloneRange();s.setStartAfter(n,0),s.setEndAfter(n,0),r.selection.removeAllRanges(),r.selection.addRange(s)}))}}.bind(this)),""===t.getHTML().trim()&&t.setContent("")}}}),define("plugins/core/plugins",["./set-root-p-element","./formatters/html/enforce-p-elements","./formatters/html/ensure-selectable-containers","./inline-elements-mode"],function(e,t,n,r){"use strict";return{setRootPElement:e,enforcePElements:t,ensureSelectableContainers:n,inlineElementsMode:r}}),define("plugins/core/commands/indent",[],function(){"use strict";return function(){return function(e){var t=new e.api.Command("indent");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!n},e.commands.indent=t}}}),define("plugins/core/commands/insert-list",["immutable"],function(e){"use strict";return function(){return function(t){var n=t.node,r=function(e){t.api.Command.call(this,e)};r.prototype=Object.create(t.api.Command.prototype),r.prototype.constructor=r,r.prototype.execute=function(r){function i(e){if(e.size){for(var t=document.createElement(s.nodeName);e.size;)t.appendChild(e.first()),e=e.shift();s.parentNode.insertBefore(t,s.nextElementSibling)}}if(this.queryState()){var o=new t.api.Selection,a=o.range,s=o.getContaining(function(e){return"OL"===e.nodeName||"UL"===e.nodeName}),u=o.getContaining(function(e){return"LI"===e.nodeName});t.transactionManager.run(function(){if(u){i(n.nextSiblings(u)),o.placeMarkers();var t=document.createElement("p");t.innerHTML=u.innerHTML,s.parentNode.insertBefore(t,s.nextElementSibling),u.parentNode.removeChild(u)}else{var r=e.List(s.querySelectorAll("li")).filter(function(e){return a.intersectsNode(e)}),c=r.last();i(n.nextSiblings(c)),o.placeMarkers();var f=document.createDocumentFragment();r.forEach(function(e){var t=document.createElement("p");t.innerHTML=e.innerHTML,f.appendChild(t)}),s.parentNode.insertBefore(f,s.nextElementSibling),r.forEach(function(e){e.parentNode.removeChild(e)})}0===s.childNodes.length&&s.parentNode.removeChild(s),o.selectMarkers()}.bind(this))}else t.api.Command.prototype.execute.call(this,r)},r.prototype.queryEnabled=function(){return t.api.Command.prototype.queryEnabled.call(this)&&t.allowsBlockElements()},t.commands.insertOrderedList=new r("insertOrderedList"),t.commands.insertUnorderedList=new r("insertUnorderedList")}}}),define("plugins/core/commands/outdent",[],function(){"use strict";return function(){return function(e){var t=new e.api.Command("outdent");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!n},e.commands.outdent=t}}}),define("plugins/core/commands/redo",[],function(){"use strict";return function(){return function(e){var t=new e.api.Command("redo");t.execute=function(){e.undoManager.redo()},t.queryEnabled=function(){return e.undoManager.position>0},e.commands.redo=t,e.options.undo.enabled&&e.el.addEventListener("keydown",function(e){e.shiftKey&&(e.metaKey||e.ctrlKey)&&90===e.keyCode&&(e.preventDefault(),t.execute())})}}}),define("plugins/core/commands/subscript",[],function(){"use strict";return function(){return function(e){var t=new e.api.Command("subscript");e.commands.subscript=t}}}),define("plugins/core/commands/superscript",[],function(){"use strict";return function(){return function(e){var t=new e.api.Command("superscript");e.commands.superscript=t}}}),define("plugins/core/commands/undo",[],function(){"use strict";return function(){return function(e){var t=new e.api.Command("undo");t.execute=function(){e.undoManager.undo()},t.queryEnabled=function(){return e.undoManager.position<e.undoManager.length},e.commands.undo=t,e.options.undo.enabled&&e.el.addEventListener("keydown",function(e){e.shiftKey||!e.metaKey&&!e.ctrlKey||90!==e.keyCode||(e.preventDefault(),t.execute())})}}}),define("plugins/core/commands",["./commands/indent","./commands/insert-list","./commands/outdent","./commands/redo","./commands/subscript","./commands/superscript","./commands/undo"],function(e,t,n,r,i,o,a){"use strict";return{indent:e,insertList:t,outdent:n,redo:r,subscript:i,superscript:o,undo:a}}),define("plugins/core/formatters/html/replace-nbsp-chars",[],function(){"use strict";return function(){return function(e){var t=/(\s|&nbsp;)+/g;e.registerHTMLFormatter("export",function(e){return e.replace(t," ")})}}}),define("lodash-amd/modern/internal/baseToString",[],function(){function e(e){return"string"==typeof e?e:null==e?"":e+""}return e}),define("lodash-amd/modern/internal/escapeHtmlChar",[],function(){function e(e){return t[e]}var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};return e}),define("lodash-amd/modern/string/escape",["../internal/baseToString","../internal/escapeHtmlChar"],function(e,t){function n(n){return n=e(n),n&&i.test(n)?n.replace(r,t):n}var r=/[&<>"'`]/g,i=RegExp(r.source);return n}),define("plugins/core/formatters/plain-text/escape-html-characters",["lodash-amd/modern/string/escape"],function(e){"use strict";return function(){return function(t){t.registerPlainTextFormatter(e)}}}),define("plugins/core/formatters",["./formatters/html/replace-nbsp-chars","./formatters/plain-text/escape-html-characters"],function(e,t){"use strict";return{replaceNbspCharsFormatter:e,escapeHtmlCharactersFormatter:t}}),define("mutations",[],function(){function e(e){return void 0===e?function(){return{observe:function(){}}}:e.MutationObserver||e.WebKitMutationObserver||e.MozMutationObserver}return{determineMutationObserver:e}}),define("dom-observer",["./node","./mutations"],function(e,t){function n(t){return!e.isEmptyTextNode(t)&&!e.isSelectionMarkerNode(t)}function r(e){return e.some(function(e){return Array.prototype.some.call(e.addedNodes,n)||Array.prototype.some.call(e.removedNodes,n)})}function i(e,t){var n=!1,i=new a(function(e){if(!n&&r(e)){n=!0;try{t()}catch(e){throw e}finally{setTimeout(function(){n=!1},0)}}});return i.observe(e,{childList:!0,subtree:!0}),i}var o="object"==typeof window?window:void 0,a=t.determineMutationObserver(o);return i}),define("plugins/core/events",["../../dom-observer","immutable"],function(e,t){"use strict";return function(){return function(n){var r=n.node;n.el.addEventListener("focus",function(){var e=new n.api.Selection;if(e.range){if(n.allowsBlockElements()&&e.range.startContainer===n.el){var t=r.firstDeepestChild(n.el),i=e.range;i.setStart(t,0),i.setEnd(t,0),e.selection.removeAllRanges(),e.selection.addRange(i)}}}.bind(n));var i=function(){if(!n._skipFormatters){var e=new n.api.Selection,t=e.range,r=function(){t&&e.placeMarkers(),n.setHTML(n._htmlFormatterFactory.format(n.getHTML())),e.selectMarkers()}.bind(n);n.transactionManager.run(r)}delete n._skipFormatters}.bind(n);e(n.el,i),n.allowsBlockElements()&&n.el.addEventListener("keydown",function(e){if(13===e.keyCode){var t=new n.api.Selection,r=t.range,i=t.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});if(i&&r.collapsed){var o=r.cloneRange();o.setEndAfter(i,0);""===o.cloneContents().firstChild.textContent&&(e.preventDefault(),n.transactionManager.run(function(){var e=document.createElement("p"),n=document.createElement("br");e.appendChild(n),i.parentNode.insertBefore(e,i.nextElementSibling),r.setStart(e,0),r.setEnd(e,0),t.selection.removeAllRanges(),t.selection.addRange(r)}))}}}),n.allowsBlockElements()&&n.el.addEventListener("keydown",function(e){if(13===e.keyCode||8===e.keyCode){var t=new n.api.Selection;if(t.range.collapsed){var r=t.getContaining(function(e){return"LI"===e.nodeName});if(r&&""===r.textContent.trim()){e.preventDefault();var i=t.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName}),o=n.getCommand("OL"===i.nodeName?"insertOrderedList":"insertUnorderedList");o.event=e,o.execute()}}}}),n.el.addEventListener("paste",function(e){if(e.clipboardData&&e.clipboardData.types.length>0)e.preventDefault(),t.List(e.clipboardData.types).includes("text/html")?n.insertHTML(e.clipboardData.getData("text/html")):n.insertPlainText(e.clipboardData.getData("text/plain"));else{var r=new n.api.Selection;r.placeMarkers();var i=document.createElement("div");document.body.appendChild(i),i.setAttribute("contenteditable",!0),i.focus(),setTimeout(function(){var e=i.innerHTML;i.parentNode.removeChild(i),r.selectMarkers(),n.el.focus(),n.insertHTML(e)},1)}})}}}),define("plugins/core/patches/commands/bold",[],function(){"use strict";return function(){return function(e){var t=new e.api.CommandPatch("bold");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});return e.api.CommandPatch.prototype.queryEnabled.apply(this,arguments)&&!n},e.commandPatches.bold=t}}}),define("plugins/core/patches/commands/indent",[],function(){"use strict";return function(){return function(e){var t=new e.api.CommandPatch("indent");t.execute=function(t){e.transactionManager.run(function(){var n=new e.api.Selection,r=n.range;if("P"===r.commonAncestorContainer.nodeName&&"<br>"===r.commonAncestorContainer.innerHTML){var i=document.createTextNode("\ufeff");r.insertNode(i),r.setStart(i,0),r.setEnd(i,0),n.selection.removeAllRanges(),n.selection.addRange(r)}e.api.CommandPatch.prototype.execute.call(this,t),n=new e.api.Selection;var o=n.getContaining(function(e){return"BLOCKQUOTE"===e.nodeName});o&&o.removeAttribute("style")}.bind(this))},e.commandPatches.indent=t}}}),define("plugins/core/patches/commands/insert-html",[],function(){"use strict";return function(){return function(e){var t=new e.api.CommandPatch("insertHTML"),n=e.node;t.execute=function(t){e.transactionManager.run(function(){e.api.CommandPatch.prototype.execute.call(this,t),n.removeChromeArtifacts(e.el)}.bind(this))},e.commandPatches.insertHTML=t}}}),define("plugins/core/patches/commands/insert-list",[],function(){"use strict";return function(){return function(e){var t=e.node,n=function(t){e.api.CommandPatch.call(this,t)};n.prototype=Object.create(e.api.CommandPatch.prototype),n.prototype.constructor=n,n.prototype.execute=function(n){e.transactionManager.run(function(){if(e.api.CommandPatch.prototype.execute.call(this,n),this.queryState()){var r=new e.api.Selection,i=r.getContaining(function(e){return"OL"===e.nodeName||"UL"===e.nodeName});if(i.nextElementSibling&&0===i.nextElementSibling.childNodes.length&&t.removeNode(i.nextElementSibling),i){var o=i.parentNode;o&&/^(H[1-6]|P)$/.test(o.nodeName)&&(r.placeMarkers(),t.insertAfter(i,o),r.selectMarkers(),2===o.childNodes.length&&t.isEmptyTextNode(o.firstChild)&&t.removeNode(o),0===o.childNodes.length&&t.removeNode(o))}t.removeChromeArtifacts(i)}}.bind(this))},n.prototype.queryState=function(){try{return e.api.CommandPatch.prototype.queryState.apply(this,arguments)}catch(e){if("NS_ERROR_UNEXPECTED"==e.name)return!1;throw e}},e.commandPatches.insertOrderedList=new n("insertOrderedList"),e.commandPatches.insertUnorderedList=new n("insertUnorderedList")}}}),define("plugins/core/patches/commands/outdent",[],function(){"use strict";return function(){return function(e){var t=e.node,n=new e.api.CommandPatch("outdent");n.execute=function(){e.transactionManager.run(function(){var n=new e.api.Selection,r=n.range,i=n.getContaining(function(e){return"BLOCKQUOTE"===e.nodeName});if("BLOCKQUOTE"===r.commonAncestorContainer.nodeName){n.placeMarkers(),n.selectMarkers(!0);var o=r.cloneContents();i.parentNode.insertBefore(o,i),r.deleteContents(),n.selectMarkers(),""===i.textContent&&i.parentNode.removeChild(i)}else{var a=n.getContaining(function(e){return"P"===e.nodeName});if(a){var s=t.nextSiblings(a);if(s.size){for(var u=document.createElement(i.nodeName);s.size;)u.appendChild(s.first()),s=s.shift();i.parentNode.insertBefore(u,i.nextElementSibling)}n.placeMarkers(),i.parentNode.insertBefore(a,i.nextElementSibling),n.selectMarkers(),""===i.innerHTML&&i.parentNode.removeChild(i)}else e.api.CommandPatch.prototype.execute.call(this)}}.bind(this))},e.commandPatches.outdent=n}}}),define("plugins/core/patches/commands/create-link",[],function(){"use strict";return function(){return function(e){var t=new e.api.CommandPatch("createLink");e.commandPatches.createLink=t,t.execute=function(t){var n=new e.api.Selection;if(n.range.collapsed){var r=document.createElement("a");r.setAttribute("href",t),r.textContent=t,n.range.insertNode(r);var i=document.createRange();i.setStartBefore(r),i.setEndAfter(r),n.selection.removeAllRanges(),n.selection.addRange(i)}else e.api.CommandPatch.prototype.execute.call(this,t)}}}}),define("plugins/core/patches/events",[],function(){"use strict";return function(){return function(e){var t=e.node;e.allowsBlockElements()&&e.el.addEventListener("keyup",function(n){if(8===n.keyCode||46===n.keyCode){var r=new e.api.Selection,i=r.getContaining(function(e){return"P"===e.nodeName});i&&e.transactionManager.run(function(){r.placeMarkers(),t.removeChromeArtifacts(i),r.selectMarkers()},!0)}})}}}),define("plugins/core/patches",["./patches/commands/bold","./patches/commands/indent","./patches/commands/insert-html","./patches/commands/insert-list","./patches/commands/outdent","./patches/commands/create-link","./patches/events"],function(e,t,n,r,i,o,a){"use strict";return{commands:{bold:e,indent:t,insertHTML:n,insertList:r,outdent:i,createLink:o},events:a}}),define("api/command-patch",[],function(){"use strict";return function(e){function t(e){this.commandName=e}return t.prototype.execute=function(t){e.transactionManager.run(function(){document.execCommand(this.commandName,!1,t||null)}.bind(this))},t.prototype.queryState=function(){return document.queryCommandState(this.commandName)},t.prototype.queryEnabled=function(){return document.queryCommandEnabled(this.commandName)},t}}),define("api/command",[],function(){"use strict";return function(e){function t(t){this.commandName=t,this.patch=e.commandPatches[this.commandName]}return t.prototype.execute=function(t){this.patch?this.patch.execute(t):e.transactionManager.run(function(){document.execCommand(this.commandName,!1,t||null)}.bind(this))},t.prototype.queryState=function(){return this.patch?this.patch.queryState():document.queryCommandState(this.commandName)},t.prototype.queryEnabled=function(){return this.patch?this.patch.queryEnabled():document.queryCommandEnabled(this.commandName)},t}}),define("api/selection",[],function(){"use strict";return function(e){function t(){var e=document.createElement("em");return e.style.display="none",e.classList.add("scribe-marker"),e}function n(e,t){e.insertNode(t),t.nextSibling&&o.isEmptyTextNode(t.nextSibling)&&o.removeNode(t.nextSibling),t.previousSibling&&o.isEmptyTextNode(t.previousSibling)&&o.removeNode(t.previousSibling)}function r(){if(this.selection=i.getSelection(),this.selection.rangeCount&&this.selection.anchorNode){var e=this.selection.anchorNode,t=this.selection.anchorOffset,n=this.selection.focusNode,r=this.selection.focusOffset;if(e===n&&t>r){var a=t;t=r,r=a}else if(o.isBefore(n,e)){var s=e,u=t;e=n,t=r,n=s,r=u}this.range=document.createRange(),this.range.setStart(e,t),this.range.setEnd(n,r)}}var i=e.el.ownerDocument,o=e.node;if(i.compareDocumentPosition(e.el)&Node.DOCUMENT_POSITION_DISCONNECTED){for(var a=e.el.parentNode;a&&o.isFragment(a);)a=a.parentNode;a&&a.getSelection&&(i=a)}return r.prototype.getContaining=function(t){if(this.range){var n=this.range.commonAncestorContainer;return n&&e.el===n||!t(n)?o.getAncestor(n,e.el,t):n}},r.prototype.placeMarkers=function(){var r=this.range;if(r&&document.contains(e.el)&&e.el.contains(r.startContainer)&&e.el.contains(r.endContainer)){if(n(r.cloneRange(),t()),!r.collapsed){var i=r.cloneRange();i.collapse(!1),n(i,t())}this.selection.removeAllRanges(),this.selection.addRange(r)}},r.prototype.getMarkers=function(){return e.el.querySelectorAll("em.scribe-marker")},r.prototype.removeMarkers=function(){Array.prototype.forEach.call(this.getMarkers(),function(e){var t=e.parentNode;o.removeNode(e),t.normalize()})},r.prototype.selectMarkers=function(e){var t=this.getMarkers();if(t.length){var n=document.createRange();n.setStartBefore(t[0]),n.setEndAfter(t.length>=2?t[1]:t[0]),e||this.removeMarkers(),this.selection.removeAllRanges(),this.selection.addRange(n)}},r.prototype.isCaretOnNewLine=function(){var e=this.getContaining(function(e){return"P"===e.nodeName});return!!e&&o.isEmptyInlineElement(e)},r}}),define("api/simple-command",[],function(){"use strict";return function(e,t){function n(e,n){t.api.Command.call(this,e),this._nodeName=n}return n.prototype=Object.create(e.Command.prototype),n.prototype.constructor=n,n.prototype.queryState=function(){var e=new t.api.Selection;return t.api.Command.prototype.queryState.call(this)&&!!e.getContaining(function(e){return e.nodeName===this._nodeName}.bind(this))},n}}),define("api",["./api/command-patch","./api/command","./api/selection","./api/simple-command"],function(e,t,n,r){"use strict";return function(i){this.CommandPatch=e(i),this.Command=t(i),this.Selection=n(i),this.SimpleCommand=r(this,i)}}),define("lodash-amd/modern/internal/baseCopy",[],function(){function e(e,t,n){n||(n=t,t={});for(var r=-1,i=n.length;++r<i;){var o=n[r];t[o]=e[o]}return t}return e}),define("lodash-amd/modern/internal/isLength",[],function(){function e(e){return"number"==typeof e&&e>-1&&e%1==0&&t>=e}var t=Math.pow(2,53)-1;return e}),define("lodash-amd/modern/string/escapeRegExp",["../internal/baseToString"],function(e){function t(t){return t=e(t),t&&r.test(t)?t.replace(n,"\\$&"):t}var n=/[.*+?^${}()|[\]\/\\]/g,r=RegExp(n.source);return t}),define("lodash-amd/modern/internal/isObjectLike",[],function(){function e(e){return e&&"object"==typeof e||!1}return e}),define("lodash-amd/modern/lang/isNative",["../string/escapeRegExp","../internal/isObjectLike"],function(e,t){function n(e){return null!=e&&(s.call(e)==r?u.test(a.call(e)):t(e)&&i.test(e)||!1)}var r="[object Function]",i=/^\[object .+?Constructor\]$/,o=Object.prototype,a=Function.prototype.toString,s=o.toString,u=RegExp("^"+e(s).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return n}),define("lodash-amd/modern/lang/isObject",[],function(){function e(e){var t=typeof e;return"function"==t||e&&"object"==t||!1}return e}),define("lodash-amd/modern/lang/isArguments",["../internal/isLength","../internal/isObjectLike"],function(e,t){function n(n){var o=t(n)?n.length:r;return e(o)&&a.call(n)==i||!1}var r,i="[object Arguments]",o=Object.prototype,a=o.toString;return n}),define("lodash-amd/modern/lang/isArray",["../internal/isLength","./isNative","../internal/isObjectLike"],function(e,t,n){var r=Object.prototype,i=r.toString,o=t(o=Array.isArray)&&o;return o||function(t){return n(t)&&e(t.length)&&"[object Array]"==i.call(t)||!1}}),define("lodash-amd/modern/internal/isIndex",[],function(){function e(e,n){return e=+e,n=null==n?t:n,e>-1&&e%1==0&&n>e}var t=Math.pow(2,53)-1;return e}),define("lodash-amd/modern/internal/root",[],function(){var e={function:!0,object:!0},t=e[typeof exports]&&exports&&!exports.nodeType&&exports,n=e[typeof module]&&module&&!module.nodeType&&module,r=t&&n&&"object"==typeof global&&global,i=e[typeof window]&&window;return r||i!==(this&&this.window)&&i||this}),define("lodash-amd/modern/support",["./lang/isNative","./internal/root"],function(e,t){var n=/\bthis\b/,r=Object.prototype,i=(i=t.window)&&i.document,o=r.propertyIsEnumerable,a={};return function(r){a.funcDecomp=!e(t.WinRTError)&&n.test(function(){return this}),a.funcNames="string"==typeof Function.name;try{a.dom=11===i.createDocumentFragment().nodeType}catch(e){a.dom=!1}try{a.nonEnumArgs=!o.call(arguments,1)}catch(e){a.nonEnumArgs=!0}}(0,0),a}),define("lodash-amd/modern/object/keysIn",["../lang/isArguments","../lang/isArray","../internal/isIndex","../internal/isLength","../lang/isObject","../support"],function(e,t,n,r,i,o){function a(a){if(null==a)return[];i(a)||(a=Object(a));var s=a.length;s=s&&r(s)&&(t(a)||o.nonEnumArgs&&e(a))&&s||0;for(var c=a.constructor,f=-1,l="function"==typeof c&&c.prototype===a,d=Array(s),h=s>0;++f<s;)d[f]=f+"";for(var p in a)h&&n(p,s)||"constructor"==p&&(l||!u.call(a,p))||d.push(p);return d}var s=Object.prototype,u=s.hasOwnProperty;return a}),define("lodash-amd/modern/internal/shimKeys",["../lang/isArguments","../lang/isArray","./isIndex","./isLength","../object/keysIn","../support"],function(e,t,n,r,i,o){function a(a){for(var s=i(a),c=s.length,f=c&&a.length,l=f&&r(f)&&(t(a)||o.nonEnumArgs&&e(a)),d=-1,h=[];++d<c;){var p=s[d];(l&&n(p,f)||u.call(a,p))&&h.push(p)}return h}var s=Object.prototype,u=s.hasOwnProperty;return a}),define("lodash-amd/modern/object/keys",["../internal/isLength","../lang/isNative","../lang/isObject","../internal/shimKeys"],function(e,t,n,r){var i=t(i=Object.keys)&&i;return i?function(t){if(t)var o=t.constructor,a=t.length;return"function"==typeof o&&o.prototype===t||"function"!=typeof t&&a&&e(a)?r(t):n(t)?i(t):[]}:r}),define("lodash-amd/modern/internal/baseAssign",["./baseCopy","../object/keys"],function(e,t){function n(n,r,i){var o=t(r);if(!i)return e(r,n,o);for(var a=-1,s=o.length;++a<s;){var u=o[a],c=n[u],f=i(c,r[u],u,n,r);(f===f?f===c:c!==c)&&(void 0!==c||u in n)||(n[u]=f)}return n}return n}),define("lodash-amd/modern/utility/identity",[],function(){function e(e){return e}return e}),define("lodash-amd/modern/internal/bindCallback",["../utility/identity"],function(e){function t(t,n,r){if("function"!=typeof t)return e;if(void 0===n)return t;switch(r){case 1:return function(e){return t.call(n,e)};case 3:return function(e,r,i){return t.call(n,e,r,i)};case 4:return function(e,r,i,o){return t.call(n,e,r,i,o)};case 5:return function(e,r,i,o,a){return t.call(n,e,r,i,o,a)}}return function(){return t.apply(n,arguments)}}return t}),define("lodash-amd/modern/internal/isIterateeCall",["./isIndex","./isLength","../lang/isObject"],function(e,t,n){function r(r,i,o){if(!n(o))return!1;var a=typeof i;if("number"==a)var s=o.length,u=t(s)&&e(i,s);else u="string"==a&&i in o;if(u){var c=o[i];return r===r?r===c:c!==c}return!1}return r}),define("lodash-amd/modern/internal/createAssigner",["./bindCallback","./isIterateeCall"],function(e,t){function n(n){return function(){var r=arguments,i=r.length,o=r[0];if(2>i||null==o)return o;var a=r[i-2],s=r[i-1],u=r[3];i>3&&"function"==typeof a?(a=e(a,s,5),i-=2):(a=i>2&&"function"==typeof s?s:null,i-=a?1:0),u&&t(r[1],r[2],u)&&(a=3==i?null:a,i=2);for(var c=0;++c<i;){var f=r[c];f&&n(o,f,a)}return o}}return n}),define("lodash-amd/modern/object/assign",["../internal/baseAssign","../internal/createAssigner"],function(e,t){return t(e)}),define("transaction-manager",["lodash-amd/modern/object/assign"],function(e){"use strict";return function(t){function n(){this.history=[]}return e(n.prototype,{start:function(){this.history.push(1)},end:function(){this.history.pop(),0===this.history.length&&(t.pushHistory(),t.trigger("content-changed"))},run:function(e,n){this.start();try{e&&e()}finally{t._forceMerge=!0===n,this.end(),t._forceMerge=!1}}}),n}}),define("undo-manager",["immutable"],function(e){"use strict";function t(t,n){this._stack=e.List(),this._limit=t,this._fireEvent="undefined"!=typeof CustomEvent&&n&&n.dispatchEvent,this._ush=n,this.position=0,this.length=0}return t.prototype.transact=function(t,n){if(arguments.length<2)throw new TypeError("Not enough arguments to UndoManager.transact.");t.execute(),this.position>0&&this.clearRedo();var r;n&&this.length?(r=this._stack.first().push(t),this._stack=this._stack.shift().unshift(r)):(r=e.List.of(t),this._stack=this._stack.unshift(r),this.length++,this._limit&&this.length>this._limit&&this.clearUndo(this._limit)),this._dispatch("DOMTransaction",r)},t.prototype.undo=function(){if(!(this.position>=this.length)){for(var e=this._stack.get(this.position),t=e.size;t--;)e.get(t).undo();this.position++,this._dispatch("undo",e)}},t.prototype.redo=function(){if(0!==this.position){this.position--;for(var e=this._stack.get(this.position),t=0;t<e.size;t++)e.get(t).redo();this._dispatch("redo",e)}},t.prototype.item=function(e){return e>=0&&e<this.length?this._stack.get(e).toArray():null},t.prototype.clearUndo=function(e){this._stack=this._stack.take(void 0!==e?e:this.position),this.length=this._stack.size},t.prototype.clearRedo=function(){this._stack=this._stack.skip(this.position),this.length=this._stack.size,this.position=0},t.prototype._dispatch=function(e,t){this._fireEvent&&this._ush.dispatchEvent(new CustomEvent(e,{detail:{transactions:t.toArray()},bubbles:!0,cancelable:!1}))},t}),define("event-emitter",["immutable"],function(e){"use strict";function t(){this._listeners={}}return t.prototype.on=function(t,n){var r=this._listeners[t]||e.Set();this._listeners[t]=r.add(n)},t.prototype.off=function(t,n){var r=this._listeners[t]||e.Set();this._listeners[t]=n?r.delete(n):r.clear()},t.prototype.trigger=function(t,n){for(var r=t.split(":");r.length;){var i=r.join(":");(this._listeners[i]||e.Set()).forEach(function(e){e.apply(null,n)}),r.splice(r.length-1,1)}},t}),define("config",["immutable"],function(e){function t(t,n){const r=e.fromJS(t);return e.fromJS(n).merge(r).toJS()}function n(e){var n=e||{};return n.defaultPlugins&&(n.defaultPlugins=n.defaultPlugins.filter(o(u.defaultPlugins))),n.defaultFormatters&&(n.defaultFormatters=n.defaultFormatters.filter(o(u.defaultFormatters))),Object.freeze(t(n,u))}function r(e){return function(t,n){return t===e?-1:n===e?1:0}}function i(e){return function(t){return-1!==(e?a:s).indexOf(t)}}function o(e){return function(t){return-1!==e.indexOf(t)}}var a=["setRootPElement","enforcePElements","ensureSelectableContainers"],s=["inlineElementsMode"],u={allowBlockElements:!0,debug:!1,undo:{manager:!1,enabled:!0,limit:100,interval:250},defaultCommandPatches:["bold","indent","insertHTML","insertList","outdent","createLink"],defaultPlugins:a.concat(s),defaultFormatters:["escapeHtmlCharactersFormatter","replaceNbspCharsFormatter"]};return{defaultOptions:u,checkOptions:n,sortByPlugin:r,filterByBlockLevelMode:i,filterByPluginExists:o}}),define("scribe",["./plugins/core/plugins","./plugins/core/commands","./plugins/core/formatters","./plugins/core/events","./plugins/core/patches","./api","./transaction-manager","./undo-manager","./event-emitter","./node","immutable","./config"],function(e,t,n,r,i,o,a,s,u,c,f,l){"use strict";function d(c,d){u.call(this),this.el=c,this.commands={},this.options=l.checkOptions(d),this.commandPatches={},this._plainTextFormatterFactory=new h,this._htmlFormatterFactory=new p,this.api=new o(this),this.Immutable=f;var m=a(this);this.transactionManager=new m,this.undoManager=!1,this.options.undo.enabled&&(this.options.undo.manager?this.undoManager=this.options.undo.manager:this.undoManager=new s(this.options.undo.limit,this.el),this._merge=!1,this._forceMerge=!1,this._mergeTimer=0,this._lastItem={content:""}),this.setHTML(this.getHTML()),this.el.setAttribute("contenteditable",!0),this.el.addEventListener("input",function(){this.transactionManager.run()}.bind(this),!1);var v=f.OrderedSet(this.options.defaultPlugins).sort(l.sortByPlugin("setRootPElement")).filter(l.filterByBlockLevelMode(this.allowsBlockElements())).map(function(t){return e[t]}),g=f.List(this.options.defaultFormatters).filter(function(e){return!!n[e]}).map(function(e){return n[e]}),y=f.List.of(i.events),_=f.List(this.options.defaultCommandPatches).map(function(e){return i.commands[e]}),b=f.List.of("indent","insertList","outdent","redo","subscript","superscript","undo").map(function(e){return t[e]});f.List().concat(v,g,y,_,b).forEach(function(e){this.use(e())}.bind(this)),this.use(r())}function h(){this.formatters=f.List()}function p(){this.formatters={sanitize:f.List(),normalize:f.List(),export:f.List()}}return d.prototype=Object.create(u.prototype),d.prototype.node=c,d.prototype.element=d.prototype.node,d.prototype.use=function(e){return e(this),this},d.prototype.setHTML=function(e,t){this.options.undo.enabled&&(this._lastItem.content=e),t&&(this._skipFormatters=!0),this.el.innerHTML!==e&&(this.el.innerHTML=e)},d.prototype.getHTML=function(){return this.el.innerHTML},d.prototype.getContent=function(){return this._htmlFormatterFactory.formatForExport(this.getHTML().replace(/<br>$/,""))},d.prototype.getTextContent=function(){return this.el.textContent},d.prototype.pushHistory=function(){var e=this;if(e.options.undo.enabled){var t=e._lastItem.content.replace(/<em [^>]*class="scribe-marker"[^>]*>[^<]*?<\/em>/g,"");if(e.getHTML()!==t){var n=new e.api.Selection;n.placeMarkers();var r=e.getHTML();n.removeMarkers();var i=e.undoManager.item(e.undoManager.position);return(e._merge||e._forceMerge)&&i&&e._lastItem==i[0]?e._lastItem.content=r:(e._lastItem={previousItem:e._lastItem,content:r,scribe:e,execute:function(){},undo:function(){this.scribe.restoreFromHistory(this.previousItem)},redo:function(){this.scribe.restoreFromHistory(this)}},e.undoManager.transact(e._lastItem,!1)),clearTimeout(e._mergeTimer),e._merge=!0,e._mergeTimer=setTimeout(function(){e._merge=!1},e.options.undo.interval),!0}}return!1},d.prototype.getCommand=function(e){return this.commands[e]||this.commandPatches[e]||new this.api.Command(e)},d.prototype.restoreFromHistory=function(e){this._lastItem=e,this.setHTML(e.content,!0),(new this.api.Selection).selectMarkers(),this.trigger("content-changed")},d.prototype.allowsBlockElements=function(){return this.options.allowBlockElements},d.prototype.setContent=function(e){this.allowsBlockElements()||(e+="<br>"),this.setHTML(e),this.trigger("content-changed")},d.prototype.insertPlainText=function(e){this.insertHTML("<p>"+this._plainTextFormatterFactory.format(e)+"</p>")},d.prototype.insertHTML=function(e){this.getCommand("insertHTML").execute(this._htmlFormatterFactory.format(e))},d.prototype.isDebugModeEnabled=function(){return this.options.debug},d.prototype.registerHTMLFormatter=function(e,t){this._htmlFormatterFactory.formatters[e]=this._htmlFormatterFactory.formatters[e].push(t)},d.prototype.registerPlainTextFormatter=function(e){this._plainTextFormatterFactory.formatters=this._plainTextFormatterFactory.formatters.push(e)},h.prototype.format=function(e){
return this.formatters.reduce(function(e,t){return t(e)},e)},p.prototype=Object.create(h.prototype),p.prototype.constructor=p,p.prototype.format=function(e){return this.formatters.sanitize.concat(this.formatters.normalize).reduce(function(e,t){return t(e)},e)},p.prototype.formatForExport=function(e){return this.formatters.export.reduce(function(e,t){return t(e)},e)},d}),define("scribe-plugin-toolbar",[],function(){"use strict";var e=null;return function(t,n){var r={shared:!1};return n||(n=r),n=Object.freeze(n),function(r){n.shared&&r.el.addEventListener("focus",function(){e=r.el});var i=t.querySelectorAll("[data-command-name]");Array.prototype.forEach.call(i,function(t){function i(){var e=r.getCommand(t.dataset.commandName),n=new r.api.Selection;n.range&&e.queryState(t.dataset.commandValue)?t.classList.add("active"):t.classList.remove("active"),n.range&&e.queryEnabled()?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled")}t.addEventListener("mousedown",function(){if(!n.shared||r.el===e){var i=r.getCommand(t.dataset.commandName);r.el.focus(),i.execute(t.dataset.commandValue)}}),r.el.addEventListener("keyup",i),r.el.addEventListener("mouseup",i),r.el.addEventListener("focus",i),r.el.addEventListener("blur",i),r.on("content-changed",i)})}}}),define("scribe-plugin-cn-link-create",[],function(){var e=function(){var e=this;return this.instance=null,this.patterns=[],this.template='<div class="prompt" style="position: fixed; top: calc(50% - 100px); left: calc(50% - 100px);">  <ul>      <li>          Url: <input class="data form-control" name="scribe-link-href" data-name="href" value="">      </li>      <li>          Target:           <select class="data form-control" data-name="target">              <option value="">Same Window</option>              <option value="_blank">New Window</option>              <option value="_top">Parent Window</option>          </select>      </li>      <li>          Rel:           <select class="data form-control" data-name="rel">              <option value="">Follow</option>              <option value="nofollow">No follow</option>              \x3c!--option value="alternate">Alternate</option--\x3e              \x3c!--option value="author">Author</option--\x3e              \x3c!--option value="external">External</option--\x3e              \x3c!--option value="tag">Tag</option--\x3e              \x3c!--option value="prev">Previous</option--\x3e              \x3c!--option value="next">Next</option--\x3e          </select>      </li>      <li style="display: none">          id: <input class="data form-control" name="scribe-link-id" data-name="name" value="">      </li>  </ul> <div class="buttons">    <button name="cancel" class="btn">Cancel</button><button name="ok" class="btn btn-success">Save</button> </div></div>',this.show=function(t){t.initial=t.initial||{},e.instance&&this.remove(),e.instance=$(e.template),$("body").append(e.instance),e.instance.find(".data").each(function(){var e=t.initial[$(this).attr("data-name")]||"";$(this).val(e),$(this).find('option[value="'+e+'"]').attr("selected","selected")}),t.hasOwnProperty("onShow")&&t.onShow();var n=$(e.instance).find(".data");$(e.instance).find('button[name="ok"]').on("click",function(r){e.ok(r,n,t.onOK||null)}),$(e.instance).find('button[name="cancel"]').on("click",function(r){e.cancel(r,n,t.onCancel||null)})},this.validate=function(){return $(e.instance).find(".data").removeClass("error"),e.patterns.reduce(function(t,n){var r=$(e.instance).find('[data-name="'+n.attribute+'"]'),i=String(r.val()).match(n.pattern);return r&&null==i&&(r.addClass("error"),r.focus()),t&&null!=i},!0)},this.remove=function(){$(e.instance).remove()},this.ok=function(t,n,r){this.validate()&&("function"==typeof r&&r(t,n),e.remove())},this.cancel=function(t,n,r){"function"==typeof r&&r(t,n),e.remove()},this}();return function(t){return function(t){var n=new t.api.CommandPatch("cnCreateLink");n.nodeName="A",n.execute=function(r){var i=new t.api.Selection,o=i.range,a=i.getContaining(function(e){return e.nodeName===this.nodeName}.bind(this)),s={href:a?a.href:"",target:a?a.target:"",rel:a?a.rel:"",id:a?a.id:""},u=window.getSelection().toString();e.show({initial:s,onOK:function(e,r){if(r.each(function(e,t){s[$(t).attr("data-name")]=$(t).val()}),void 0!==a&&(o.selectNode(a),i.selection.removeAllRanges(),i.selection.addRange(o)),i.range){var c=document.createElement("a");for(var f in s)s.hasOwnProperty(f)&&s[f].length>0&&c.setAttribute(f,s[f]);c.textContent=u,t.transactionManager.run(function(){if(i.range.deleteContents(),c.href){i.range.insertNode(c);var e=document.createRange();e.setStartBefore(c),e.setEndAfter(c),i.selection.removeAllRanges(),i.selection.addRange(e)}else i.range.insertNode(document.createTextNode(u))})}else t.api.CommandPatch.prototype.execute.call(n,value)}})},n.queryEnabled=function(){return!0},n.queryState=function(){return!!(new t.api.Selection).getContaining(function(e){return e.nodeName===this.nodeName}.bind(this))},t.commandPatches.cnCreateLink=n}}}),!function(e,t){"function"==typeof define&&define.amd?define("html-janitor",t):"object"==typeof exports?module.exports=t():e.HTMLJanitor=t()}(this,function(){function e(e){var t=e.tags;if(!Object.keys(t).map(function(e){return typeof t[e]}).every(function(e){return"object"===e||"boolean"===e||"function"===e}))throw new Error("The configuration was invalid");this.config=e}function t(e){return-1!==s.indexOf(e.nodeName)}function n(e){return-1!==u.indexOf(e.nodeName)}function r(e){return document.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,null,!1)}function i(e,t,n){return"function"==typeof e.tags[t]?e.tags[t](n):e.tags[t]}function o(e,t){return void 0===t||"boolean"==typeof t&&!t}function a(e,t,n){var r=e.name.toLowerCase();return!0!==t&&("function"==typeof t[r]?!t[r](e.value,n):void 0===t[r]||(!1===t[r]||"string"==typeof t[r]&&t[r]!==e.value))}var s=["P","LI","TD","TH","DIV","H1","H2","H3","H4","H5","H6","PRE"],u=["A","B","STRONG","I","EM","SUB","SUP","U","STRIKE"];return e.prototype.clean=function(e){var t=document.createElement("div");return t.innerHTML=e,this._sanitize(t),t.innerHTML},e.prototype._sanitize=function(e){var s=r(e),u=s.firstChild();if(u)do{if(!u._sanitized)if(u.nodeType!==Node.TEXT_NODE){if(u.nodeType===Node.COMMENT_NODE){e.removeChild(u),this._sanitize(e);break}var c,f=n(u);f&&(c=Array.prototype.some.call(u.childNodes,t));var l=!!e.parentNode,d=t(e)&&t(u)&&l,h=u.nodeName.toLowerCase(),p=i(this.config,h,u),m=f&&c;if(m||o(u,p)||!this.config.keepNestedBlockElements&&d){if("SCRIPT"!==u.nodeName&&"STYLE"!==u.nodeName)for(;u.childNodes.length>0;)e.insertBefore(u.childNodes[0],u);e.removeChild(u),this._sanitize(e);break}for(var v=0;v<u.attributes.length;v+=1){var g=u.attributes[v];a(g,p,u)&&(u.removeAttribute(g.name),v-=1)}this._sanitize(u),u._sanitized=!0}else if(""===u.data.trim()&&(u.previousElementSibling&&t(u.previousElementSibling)||u.nextElementSibling&&t(u.nextElementSibling))){e.removeChild(u),this._sanitize(e);break}}while(u=s.nextSibling())},e}),define("lodash-amd/modern/internal/arrayEach",[],function(){function e(e,t){for(var n=-1,r=e.length;++n<r&&!1!==t(e[n],n,e););return e}return e}),define("lodash-amd/modern/lang/isObject",[],function(){function e(e){var t=typeof e;return"function"==t||e&&"object"==t||!1}return e}),define("lodash-amd/modern/internal/toObject",["../lang/isObject"],function(e){function t(t){return e(t)?t:Object(t)}return t}),define("lodash-amd/modern/internal/baseFor",["./toObject"],function(e){function t(t,n,r){for(var i=-1,o=e(t),a=r(t),s=a.length;++i<s;){var u=a[i];if(!1===n(o[u],u,o))break}return t}return t}),define("lodash-amd/modern/internal/isLength",[],function(){function e(e){return"number"==typeof e&&e>-1&&e%1==0&&t>=e}var t=Math.pow(2,53)-1;return e}),define("lodash-amd/modern/internal/baseToString",[],function(){function e(e){return"string"==typeof e?e:null==e?"":e+""}return e}),define("lodash-amd/modern/string/escapeRegExp",["../internal/baseToString"],function(e){function t(t){return t=e(t),t&&r.test(t)?t.replace(n,"\\$&"):t}var n=/[.*+?^${}()|[\]\/\\]/g,r=RegExp(n.source);return t}),define("lodash-amd/modern/internal/isObjectLike",[],function(){function e(e){return e&&"object"==typeof e||!1}return e}),define("lodash-amd/modern/lang/isNative",["../string/escapeRegExp","../internal/isObjectLike"],function(e,t){function n(e){return null!=e&&(s.call(e)==r?u.test(a.call(e)):t(e)&&i.test(e)||!1)}var r="[object Function]",i=/^\[object .+?Constructor\]$/,o=Object.prototype,a=Function.prototype.toString,s=o.toString,u=RegExp("^"+e(s).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return n}),define("lodash-amd/modern/lang/isArguments",["../internal/isLength","../internal/isObjectLike"],function(e,t){function n(n){var o=t(n)?n.length:r;return e(o)&&a.call(n)==i||!1}var r,i="[object Arguments]",o=Object.prototype,a=o.toString;return n}),define("lodash-amd/modern/lang/isArray",["../internal/isLength","./isNative","../internal/isObjectLike"],function(e,t,n){var r=Object.prototype,i=r.toString,o=t(o=Array.isArray)&&o;return o||function(t){return n(t)&&e(t.length)&&"[object Array]"==i.call(t)||!1}}),define("lodash-amd/modern/internal/isIndex",[],function(){function e(e,n){return e=+e,n=null==n?t:n,e>-1&&e%1==0&&n>e}var t=Math.pow(2,53)-1;return e}),define("lodash-amd/modern/internal/root",[],function(){var e={function:!0,object:!0},t=e[typeof exports]&&exports&&!exports.nodeType&&exports,n=e[typeof module]&&module&&!module.nodeType&&module,r=t&&n&&"object"==typeof global&&global,i=e[typeof window]&&window;return r||i!==(this&&this.window)&&i||this}),define("lodash-amd/modern/support",["./lang/isNative","./internal/root"],function(e,t){var n=/\bthis\b/,r=Object.prototype,i=(i=t.window)&&i.document,o=r.propertyIsEnumerable,a={};return function(){a.funcDecomp=!e(t.WinRTError)&&n.test(function(){return this}),a.funcNames="string"==typeof Function.name;try{a.dom=11===i.createDocumentFragment().nodeType}catch(e){a.dom=!1}try{a.nonEnumArgs=!o.call(arguments,1)}catch(e){a.nonEnumArgs=!0}}(0,0),a}),define("lodash-amd/modern/object/keysIn",["../lang/isArguments","../lang/isArray","../internal/isIndex","../internal/isLength","../lang/isObject","../support"],function(e,t,n,r,i,o){function a(a){if(null==a)return[];i(a)||(a=Object(a));var s=a.length;s=s&&r(s)&&(t(a)||o.nonEnumArgs&&e(a))&&s||0;for(var c=a.constructor,f=-1,l="function"==typeof c&&c.prototype===a,d=Array(s),h=s>0;++f<s;)d[f]=f+"";for(var p in a)h&&n(p,s)||"constructor"==p&&(l||!u.call(a,p))||d.push(p);return d}var s=Object.prototype,u=s.hasOwnProperty;return a}),define("lodash-amd/modern/internal/shimKeys",["../lang/isArguments","../lang/isArray","./isIndex","./isLength","../object/keysIn","../support"],function(e,t,n,r,i,o){function a(a){for(var s=i(a),c=s.length,f=c&&a.length,l=f&&r(f)&&(t(a)||o.nonEnumArgs&&e(a)),d=-1,h=[];++d<c;){var p=s[d];(l&&n(p,f)||u.call(a,p))&&h.push(p)}return h}var s=Object.prototype,u=s.hasOwnProperty;return a}),define("lodash-amd/modern/object/keys",["../internal/isLength","../lang/isNative","../lang/isObject","../internal/shimKeys"],function(e,t,n,r){var i=t(i=Object.keys)&&i;return i?function(t){if(t)var o=t.constructor,a=t.length;return"function"==typeof o&&o.prototype===t||"function"!=typeof t&&a&&e(a)?r(t):n(t)?i(t):[]}:r}),define("lodash-amd/modern/internal/baseForOwn",["./baseFor","../object/keys"],function(e,t){function n(n,r){return e(n,r,t)}return n}),define("lodash-amd/modern/internal/arrayCopy",[],function(){function e(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}return e}),define("lodash-amd/modern/internal/baseForIn",["./baseFor","../object/keysIn"],function(e,t){function n(n,r){return e(n,r,t)}return n}),define("lodash-amd/modern/internal/shimIsPlainObject",["./baseForIn","./isObjectLike"],function(e,t){function n(n){var i;if(!t(n)||a.call(n)!=r||!o.call(n,"constructor")&&"function"==typeof(i=n.constructor)&&!(i instanceof i))return!1;var s;return e(n,function(e,t){s=t}),void 0===s||o.call(n,s)}var r="[object Object]",i=Object.prototype,o=i.hasOwnProperty,a=i.toString;return n}),define("lodash-amd/modern/lang/isPlainObject",["./isNative","../internal/shimIsPlainObject"],function(e,t){var n=Object.prototype,r=n.toString,i=e(i=Object.getPrototypeOf)&&i;return i?function(n){if(!n||"[object Object]"!=r.call(n))return!1;var o=n.valueOf,a=e(o)&&(a=i(o))&&i(a);return a?n==a||i(n)==a:t(n)}:t}),define("lodash-amd/modern/lang/isTypedArray",["../internal/isLength","../internal/isObjectLike"],function(e,t){function n(n){return t(n)&&e(n.length)&&r[o.call(n)]||!1}var r={};r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r["[object Arguments]"]=r["[object Array]"]=r["[object ArrayBuffer]"]=r["[object Boolean]"]=r["[object Date]"]=r["[object Error]"]=r["[object Function]"]=r["[object Map]"]=r["[object Number]"]=r["[object Object]"]=r["[object RegExp]"]=r["[object Set]"]=r["[object String]"]=r["[object WeakMap]"]=!1;var i=Object.prototype,o=i.toString;return n}),define("lodash-amd/modern/internal/baseCopy",[],function(){function e(e,t,n){n||(n=t,t={});for(var r=-1,i=n.length;++r<i;){var o=n[r];t[o]=e[o]}return t}return e}),define("lodash-amd/modern/lang/toPlainObject",["../internal/baseCopy","../object/keysIn"],function(e,t){function n(n){return e(n,t(n))}return n}),define("lodash-amd/modern/internal/baseMergeDeep",["./arrayCopy","../lang/isArguments","../lang/isArray","./isLength","../lang/isPlainObject","../lang/isTypedArray","../lang/toPlainObject"],function(e,t,n,r,i,o,a){function s(s,c,f,l,d,h,p){for(var m=h.length,v=c[f];m--;)if(h[m]==v)return void(s[f]=p[m]);var g=s[f],y=d?d(g,v,f,s,c):u,_=void 0===y;_&&(y=v,r(v.length)&&(n(v)||o(v))?y=n(g)?g:g?e(g):[]:i(v)||t(v)?y=t(g)?a(g):i(g)?g:{}:_=!1),h.push(v),p.push(y),_?s[f]=l(y,v,d,h,p):(y===y?y!==g:g===g)&&(s[f]=y)}var u;return s}),define("lodash-amd/modern/internal/baseMerge",["./arrayEach","./baseForOwn","./baseMergeDeep","../lang/isArray","./isLength","../lang/isObject","./isObjectLike","../lang/isTypedArray"],function(e,t,n,r,i,o,a,s){function u(f,l,d,h,p){if(!o(f))return f;var m=i(l.length)&&(r(l)||s(l));return(m?e:t)(l,function(e,t,r){if(a(e))return h||(h=[]),p||(p=[]),n(f,r,t,u,d,h,p);var i=f[t],o=d?d(i,e,t,f,r):c,s=void 0===o;s&&(o=e),!m&&void 0===o||!s&&(o===o?o===i:i!==i)||(f[t]=o)}),f}var c;return u}),define("lodash-amd/modern/utility/identity",[],function(){function e(e){return e}return e}),define("lodash-amd/modern/internal/bindCallback",["../utility/identity"],function(e){function t(t,n,r){if("function"!=typeof t)return e;if(void 0===n)return t;switch(r){case 1:return function(e){return t.call(n,e)};case 3:return function(e,r,i){return t.call(n,e,r,i)};case 4:return function(e,r,i,o){return t.call(n,e,r,i,o)};case 5:return function(e,r,i,o,a){return t.call(n,e,r,i,o,a)}}return function(){return t.apply(n,arguments)}}return t}),define("lodash-amd/modern/internal/isIterateeCall",["./isIndex","./isLength","../lang/isObject"],function(e,t,n){function r(r,i,o){if(!n(o))return!1;var a=typeof i;if("number"==a)var s=o.length,u=t(s)&&e(i,s);else u="string"==a&&i in o;if(u){var c=o[i];return r===r?r===c:c!==c}return!1}return r}),define("lodash-amd/modern/internal/createAssigner",["./bindCallback","./isIterateeCall"],function(e,t){function n(n){return function(){var r=arguments,i=r.length,o=r[0];if(2>i||null==o)return o;var a=r[i-2],s=r[i-1],u=r[3];i>3&&"function"==typeof a?(a=e(a,s,5),i-=2):(a=i>2&&"function"==typeof s?s:null,i-=a?1:0),u&&t(r[1],r[2],u)&&(a=3==i?null:a,i=2);for(var c=0;++c<i;){var f=r[c];f&&n(o,f,a)}return o}}return n}),define("lodash-amd/modern/object/merge",["../internal/baseMerge","../internal/createAssigner"],function(e,t){return t(e)}),define("lodash-amd/modern/internal/initCloneArray",[],function(){function e(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&n.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var t=Object.prototype,n=t.hasOwnProperty;return e}),define("lodash-amd/modern/utility/constant",[],function(){function e(e){return function(){return e}}return e}),define("lodash-amd/modern/internal/bufferClone",["../utility/constant","../lang/isNative","./root"],function(e,t,n){function r(e){return o.call(e,0)}var i=t(i=n.ArrayBuffer)&&i,o=t(o=i&&new i(0).slice)&&o,a=Math.floor,s=t(s=n.Uint8Array)&&s,u=function(){try{var e=t(e=n.Float64Array)&&e,r=new e(new i(10),0,1)&&e}catch(e){}return r}(),c=u?u.BYTES_PER_ELEMENT:0;return o||(r=i&&s?function(e){var t=e.byteLength,n=u?a(t/c):0,r=n*c,o=new i(t);if(n){var f=new u(o,0,n);f.set(new u(e,0,n))}return t!=r&&(f=new s(o,r),f.set(new s(e,r))),o}:e(null)),r}),define("lodash-amd/modern/internal/initCloneByTag",["./bufferClone"],function(e){function t(t,y,_){var b=t.constructor;switch(y){case s:return e(t);case n:case r:return new b(+t);case u:case c:case f:case l:case d:case h:case p:case m:case v:var E=t.buffer;return new b(_?e(E):E,t.byteOffset,t.length);case i:case a:return new b(t);case o:var S=new b(t.source,g.exec(t));S.lastIndex=t.lastIndex}return S}var n="[object Boolean]",r="[object Date]",i="[object Number]",o="[object RegExp]",a="[object String]",s="[object ArrayBuffer]",u="[object Float32Array]",c="[object Float64Array]",f="[object Int8Array]",l="[object Int16Array]",d="[object Int32Array]",h="[object Uint8Array]",p="[object Uint8ClampedArray]",m="[object Uint16Array]",v="[object Uint32Array]",g=/\w*$/;return t}),define("lodash-amd/modern/internal/initCloneObject",[],function(){function e(e){var t=e.constructor;return"function"==typeof t&&t instanceof t||(t=Object),new t}return e}),define("lodash-amd/modern/internal/baseClone",["./arrayCopy","./arrayEach","./baseCopy","./baseForOwn","./initCloneArray","./initCloneByTag","./initCloneObject","../lang/isArray","../lang/isObject","../object/keys"],function(e,t,n,r,i,o,a,s,u,c){function f(m,g,y,_,b,E,S){var w;if(y&&(w=b?y(m,_,b):y(m)),void 0!==w)return w;if(!u(m))return m;var I=s(m);if(I){if(w=i(m),!g)return e(m,w)}else{var x=v.call(m),O=x==d;if(x!=h&&x!=l&&(!O||b))return p[x]?o(m,x,g):b?m:{};if(w=a(O?{}:m),!g)return n(m,w,c(m))}E||(E=[]),S||(S=[]);for(var M=E.length;M--;)if(E[M]==m)return S[M];return E.push(m),S.push(w),(I?t:r)(m,function(e,t){w[t]=f(e,g,y,t,m,E,S)}),w}var l="[object Arguments]",d="[object Function]",h="[object Object]",p={};p[l]=p["[object Array]"]=p["[object ArrayBuffer]"]=p["[object Boolean]"]=p["[object Date]"]=p["[object Float32Array]"]=p["[object Float64Array]"]=p["[object Int8Array]"]=p["[object Int16Array]"]=p["[object Int32Array]"]=p["[object Number]"]=p[h]=p["[object RegExp]"]=p["[object String]"]=p["[object Uint8Array]"]=p["[object Uint8ClampedArray]"]=p["[object Uint16Array]"]=p["[object Uint32Array]"]=!0,p["[object Error]"]=p[d]=p["[object Map]"]=p["[object Set]"]=p["[object WeakMap]"]=!1;var m=Object.prototype,v=m.toString;return f}),define("lodash-amd/modern/lang/cloneDeep",["../internal/baseClone","../internal/bindCallback"],function(e,t){function n(n,r,i){return r="function"==typeof r&&t(r,i,1),e(n,!0,r)}return n}),define("scribe-plugin-sanitizer",["html-janitor","lodash-amd/modern/object/merge","lodash-amd/modern/lang/cloneDeep"],function(e,t,n){return function(r){var i=t(n(r),{tags:{em:{class:"scribe-marker"},br:{}}});return function(t){var n=new e(i);t.registerHTMLFormatter("sanitize",n.clean.bind(n))}}}),define("ImageServiceAttribute",["scribe","scribe-plugin-toolbar","scribe-plugin-cn-link-create","scribe-plugin-sanitizer"],function(e,t,n,r){return function(i){var o=this,a=i.config.events;return o.prefix=i.prefix||"",o.definition=i.definition,o.name=i.name,o.value=i.value,o.container=null,o.dataService=i.dataService,o.initialized=!1,o.trigger=function(e,t){o.container.trigger(e,t)},o.getValue=function(){return o.value},o.setValue=function(e){o.value=e,o.render()},o.generateLabel=function(){return o.definition.label||o.name},o.generateFieldName=function(){return o.prefix+"_"+o.name},o.render=function(){return o.hasOwnProperty(o.definition.type)&&(o.container=o[o.definition.type](o.value,o.definition)),o.container},o.tag=function(e){var t=o.generateFieldName(),n=o.generateLabel(),r=$('<li class="row"></li>'),i=$('<label class="col-xs-12 col-sm-3 col-md-3" for="'+t+'">'+n+"</label>"),s=$('<div class="col-xs-12 col-sm-9 col-md-9 no-drag" ></div>'),u=$('<select data-name="'+t+'" multiple ></select>');return(e||[]).forEach(function(e){u.append($('<option value="'+e+'" selected>'+e+"</option>"))}),r.on(a.ATTRIBUTERENDERED,function(e){u.select2({tags:!0,tokenSeparators:[","," "],ajax:{url:o.dataService.baseUrl+"/tagsearch",dataType:"json",delay:100,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){t.page=t.page||1;for(var n=[],r=0;r<e.items.length;r++)n.push({id:e.items[r],text:e.items[r]});return{results:n,pagination:{more:!0}}},cache:!1}})}),u.on("change",function(){o.value=$(this).val()}),r.append(i),s.append(u),r.append(s),o.initialized=!0,r},o.select=function(e){var t=o.generateFieldName(),n=o.generateLabel(),r=i.definition.options||[],a=$('<li class="row"><label class="col-xs-12 col-sm-3 col-md-3" for="'+t+'">'+n+'</label><div class="col-xs-12 col-sm-9 col-md-9 field-container no-drag" ></div></li>'),s=$('<selectdata-name="'+t+'"></select>');for(x in r){var u=$('<option value="'+x+'">'+i.definition.options[x]+"</option>");x==e&&u.attr("selected","selected"),s.append(u)}return a.find(".field-container").append(s),a.on("change",function(e){o.value=$(e.target).val()}),o.initialized=!0,a},o.checkbox=function(e){var t=o.generateFieldName(),n=o.generateLabel(),r=o.definition.value||"",i=$('<li class="row"><label class="col-xs-12 col-sm-3 col-md-3" for="'+t+'">'+n+'</label><div class="col-xs-12 col-sm-9 col-md-9 no-drag" ><input type="checkbox"data-name="'+t+'" value=""></div></li>');return i.find("checkbox").val(e),i.find("checkbox").attr("value",e),i.on("click",function(e){o.value=e.target.checked?r:""}),e==r&&i.find("input").attr("checked","checked").prop("checked",!0),o.initialized=!0,i},o.text=function(e){var t=o.generateFieldName(),n=o.generateLabel(),r=$('<li class="row"><label class="col-xs-12 col-sm-3 col-md-3" for="'+t+'">'+n+'</label><div class="col-xs-12 col-sm-9 col-md-9 no-drag" ><input type="text"data-name="'+t+'" value=""></div></li>');return r.find("input").val(e),r.find("input").attr("value",e),r.on("change",function(e){o.value=$(e.target).val()}),o.initialized=!0,r},o.textarea=function(i){var s=o.generateFieldName(),u=o.generateLabel(),c=$('<li class="row"><label class="col-xs-12 col-sm-3 col-md-3" for="'+s+'">'+u+'</label><div class="col-xs-12 col-sm-9 col-md-9"><div class="toolbar no-drag">  <button data-command-name="bold"         type="button"><strong>Aa</strong></button><button data-command-name="italic"       type="button"><i>Aa</i></button><button data-command-name="cnCreateLink" type="button"><i class="fa fa-link" aria-hidden="true"></i></button></div><div contenteditable="true" class="no-drag imageservice-scribe" >'+i+"</div></div></li>");return c.find(".toolbar").hide(),window.document.addEventListener("selectionchange",function(e,t){var n=window.getSelection(),r=$(e.srcElement.activeElement);n.isCollapsed?r.siblings(".toolbar").hide():r.siblings(".toolbar").show()}),c.on(a.ATTRIBUTERENDERED,function(a,s){var u=s.container.find(".toolbar")[0],f=s.container.find(".imageservice-scribe:first")[0],l=new e(f);l.allowsBlockElements(),l.setContent(i),l.use(t(u)),l.use(n()),l.use(r({tags:{p:{},b:{},i:{},br:{},a:{href:!0,target:"_blank",rel:!0}}})),l.on("content-changed",function(){var e=o.value;o.value=l.getHTML(),e!=l.getHTML()&&c.trigger("change")}),o.initialized=!0}),c},o}}),define("ImageServiceAttributes",[],function(){return function(e){var t=this,n=e.model.attribute,r=e.config.events;t.values=e.values||[],t.prefix=e.prefix||"",t.definitions=e.definitions,t.attributes=[],t.dataService=e.dataService,t.container=null,t.getValues=function(){return t.values},t.setValues=function(e){t.attributes.forEach(function(t){t.setValue(e[t.name]||t.value)})},t.init=function(){for(var e in t.definitions){var i=t.definitions[e];t.attributes.push(new n({prefix:t.prefix,value:t.values[e]||"",definition:i,name:e,dataService:t.dataService,config:{events:r}}))}},t.getValues=function(){return t.attributes.forEach(function(e){t.values[e.name]=e.getValue()}),t.values},t.render=function(e,n){return t.container=$('<ul class="imageservice-attributes"></ul>'),t.attributes.forEach(function(e,n){t.container.append(e.render()),e.trigger(r.ATTRIBUTERENDERED,e)}),t.container},t.init()}}),define("ImageServiceSirTrevor",["ImageServiceConfig"],function(e){return function(t){var n=this,r=t.extensionUrl,i=t.serviceName,o=t.model.imageService,a={imageServiceInstance:null,type:"imageservice",title:function(){return"Image"},icon_name:"default",toolbarEnabled:!0,textable:!0,editorHTML:'<div class="frontend-target"></div><textarea type="text" class="data-target">{"items":[]}</textarea>',loadData:function(e){e=e||{items:[]},$(this.$(".data-target")).text(JSON.stringify(e))},save:function(){if(this.imageServiceInstance){var e=this.imageServiceInstance.list.getData(),t=this.imageServiceInstance.settings.getData();this.setData(Object.assign({},t,{items:e.items}))}},onBlockRender:function(){$(this.$(".frontend-target")).attr("id","ImageService"+String((new Date).valueOf()));var e=SirTrevor.getInstance(this.instanceID).options.options.Imageservice||{},t={dataElement:this.$(".data-target"),hostElement:this.$(".frontend-target"),serviceUrl:r+"/image",serviceName:e.service||i},n=new o(Object.assign(e,t));this.imageServiceInstance=n},onDeleteConfirm:function(t){t.preventDefault(),$(document).trigger(e.events.LISTREMOVED,{instance:this.imageServiceInstance}),this.mediator.trigger("block:remove",this.blockID,{focusOnPrevious:!0})}};return n.init=function(e){"object"==typeof SirTrevor&&(SirTrevor.Blocks.Imageservice=SirTrevor.Block.extend(a))},n}});var CnImageServiceBackendConfig={baseUrl:document.currentScript.getAttribute("data-extension-url"),defaultServiceName:document.currentScript.getAttribute("data-default-servicename")};require(["ImageServiceAttributesFactory","ImageServiceImageModelFactory","ImageServiceListItemFactory","ImageServiceConnector","ImageServiceUploader","ImageServiceSettings","ImageServiceFinder","ImageServicePresets","ImageServiceMessaging","ImageServiceList","ImageServiceConfig","ImageServiceErrors","ImageServiceGlobals","ImageServiceListItem","ImageServiceEntityAction","ImageServicePreview","ImageServiceAttribute","ImageServiceAttributes","ImageServiceSirTrevor"],function(e,t,n,r,i,o,a,s,u,c,f,l,d,h,p,m,v,g,y){window.CnImageService=function(y){var _=this;_.store=$(y.dataElement),_.storeJson=JSON.parse(_.store.val()),_.host=$(y.hostElement),_.errors=new l(y.errors),_.config=f,_.service=new r({defaults:y.cache,baseUrl:y.serviceUrl,serviceName:y.serviceName,factory:{errors:_.errors}}),_.init=function(){_.host.addClass("imageservice-container"),_.store.hide(),$(document).trigger(f.events.LISTREADY,{instance:_})},_.modelFactory=new t({host:_.host,config:_.config,defaults:{service:y.serviceName}}),_.attributesFactory=new e({attribute:v,events:_.config.events,model:g}),_.listItemFactory=new n({model:h,events:_.config.events,eventsArena:_.host,actions:p,preview:m,attributes:_.attributesFactory,dataModel:_.modelFactory,config:_.config,service:_.service,definitions:{attributes:Object.assign({},y.attributes,_.config.systemAttributes)}}),_.uploader=new i({host:_.host,maxFileSize:y.maxFileSize,service:_.service,config:{events:_.config.events,labels:_.config.labels.ImageServiceUploader},factory:{model:_.modelFactory}}),_.finder=new a({host:_.host,service:_.service,config:{events:_.config.events,labels:_.config.labels.ImageServiceFinder}}),_.settings=new o({host:_.host,config:{events:_.config.events,labels:_.config.labels.ImageServiceSettings},data:_.storeJson}),Object.keys(y.globals||{}).length&&(_.globals=new d({host:_.host,parentContainer:null,attributes:y.globals,service:_.service,prefix:"globals",config:{events:_.config.events,labels:_.config.labels.ImageServiceGlobals},values:{},factory:{attributes:_.attributesFactory}})),Object.keys(y.attributes||{}).length&&(_.presets=new s({host:_.host,parentContainer:null,attributes:jQuery.extend({},y.attributes,_.config.systemAttributes),service:_.service,prefix:"presets",config:{events:_.config.events,labels:_.config.labels.ImageServicePresets},values:{},factory:{attributes:_.attributesFactory}})),_.messaging=new u({host:_.host,events:{error:_.config.events.MESSAGEERROR,warning:_.config.events.MESSAGEWARNING,info:_.config.events.MESSAGEINFO}}),_.list=new c({hostElement:_.host,items:JSON.parse(_.store.val()),maxItems:y.maxFiles||null,config:{events:_.config.events},factory:{listItem:_.listItemFactory,model:_.modelFactory}}),_.updateStore=function(e){try{_.storeJson=e;var t=JSON.stringify(e);$(_.store).val(t),"TEXTAREA"==$(_.store).prop("tagName")&&$(_.store).html(t),$(_.host).trigger(_.config.events.LISTSAVED,e)}catch(e){$(_.host).trigger(_.config.events.LISTSAVEFAILED,{error:e})}},_.needsSaving=function(){return _.list.dirty},_.save=function(e){if(_.list.dirty){e=e||new Event(_.config.events.LISTSAVED),e.preventDefault(),e.stopImmediatePropagation();var t=_.list.getData();_.service.imageSave({async:!1,items:t.items,files:t.files,callback:function(e){var t=_.settings.getData();_.updateStore(Object.assign({},t,{items:e}))},warning:function(e,t){var n=!0;return e.forEach(function(e){n=n&&_.processWarning(e,{items:t})}),n},error:function(e){_.processError(e,t)}})}else $(_.host).trigger(_.config.events.LISTSAVINGSKIPPED,_.storeJson)},_.processWarning=function(e,t){console.warn(e);var n=!0,r=_.errors.create(e.code)+" - "+e.id;return"warn"===e.type?_.host.trigger(_.config.events.MESSAGEWARNING,{error:r,data:e}):"error"===e.type&&(n=_.processError(r,e)),n},_.processError=function(e,t){return console.warn(e),_.host.trigger(_.config.events.MESSAGEERROR,{error:e,data:t}),$(_.host).trigger(_.config.events.LISTSAVEFAILED,{error:e,data:t}),!1},_.init()},$(document).currentScript=document.currentScript||function(){var e=document.getElementsByTagName("script");return e[e.length-1]}();var _=new y({extensionUrl:CnImageServiceBackendConfig.baseUrl,serviceName:CnImageServiceBackendConfig.defaultServiceName,model:{imageService:CnImageService}});$(document).on("SirTrevor.DynamicBlock.All",function(){$(document).trigger("SirTrevor.DynamicBlock.Add",[_])}),$(document).trigger("SirTrevor.DynamicBlock.Add",[_])}),define("CnImageService",function(){});var CnImageServiceBolt={};require(["ImageServiceConfig","ImageServicePreview","ImageServiceImageModelFactory","ImageServiceMessaging","ImageServiceUniqueId"],function(e,t,n,r,i){CnImageServiceBolt=new function(){var r=this,o=[],a=0,s=0,u=null,c=[],f=new i(""),l=$('<div class="buic-modal modal fade imageservice-progress" tabindex="-1" role="dialog" aria-labelledby="imageservice-progress">\n  <div class="modal-dialog modal-lg" role="document">\n     <div class="modal-content">         <div class="modal-header"><h2 class="hide-on-error">Saving Images</h2><h2 class="show-on-error error">Saving Cancelled</h2></div>         <div class="modal-body"></div>\n         <div class="modal-footer show-on-error">             <div class="error col-xs-12 col-md-8">An error occured. Please remove or change the images marked with red and try again.</div>             <div class="col-xs-12 col-md-4"><button type="button" class="btn btn-default pull-right" data-dismiss="modal">Close</button></div>         </div>\n     </div>  </div>\n</div>\n');$("body").append(l),$(document).on(e.events.LISTSAVED+" "+e.events.LISTSAVINGSKIPPED+" "+e.events.LISTSAVEFAILED,function(t,n){t.type===e.events.LISTSAVEFAILED?(s++,
n.hasOwnProperty("data")&&n.data instanceof Array&&r.savedError(n.data)):(a--,r.savedHide(n.items)),0===a?r.finishSaving(!0):a-s==0&&r.finishSaving(!1)}),$(document).on(e.events.MESSAGEWARNING+" "+e.events.MESSAGEERROR,function(e,t){l.find('img[id="'+t.data.id+'"]').parent().addClass("error")}),$(document).on(e.events.LISTREADY,function(e,t){o.push(t.instance)}),$(document).on(e.events.LISTREMOVED,function(e,t){var n=o.indexOf(t.instance);console.log(o.indexOf(t.instance)),n>-1&&o.splice(n,1)}),$(window).on("load",function(){$("#sidebarsavecontinuebutton, #savecontinuebutton, #sidebarpreviewbutton, #previewbutton").each(function(e){var t=$($(this).prop("outerHTML"));t.data("parentButton",$(this)),t.attr("id",t.attr("id")+"-imageservice"),t.insertBefore($(this)),t.on("click",function(e){e.stopPropagation(),e.preventDefault(),r.save(e)}),$(this).hide(),$('<div class="imageservice-saving">Saving Images</div>').insertBefore(t),$(".imageservice-saving").hide()})}),r.finishSaving=function(e){e?(l.modal("hide"),void 0!==$(u.target).data("parentButton")&&$(u.target).data("parentButton").trigger(u.type,{imageserviceskip:!0})):(r.savedError([]),l.find(".show-on-error").show(),l.find(".hide-on-error").hide()),$(".imageservice-saving").hide()},r.save=function(e,t){$(".imageservice-saving").show(),$(".imageservice-saving-progress-modal").html("");var n=!1;c=[],u=e,a=o.length,s=0,o.forEach(function(e){e.needsSaving()&&(c.push(e.list.getData().items),n=!0)}),n?(r.showProgress(),o.forEach(function(e){e.save()})):r.finishSaving(!0)},r.savedHide=function(e){e.forEach(function(e){$(".modal-body").find('img[id="'+f.generate(e.id)+'"]').parent().hide()})},r.savedError=function(e){if(!e.length)return void $(".modal-body img").removeClass("saving");e.forEach(function(e){$(".imageservice-saving-progress-modal").find('img[id="'+f.generate(e.id)+'"]').each(function(){$(this).removeClass("saving"),$(this).addClass("error")})})},r.showProgress=function(){l.find(".modal-body").html(""),c.forEach(function(r){r.forEach(function(r){var i=new t({item:r,config:{events:e.events},factory:{dataModel:n}}),o=i.render();o.find("img").attr("style","-webkit-animation-duration: "+(Math.random(7)+3)+"s"),o.find("img").addClass("saving"),l.find(".modal-body").append(i.render())})}),l.find(".show-on-error").hide(),l.find(".hide-on-error").show(),l.modal({show:!0})}}}),define("CnImageServiceBolt",function(){})}();