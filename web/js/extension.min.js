/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, https://github.com/requirejs/requirejs/blob/master/LICENSE
 */

var requirejs,require,define;!function(global,setTimeout){function commentReplace(e,t){return t||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var i;for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}}function eachReverse(e,t){if(e){var i;for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(e,t,i,n){return t&&eachProp(t,function(t,r){!i&&hasProp(e,r)||(!n||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[r]=t:(e[r]||(e[r]={}),mixin(e[r],t,i,n)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,i,n){var r=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=n,i&&(r.originalError=i),r}function newContext(e){function t(e){var t,i;for(t=0;t<e.length;t++)if(i=e[t],"."===i)e.splice(t,1),t-=1;else if(".."===i){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function i(e,i,n){var r,a,s,o,c,u,l,d,f,g,m,p,v=i&&i.split("/"),h=y.map,E=h&&h["*"];if(e&&(e=e.split("/"),l=e.length-1,y.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&v&&(p=v.slice(0,v.length-1),e=p.concat(e)),t(e),e=e.join("/")),n&&h&&(v||E)){s=e.split("/");e:for(o=s.length;o>0;o-=1){if(u=s.slice(0,o).join("/"),v)for(c=v.length;c>0;c-=1)if(a=getOwn(h,v.slice(0,c).join("/")),a&&(a=getOwn(a,u))){d=a,f=o;break e}!g&&E&&getOwn(E,u)&&(g=getOwn(E,u),m=o)}!d&&g&&(d=g,f=m),d&&(s.splice(0,f,d),e=s.join("/"))}return r=getOwn(y.pkgs,e),r?r:e}function n(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===S.contextName)return t.parentNode.removeChild(t),!0})}function r(e){var t=getOwn(y.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),S.require.undef(e),S.makeRequire(null,{skipMap:!0})([e]),!0}function a(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function s(e,t,n,r){var s,o,c,u,l=null,d=t?t.name:null,f=e,g=!0,m="";return e||(g=!1,e="_@r"+(O+=1)),u=a(e),l=u[0],e=u[1],l&&(l=i(l,d,r),o=getOwn(L,l)),e&&(l?m=n?e:o&&o.normalize?o.normalize(e,function(e){return i(e,d,r)}):e.indexOf("!")===-1?i(e,d,r):e:(m=i(e,d,r),u=a(m),l=u[0],m=u[1],n=!0,s=S.nameToUrl(m))),c=!l||o||n?"":"_unnormalized"+($+=1),{prefix:l,name:m,parentMap:t,unnormalized:!!c,url:s,originalName:f,isDefine:g,id:(l?l+"!"+m:m)+c}}function o(e){var t=e.id,i=getOwn(w,t);return i||(i=w[t]=new S.Module(e)),i}function c(e,t,i){var n=e.id,r=getOwn(w,n);!hasProp(L,n)||r&&!r.defineEmitComplete?(r=o(e),r.error&&"error"===t?i(r.error):r.on(t,i)):"defined"===t&&i(L[n])}function u(e,t){var i=e.requireModules,n=!1;t?t(e):(each(i,function(t){var i=getOwn(w,t);i&&(i.error=e,i.events.error&&(n=!0,i.emit("error",e)))}),n||req.onError(e))}function l(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(S.defQueueMap[t]=!0),M.push(e)}),globalDefQueue=[])}function d(e){delete w[e],delete T[e]}function f(e,t,i){var n=e.map.id;e.error?e.emit("error",e.error):(t[n]=!0,each(e.depMaps,function(n,r){var a=n.id,s=getOwn(w,a);!s||e.depMatched[r]||i[a]||(getOwn(t,a)?(e.defineDep(r,L[a]),e.check()):f(s,t,i))}),i[n]=!0)}function g(){var e,t,i=1e3*y.waitSeconds,a=i&&S.startTime+i<(new Date).getTime(),s=[],o=[],c=!1,l=!0;if(!E){if(E=!0,eachProp(T,function(e){var i=e.map,u=i.id;if(e.enabled&&(i.isDefine||o.push(e),!e.error))if(!e.inited&&a)r(u)?(t=!0,c=!0):(s.push(u),n(u));else if(!e.inited&&e.fetched&&i.isDefine&&(c=!0,!i.prefix))return l=!1}),a&&s.length)return e=makeError("timeout","Load timeout for modules: "+s,null,s),e.contextName=S.contextName,u(e);l&&each(o,function(e){f(e,{},{})}),a&&!t||!c||!isBrowser&&!isWebWorker||x||(x=setTimeout(function(){x=0,g()},50)),E=!1}}function m(e){hasProp(L,e[0])||o(s(e[0],null,!0)).init(e[1],e[2])}function p(e,t,i,n){e.detachEvent&&!isOpera?n&&e.detachEvent(n,t):e.removeEventListener(i,t,!1)}function v(e){var t=e.currentTarget||e.srcElement;return p(t,S.onScriptLoad,"load","onreadystatechange"),p(t,S.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function h(){var e;for(l();M.length;){if(e=M.shift(),null===e[0])return u(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));m(e)}S.defQueueMap={}}var E,b,S,I,x,y={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},w={},T={},D={},M=[],L={},A={},R={},O=1,$=1;return I={require:function(e){return e.require?e.require:e.require=S.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?L[e.map.id]=e.exports:e.exports=L[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(y.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},b=function(e){this.events=getOwn(D,e.id)||{},this.map=e,this.shim=getOwn(y.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},b.prototype={init:function(e,t,i,n){n=n||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,S.startTime=(new Date).getTime();var e=this.map;return this.shim?void S.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;A[e]||(A[e]=!0,S.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,n=this.depExports,r=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(a)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{r=S.execCb(i,a,n,r)}catch(t){e=t}else r=S.execCb(i,a,n,r);if(this.map.isDefine&&void 0===r&&(t=this.module,t?r=t.exports:this.usingExports&&(r=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",u(this.error=e)}else r=a;if(this.exports=r,this.map.isDefine&&!this.ignore&&(L[i]=r,req.onResourceLoad)){var s=[];each(this.depMaps,function(e){s.push(e.normalizedMap||e)}),req.onResourceLoad(S,this.map,s)}d(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(S.defQueueMap,i)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,n=s(e.prefix);this.depMaps.push(n),c(n,"defined",bind(this,function(n){var r,a,l,f=getOwn(R,this.map.id),g=this.map.name,m=this.map.parentMap?this.map.parentMap.name:null,p=S.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(n.normalize&&(g=n.normalize(g,function(e){return i(e,m,!0)})||""),a=s(e.prefix+"!"+g,this.map.parentMap,!0),c(a,"defined",bind(this,function(e){this.map.normalizedMap=a,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),l=getOwn(w,a.id),void(l&&(this.depMaps.push(a),this.events.error&&l.on("error",bind(this,function(e){this.emit("error",e)})),l.enable()))):f?(this.map.url=S.nameToUrl(f),void this.load()):(r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),r.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(w,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&d(e.map.id)}),u(e)}),r.fromText=bind(this,function(i,n){var a=e.name,c=s(a),l=useInteractive;n&&(i=n),l&&(useInteractive=!1),o(c),hasProp(y.config,t)&&(y.config[a]=y.config[t]);try{req.exec(i)}catch(e){return u(makeError("fromtexteval","fromText eval for "+t+" failed: "+e,e,[t]))}l&&(useInteractive=!0),this.depMaps.push(c),S.completeLoad(a),p([a],r)}),void n.load(e.name,p,r,y))})),S.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){T[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,n,r;if("string"==typeof e){if(e=s(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,r=getOwn(I,e.id))return void(this.depExports[t]=r(this));this.depCount+=1,c(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?c(e,"error",bind(this,this.errback)):this.events.error&&c(e,"error",bind(this,function(e){this.emit("error",e)}))}i=e.id,n=w[i],hasProp(I,i)||!n||n.enabled||S.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(w,e.id);t&&!t.enabled&&S.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},S={config:y,contextName:e,registry:w,defined:L,urlFetched:A,defQueue:M,defQueueMap:{},Module:b,makeModuleMap:s,nextTick:req.nextTick,onError:u,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,i){return(i.indexOf("?")===-1?"?":"&")+t}}var i=y.shim,n={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){n[t]?(y[t]||(y[t]={}),mixin(y[t],e,!0,!0)):y[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(R[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=S.makeShimExports(e)),i[t]=e}),y.shim=i),e.packages&&each(e.packages,function(e){var t,i;e="string"==typeof e?{name:e}:e,i=e.name,t=e.location,t&&(y.paths[i]=e.location),y.pkgs[i]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(w,function(e,t){e.inited||e.map.unnormalized||(e.map=s(t,null,!0))}),(e.deps||e.callback)&&S.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,r){function a(i,n,c){var l,d,f;return r.enableBuildCallback&&n&&isFunction(n)&&(n.__requireJsBuild=!0),"string"==typeof i?isFunction(n)?u(makeError("requireargs","Invalid require call"),c):t&&hasProp(I,i)?I[i](w[t.id]):req.get?req.get(S,i,t,a):(d=s(i,t,!1,!0),l=d.id,hasProp(L,l)?L[l]:u(makeError("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(h(),S.nextTick(function(){h(),f=o(s(null,t)),f.skipMap=r.skipMap,f.init(i,n,c,{enabled:!0}),g()}),a)}return r=r||{},mixin(a,{isBrowser:isBrowser,toUrl:function(e){var n,r=e.lastIndexOf("."),a=e.split("/")[0],s="."===a||".."===a;return r!==-1&&(!s||r>1)&&(n=e.substring(r,e.length),e=e.substring(0,r)),S.nameToUrl(i(e,t&&t.id,!0),n,!0)},defined:function(e){return hasProp(L,s(e,t,!1,!0).id)},specified:function(e){return e=s(e,t,!1,!0).id,hasProp(L,e)||hasProp(w,e)}}),t||(a.undef=function(e){l();var i=s(e,t,!0),r=getOwn(w,e);r.undefed=!0,n(e),delete L[e],delete A[i.url],delete D[e],eachReverse(M,function(t,i){t[0]===e&&M.splice(i,1)}),delete S.defQueueMap[e],r&&(r.events.defined&&(D[e]=r.events),d(e))}),a},enable:function(e){var t=getOwn(w,e.id);t&&o(e).enable()},completeLoad:function(e){var t,i,n,a=getOwn(y.shim,e)||{},s=a.exports;for(l();M.length;){if(i=M.shift(),null===i[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);m(i)}if(S.defQueueMap={},n=getOwn(w,e),!t&&!hasProp(L,e)&&n&&!n.inited){if(!(!y.enforceDefine||s&&getGlobal(s)))return r(e)?void 0:u(makeError("nodefine","No define call for "+e,null,[e]));m([e,a.deps||[],a.exportsFn])}g()},nameToUrl:function(e,t,i){var n,r,a,s,o,c,u,l=getOwn(y.pkgs,e);if(l&&(e=l),u=getOwn(R,e))return S.nameToUrl(u,t,i);if(req.jsExtRegExp.test(e))o=e+(t||"");else{for(n=y.paths,r=e.split("/"),a=r.length;a>0;a-=1)if(s=r.slice(0,a).join("/"),c=getOwn(n,s)){isArray(c)&&(c=c[0]),r.splice(0,a,c);break}o=r.join("/"),o+=t||(/^data\:|^blob\:|\?/.test(o)||i?"":".js"),o=("/"===o.charAt(0)||o.match(/^[\w\+\.\-]+:/)?"":y.baseUrl)+o}return y.urlArgs&&!/^blob\:/.test(o)?o+y.urlArgs(e,o):o},load:function(e,t){req.load(S,e,t)},execCb:function(e,t,i,n){return t.apply(n,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=v(e);S.completeLoad(t.id)}},onScriptError:function(e){var t=v(e);if(!r(t.id)){var i=[];return eachProp(w,function(e,n){0!==n.indexOf("_@r")&&each(e.depMaps,function(e){if(e.id===t.id)return i.push(n),!0})}),u(makeError("scripterror",'Script error for "'+t.id+(i.length?'", needed by: '+i.join(", "):'"'),e,[t.id]))}}},S.require=S.makeRequire(),S}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.3",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,n){var r,a,s=defContextName;return isArray(e)||"string"==typeof e||(a=e,isArray(t)?(e=t,t=i,i=n):e=[]),a&&a.context&&(s=a.context),r=getOwn(contexts,s),r||(r=contexts[s]=req.s.newContext(s)),a&&r.configure(a),r.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var n=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return n.type=e.scriptType||"text/javascript",n.charset="utf-8",n.async=!0,n},req.load=function(e,t,i){var n,r=e&&e.config||{};if(isBrowser)return n=req.createNode(r,t,i),n.setAttribute("data-requirecontext",e.contextName),n.setAttribute("data-requiremodule",t),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",e.onScriptLoad,!1),n.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",e.onScriptLoad)),n.src=i,r.onNodeCreated&&r.onNodeCreated(n,r,t,i),currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{setTimeout(function(){},0),importScripts(i),e.completeLoad(t)}catch(n){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,n,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||mainScript.indexOf("!")!==-1||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,i){var n,r;"string"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=null),!t&&isFunction(i)&&(t=[],i.length&&(i.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,i){t.push(i)}),t=(1===i.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(n=currentlyAddingScript||getInteractiveScript(),n&&(e||(e=n.getAttribute("data-requiremodule")),r=contexts[n.getAttribute("data-requirecontext")])),r?(r.defQueue.push([e,t,i]),r.defQueueMap[e]=!0):globalDefQueue.push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this,"undefined"==typeof setTimeout?void 0:setTimeout),define("requirejs",function(){}),define("ImageServiceAttributesFactory",[],function(){return function(e){var t=this,i=e.attribute,n=e.events,r=e.model;t.create=function(e){return new r(Object.assign({config:{events:n},model:{attribute:i}},e))}}}),define("ImageServiceImageModelFactory",[],function(){return function(e){var t=this,i=e.presetters||[],n=e.host,r=e.config.events;t.statuses={DELETED:"deleted",NEW:"new",CLEAN:"clean",DIRTY:"dirty",EXCLUDE:"exclude"};var a={id:null,service:e.defaults.service,status:t.statuses.NEW,attributes:{},tags:[],options:[],info:{height:null,width:null,size:null,format:null,source:null,created:null}};t.init=function(){n.on(r.PRESETTERREGISTER,function(e,t){i.push(t)})},t.create=function(e){e=e||{};var t=Object.assign({},a);return i.forEach(function(e){e.apply(t)}),Object.assign(t,e)},t.init()}}),define("ImageServiceListItemFactory",[],function(){return function(e){var t=this,i=e.model,n=e.events,r=e.actions,a=e.preview,s=e.attributes,o=e.dataModel,c=e.definitions.attributes,u=e.service;t.create=function(e){return new i(Object.assign({config:{events:n},factory:{dataModel:o,attributes:s},model:{actions:r,preview:a},definitions:c,service:u},e))}}}),define("ImageServiceConnector",[],function(){return function(e){var t=this,i=e.factory.errors;return t.defaults=e.defaults||{},t.serviceName=e.serviceName,t.baseUrl=e.baseUrl,t.imageSave=function(e){var n=e.items,r=e.files,a=e.callback,s=e.warning,o=e.error,c=e.async||!0,u=new FormData,l="";if(r instanceof Object)for(var d in r){if("new"==n[d].status&&!r[d])return o("nofile"),void console.error("[ImageServiceConnector::imageSave] One of the new items does not have a valid file attached");"new"==n[d].status&&(l=t.slugify(r[d].name),n[d].id=l,u.append(l,r[d],r[d].name))}return u.append("items",JSON.stringify(n)),$.ajax({type:"POST",url:t.baseUrl+"/imageprocess",data:u,dataType:"json",contentType:!1,processData:!1,async:c,success:function(e){return e.success===!0&&e.messages&&e.messages.length&&s(e.messages),e.success===!1&&e.messages&&e.messages.length?o(i.create(e.messages[0].code)):e.success===!0&&"function"==typeof a?a(e.items):void 0},error:function(e,t,i){return o(i)}})},t.getImageUrl=function(e){var i={};return i.promise=new Promise(function(e,t){i.resolve=e,i.reject=t}),t.defaults.hasOwnProperty("urls")&&t.defaults.urls.hasOwnProperty(e)?i.resolve(t.defaults.urls[e]):$.ajax({url:t.baseUrl+"/imageurl",data:{imageid:e,width:null,height:null,service:t.serviceName},success:function(e){i.resolve(e.url)}}),i.promise},t.imageFind=function(e){var i={};i.promise=new Promise(function(e,t){i.resolve=e,i.reject=t});var n=Object.assign({service:t.serviceName},e);return $.ajax({url:t.baseUrl+"/imagesearch",data:n,success:function(e){i.resolve(e)},error:function(e){i.reject(e)}}),i.promise},t.slugify=function(e){return e.replace(/[^a-z0-9\_\-]+/gim,"")},t}}),define("ImageServiceUploader",[],function(){return function(e){var t=this,i=e.config.events,n=e.factory.model,r=e.config.labels,a=e.host,s=null,o=null,c=e.maxFileSize||null,u=e.allowedExtensions||["jpg","jpeg","png","gif"];t.init=function(){var e=t.render();a.append(e)},t.validateFile=function(e){return!e||(c&&e.size>c?(s.trigger(i.MESSAGEERROR,"File size too big "+e.size+" File: "+e.name),!1):!(u.indexOf(e.type.replace("image/",""))<0)||(s.trigger(i.MESSAGEERROR,"File type not known "+e.type+" File: "+e.name),!1))},t.processFile=function(e){if(t.validateFile(e)){var r=e.name,s=n.create({id:r,info:{source:null,height:null,width:null,size:e.size,format:e.type}});a.trigger(i.ITEMADDED,{item:s,file:e})}},t.addFieldListener=function(e){e.on("change",function(){for(var e=o[0].files.length,i=0;i<e;i++)t.processFile(o[0].files[i]);$(this).val(null)})},t.addUploadField=function(){o=$('<input name="files[]" type="file" multiple/>'),t.addFieldListener(o),s.append(o)},t.render=function(){return s=$('<span class="btn btn-primary fileinput-button"><i class="fa fa-plus"></i><span> '+r.button.itemUpload+" </span></span>"),t.addUploadField(),$('<div class="imageservice-uploader col-xs-12 col-md-2"></div>').append(s)},this.init()}}),define("ImageServiceSettings",["require"],function(e){return function(e){var t=this,i=e.host,n=[],r=null,a=e.data||{},s=e.config.events,o=e.config.labels;this.init=function(){var e=$('<div class="col-sm-1 col-xs-12 imageservice-settings-trigger"><button class="btn btn-secondary"><i class="fa fa-cogs" aria-hidden="true"></i></button></div>');r=$('<div class="col-xs-12 imageservice-settings" ><h4>'+o.title+"</h4></div>"),e.on("click",function(e){e.preventDefault(),e.stopPropagation(),$(r).animate({height:"toggle"})}),i.append(e),i.append(r.hide()),i.on(s.SETTINGREGISTER,function(e,i){i.setValues(a[i.getIdentifier()]||{}),t.addComponent(i)})},this.addComponent=function(e){var t=$('<div class="imageservice-settings-component"></div>').append(e.render());n.push(e),r.append(t)},this.getData=function(){return n.forEach(function(e){a[e.getIdentifier()]=e.getValues()}),a},this.init()}}),define("ImageServiceFinder",["require"],function(e){return function(e){var t=this,i=e.config.events,n=e.config.labels;return t.host=e.host,t.dataService=e.service,t.container=null,t.select=null,t.containerClass=e.containerClass,t.rowTemplate=function(e){if(e.hasOwnProperty("id")){var t=$('<div class="imageservice-finder-result col-xs-12"></div>'),i=$('<div class="col-xs-3 preview" style="background-image: url('+e.info.source+');"></div>'),n=$('<ul class="col-xs-9" ></ul>');for(var r in e.attributes)n.append($("<li><span>"+e.attributes[r]+"</span></li>"));return t.append(i),t.append(n),t}return e.text},t.repoTemplate=function(e){if(e.hasOwnProperty("text"))return e.text},t.addEventListeners=function(){t.select.select2().on("select2:select",function(e){e.params.data&&t.host.trigger(i.ITEMADDED,{item:jQuery.extend({},e.params.data)})})},t.initScelect2=function(){t.select.select2({width:"100%",placeholder:n.fields.itemFind,allowClear:!0,ajax:{delay:120,data:function(e){return{q:e.term.replace(/(^\s+)|(\s+$)/gim,""),page:e.page}},transport:function(e,i,n){return t.dataService.imageFind(e.data).then(i)},processResults:function(e,t){var i=[];t.page=t.page||1;for(var n in e.items)i.push(e.items[n]);return{results:i,pagination:{more:!1}}},cache:!0},minimumInputLength:1,templateResult:t.rowTemplate,templateSelection:t.repoTemplate})},t.initHTML=function(){t.container=$('<div class="imageservice-finder col-xs-12 col-md-9"></div>'),t.select=$("<select></select>"),t.container.append(t.select),t.addEventListeners(),$(t.host).append(t.container)},t.init=function(){t.initHTML(),t.initScelect2()},t.init(),t}}),define("ImageServiceSettingsInterface",[],function(){return function(e){this.Events=e.config.events,this.host=e.host,this.name="ImageServiceSettings",this.attributes=e.factory.attributes.create({definitions:e.attributes,dataService:e.service,values:e.values,prefix:this.name}),this.getIdentifier=function(){return this.name},this.getValues=function(){return this.attributes.getValues()},this.setValues=function(e){this.attributes.setValues(e)},this.render=function(){},this.registerSetting=function(){this.host.trigger(this.Events.SETTINGREGISTER,this)}}}),define("ImageServicePresets",["ImageServiceSettingsInterface"],function(e){return function(t){var i=this;e.call(this,t);var n=t.config.labels;i.container=null,i.name="ImageServicePresets",i.attributes={},i.apply=function(e){if(!e.hasOwnProperty("attributes"))return e;var t=i.attributes.getValues();return e.tags=t.tags,Object.assign(e.attributes,t)},i.render=function(){return i.container&&i.container.remove(),i.container=$('<div class="imageservice-attributes-global"><h5>'+n.title+"</h5><hr/></div>"),i.container.append(i.attributes.render()),i.host.append(i.container),i.container},i.init=function(){i.attributes=t.factory.attributes.create({definitions:t.attributes,dataService:t.service,values:t.values,prefix:i.name}),this.registerSetting(),i.host.trigger(i.Events.PRESETTERREGISTER,i)},i.init()}}),define("ImageServiceMessaging",[],function(){return function(e){var t={};return t.host=e.host,t.messageLife=e.messageLife||15e5,t.container=$('<div class="imageservice-message"></div>'),t.events={error:e.events.error,warning:e.events.warning,info:e.events.info},t.init=function(){t.host.append(t.container),t.host.on(t.events.error,function(e,i){t.error(i)}),t.host.on(t.events.info,function(e,i){t.info(i)}),t.host.on(t.events.warning,function(e,i){t.warning(i)})},t.remove=function(e){$(e).animate({height:0,opacity:0},500,function(){e.remove()})},t.addListeners=function(e){setTimeout(function(){t.remove(e)},t.messageLife),e.on("click",function(){t.remove(e)})},t.error=function(e){var i=$('<div class="alert alert-danger alert-dismissible"><button type="button" class="close" data-dismiss="alert">×</button>'+e+"</div>");t.addListeners(i),t.container.append(i)},t.info=function(e){var i=$('<div class="alert alert-success alert-dismissible"><button type="button" class="close" data-dismiss="alert">×</button>'+e+"</div>");t.addListeners(i),t.container.append(i)},t.warning=function(e){var i=$('<div class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert">×</button>'+e+"</div>");t.addListeners(i),t.container.append(i)},t.init(),t}}),define("ImageServiceList",[],function(){return function(e){var t=this,i=e.config.events,n=e.factory.listItem,r=e.factory.model;return t.dirty=!1,t.host=e.hostElement,t.imageEntities=[],t.container=null,t.maxItems=e.maxItems||null,t.init=function(){t.reset(e.items.items),t.addListeners()},t.reset=function(e){e=e||[],null!=t.container&&t.container.remove(),t.container=$('<div class="imageservice-list"></div>'),$(t.host).append(t.container),t.imageEntities=[];for(var i=0;i<e.length;i++)t.addItem(e[i]);$.fn.sortable&&t.container.sortable({update:t.onListSorted})},t.addListeners=function(){$(t.host).on(i.LISTSAVED,function(e,i){t.dirty=!1,t.reset(i.items)}),$(t.host).on("change",function(){t.dirty=!0}),$(t.host).on(i.ITEMADDED,function(e,i){if(i.hasOwnProperty("item")){var n=t.addItem(i.item,i.file||null);if(!n)return;var r=n.getOffsets();t.container.animate({scrollTop:r.top},500),t.dirty=!0}}),$(t.host).on(i.ITEMDELETED,function(e,i){t.dirty=!0,i.getData().status==r.statuses.EXCLUDE&&t.removeItem(i)}),$(t.host).on(i.ITEMEXCLUDED,function(e,i){t.dirty=!0,t.removeItem(i)})},t.onListSorted=function(e,i){var n=t.container.sortable("toArray"),r=[];t.imageEntities.forEach(function(e){var t=n.indexOf(e.getId());r[t]=e}),t.imageEntities=r,t.dirty=!0},t.getData=function(){var e=[],i=[];return t.imageEntities.forEach(function(t){e.push(t.getData()),i.push(t.getFile()||null)}),{items:e,files:i}},t.removeItem=function(e){var i=t.imageEntities.indexOf(e);i>=0&&t.imageEntities.splice(i,1)},t.addItem=function(e,a){if(e.status==r.statuses.DELETED)return void t.container.trigger(i.MESSAGEWARNING,"Added image has a delete status");if(t.maxItems&&t.getListLength()>=t.maxItems)return void t.container.trigger(i.MESSAGEWARNING,"Maximal number of list items reached.");var s=n.create({item:jQuery.extend({},e),file:a,prefix:t.host.attr("id")+"_"+t.imageEntities.length});return t.imageEntities.push(s),t.container.append(s.render()),s},t.getListLength=function(){var e=$(t.imageEntities).filter(function(e,t){if(t.getData().status!=r.statuses.DELETED)return!0});return e.length},t.init(),t}}),define("ImageServiceConfig",{systemAttributes:{tags:{type:"tag",label:"Tags"}},labels:{ImageServiceFinder:{fields:{itemFind:"Search in the library"}},ImageServiceUploader:{button:{itemUpload:"Upload Image"}},ImageServicePresets:{title:"Defaults"},ImageServiceGlobals:{title:"Globals"},ImageServiceSettings:{title:"Settings"}},events:{LISTSAVED:"imageservice-listsaved",LISTCHANGED:"imageservice-listchanged",LISTREADY:"imageservice-listready",LISTSAVINGSKIPPED:"imageservice-listsavingskipped",ITEMUPLOADED:"imageservice-itemuploaded",ITEMCHANGED:"imageservice-itemchanged",ITEMSAVED:"imageservice-itemsaved",ITEMADDED:"imageservice-itemadded",ITEMDELETED:"imageservice-itemdeleted",ITEMDELETE:"imageservice-itemdelete",ITEMTOGGLE:"imageservice-itemtoggle",ITEMEXCLUDE:"imageservice-itemexclude",ITEMEXCLUDED:"imageservice-itemexcluded",PREVIEWREADY:"imageservice-preview-ready",ATTRIBUTERENDERED:"imageservice-attribute-rendered",MESSAGEERROR:"imageservice-message-error",MESSAGEWARNING:"imageservice-message-warning",MESSAGEINFO:"imageservice-message-info",PRESETTERREGISTER:"imageservice-presetter-register",SETTINGREGISTER:"imageservice-setting-register"}}),define("ImageServiceErrors",[],function(){return function(e){var t=this,i={fileexists:"The file already exists. Please add it via the search field",filesize:"The uploaded file is too big. Please choose a smaller one",nofile:"No file has been fount, for the new image",fileext:"The files extension is unknown",status:"Invalid image status",unknown:"Something went wrong. Try again and if the problem persits call an administrator",fileinvalid:"File is invalid. Either too big or the of an unsuported type",accessdenied:"You are not logged in!"};e instanceof Object&&e.hasOwnProperty("errors")&&(i=Object.assign(i,e.errors)),t.create=function(e){return i.hasOwnProperty(e)?i[e]:i.unknown}}}),define("ImageServiceGlobals",["ImageServiceSettingsInterface"],function(e){return function(t){e.call(this,t);var i=this,n=t.config.labels;i.container=null,i.name="ImageServiceGlobals",this.render=function(){return i.container&&i.container.remove(),i.container=$('<div class="imageservice-attributes-global"><h5>'+n.title+"</h5><hr/></div>"),i.container.append(i.attributes.render()),i.host.append(i.container),i.container},i.init=function(){i.attributes.prefix=i.getIdentifier(),i.registerSetting()},i.init()}}),define("ImageServiceListItem",[],function(){return function(e){var t=this,i=e.config.events,n=e.model.actions,r=e.model.preview,a=e.factory.attributes,s=e.factory.dataModel,o=!1,c=s.create(e.item),u=e.file||null,l=e.definitions,d=e.service,f=null,g="",m=null,p=null,v=null;t.init=function(){g=e.prefix+"_"+c.id.replace(/[^a-z0-9\_\-]+/gi,"_");var o=jQuery.extend({},c.attributes,{tags:c.tags});t.presetImage(),f=$('<div id="'+g+'" class="col-xs-12 col-sm-12 col-md-12 imageservice-entity"></div>'),v=new n({config:{events:i}}),m=new r({item:c,config:{events:i},factory:{dataModel:s}}),p=a.create({prefix:g,values:o,definitions:e.definitions,dataService:d
}),t.addListeners(),u&&t.loadTheFile()},t.getId=function(){return g},t.getData=function(){var e=p.getValues();c.tags=e.tags;for(var t in l)c.attributes[t]=e[t];return c},t.getFile=function(){return u},t.getOffsets=function(){return{left:f[0].offsetLeft,top:f[0].offsetTop}},t.addListeners=function(){f.on("change",function(e){t.onImageUpdate(e)}),f.on(i.ITEMDELETE,function(){t.onItemDelete(!0)}),$(window).on(i.ITEMDELETED,function(e,i){t.onItemDeleted(i)}),f.on(i.ITEMEXCLUDE,function(){t.onItemDelete(!1)}),$(window).on(i.ITEMEXCLUDED,function(e,i){t.onItemExcluded(i)})},t.presetImage=function(){c.info.source||c.status!=s.statuses.CLEAN||(c.info.source=d.getImageUrl(c.id,c.service)),c.attributes instanceof Array&&(c.attributes={})},t.onImageUpdate=function(e){o=!0,c.status!=s.statuses.NEW&&(c.status=s.statuses.DIRTY)},t.onItemDelete=function(e){if(o=!0,e&&c.status!=s.statuses.NEW){c.status=s.statuses.DELETED;var n=i.ITEMDELETED}else var n=i.ITEMEXCLUDED;t.hide(function(){f.trigger(n,t)})},t.onItemDeleted=function(e){o=!0,e.getData().id==c.id&&(c.status!=s.statuses.DELETED&&(c.status=s.statuses.EXCLUDE,f.trigger(i.ITEMEXCLUDED,t)),t.hide())},t.onItemExcluded=function(e){},t.hide=function(e){$(f).animate({height:0,opacity:0},300,function(){$(f).hide(),"function"==typeof e&&e()})},t.loadTheFile=function(){var e=new FileReader;e.addEventListener("load",function(){var t=window.URL||window.webkitURL||!1;c.info.source=t?t.createObjectURL(u):e.result,m.update(c),f.trigger(i.PREVIEWREADY,c)}),e.readAsDataURL(u)},t.render=function(){return f.append(m.render()),f.append(p.render()),f.append(v.render()),f},t.init()}}),define("ImageServiceEntityAction",[],function(){return function(e){var t=this,i=e.config.events;e.item;t.renderDelete=function(){var e=$('<button class="btn delete btn-danger"><i class="fa fa-trash"></i></button>');return e.on("click",function(n){n.stopPropagation(),n.preventDefault(),confirm("Are you sure you want to delete this item from the service?")&&e.trigger(i.ITEMDELETE,t.item)}),e},t.renderExclude=function(){var e=$('<button class="btn btn-warning remove"><i class="fa fa-minus"></i></button>');return e.on("click",function(n){n.stopPropagation(),n.preventDefault(),confirm("Are you sure you want to exclude this item from the list?")&&e.trigger(i.ITEMEXCLUDE,t.item)}),e},t.render=function(){var e=$('<div class="col-xs-12 col-sm-1 col-md-1 imageservice-entity-actions"></div>');return e.append(t.renderDelete()),e.append(t.renderExclude()),e}}}),define("ImageServicePreview",[],function(){return function(e){var t=this,i=e.item,n=null,r=null,a=e.config.events,s=e.factory.dataModel;return t.init=function(){r=$('<div class="col-xs-12 col-sm-3 col-md-3 imageservice-preview"></div>'),n=$("<img/>"),t.update(i),n.on("click",function(){$(this).trigger(a.ITEMTOGGLE)}),r.append(n)},t.update=function(e){i=e,i.info.source instanceof Promise&&i.status!=s.statuses.NEW?i.info.source.then(function(e){n.attr("src",e),i.info.source=e}):i.info.source instanceof Promise||n.attr("src",i.info.source)},t.render=function(){return r},t.init(),t}}),define("ImageServiceAttribute",[],function(){return function(e){var t=this,i=e.config.events;return t.prefix=e.prefix||"",t.definition=e.definition,t.name=e.name,t.value=e.value,t.container=null,t.dataService=e.dataService,t.trigger=function(e,i){t.container.trigger(e,i)},t.getValue=function(){return t.value},t.setValue=function(e){t.value=e,t.render()},t.generateLabel=function(){return t.definition.label||t.name},t.generateFieldName=function(){return t.prefix+"_"+t.name},t.render=function(){return t.hasOwnProperty(t.definition.type)&&(t.container=t[t.definition.type](t.value,t.definition)),t.container},t.tag=function(e){var n=t.generateFieldName(),r=t.generateLabel(),a=$('<li class="row"></li>'),s=$('<label class="col-xs-12 col-sm-3 col-md-3" for="'+n+'">'+r+"</label>"),o=$('<div class="col-xs-12 col-sm-9 col-md-9" ></div>'),c=$('<select name="'+n+'" multiple ></select>');return(e||[]).forEach(function(e){c.append($('<option value="'+e+'" selected>'+e+"</option>"))}),a.on(i.ATTRIBUTERENDERED,function(e){c.select2({tags:!0,tokenSeparators:[","," "],ajax:{url:t.dataService.baseUrl+"/tagsearch",dataType:"json",delay:100,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){t.page=t.page||1;for(var i=[],n=0;n<e.items.length;n++)i.push({id:e.items[n],text:e.items[n]});return{results:i,pagination:{more:!0}}},cache:!1}})}),c.on("change",function(){t.value=$(this).val()}),a.append(s),o.append(c),a.append(o),a},t.select=function(i){var n=t.generateFieldName(),r=t.generateLabel(),a=e.definition.options||[],s=$('<li class="row"><label class="col-xs-12 col-sm-3 col-md-3" for="'+n+'">'+r+'</label><div class="col-xs-12 col-sm-9 col-md-9 field-container" ></div></li>'),o=$('<select name="'+n+'"></select>');for(x in a){var c=$('<option value="'+x+'">'+e.definition.options[x]+"</option>");x==i&&c.attr("selected","selected"),o.append(c)}return s.find(".field-container").append(o),s.on("change",function(e){t.value=$(e.target).val()}),s},t.checkbox=function(e){var i=t.generateFieldName(),n=t.generateLabel(),r=t.definition.value||"",a=$('<li class="row"><label class="col-xs-12 col-sm-3 col-md-3" for="'+i+'">'+n+'</label><div class="col-xs-12 col-sm-9 col-md-9" ><input type="checkbox" name="'+i+'" value="'+r+'"></div></li>');return a.on("click",function(e){t.value=e.target.checked?r:""}),e==r&&a.find("input").attr("checked","checked").prop("checked",!0),a},t.text=function(e){var i=t.generateFieldName(),n=t.generateLabel(),r=$('<li class="row"><label class="col-xs-12 col-sm-3 col-md-3" for="'+i+'">'+n+'</label><div class="col-xs-12 col-sm-9 col-md-9" ><input type="text" name="'+i+'" value="'+e+'"></div></li>');return r.on("change",function(e){t.value=$(e.target).val()}),r},t.textarea=function(e){var i=t.generateFieldName(),n=t.generateLabel(),r=$('<li class="row"><label class="col-xs-12 col-sm-3 col-md-3" for="'+i+'">'+n+'</label><div class="col-xs-12 col-sm-9 col-md-9"><textarea name="'+i+'" >'+e+"</textarea></div></li>");return r.on("change",function(e){t.value=$(e.target).val()}),r},t}}),define("ImageServiceAttributes",[],function(){return function(e){var t=this,i=e.model.attribute,n=e.config.events;t.values=e.values||[],t.prefix=e.prefix||"",t.definitions=e.definitions,t.attributes=[],t.dataService=e.dataService,t.container=null,t.getValues=function(){return t.values},t.setValues=function(e){t.attributes.forEach(function(t){t.setValue(e[t.name]||t.value)})},t.init=function(){for(var e in t.definitions){var r=t.definitions[e];t.attributes.push(new i({prefix:t.prefix,value:t.values[e]||"",definition:r,name:e,dataService:t.dataService,config:{events:n}}))}},t.getValues=function(){return t.attributes.forEach(function(e){t.values[e.name]=e.getValue()}),t.values},t.render=function(e,i){return t.container=$('<ul class="col-xs-12 col-sm-8 col-md-8 imageservice-attributes"></ul>'),t.attributes.forEach(function(e,i){t.container.append(e.render()),e.trigger(n.ATTRIBUTERENDERED,e)}),t.container},t.init()}}),define("ImageServiceSirTrevor",[],function(){return function(e){var t=this,i=e.extensionUrl,n=e.model.imageService,r={imageServiceInstance:null,type:"imageservice",title:function(){return"Image"},icon_name:"default",toolbarEnabled:!0,textable:!0,editorHTML:'<div class="frontend-target"></div><textarea type="text" class="data-target">{"items":[]}</textarea>',loadData:function(e){e=e||{items:[]},$(this.$(".data-target")).html(JSON.stringify(e))},save:function(){if(this.imageServiceInstance){var e=this.imageServiceInstance.list.getData(),t=this.imageServiceInstance.settings.getData();this.setData({items:e.items,settings:t})}},onBlockRender:function(){$(this.$(".frontend-target")).attr("id","ImageService"+String((new Date).valueOf()));var e=SirTrevor.getInstance(this.instanceID).options.options.Imageservice||{},t={dataElement:this.$(".data-target"),hostElement:this.$(".frontend-target"),serviceUrl:i+"/image",serviceName:e.service},r=new n(Object.assign(e,t));this.imageServiceInstance=r}};return t.init=function(e){"object"==typeof SirTrevor&&(SirTrevor.Blocks.Imageservice=SirTrevor.Block.extend(r))},t}}),require.config({paths:{ImageServiceSettingsInterface:"interfaces/ImageServiceSettingsInterface",ImageServiceAttributesFactory:"factories/ImageServiceAttributes",ImageServiceImageModelFactory:"factories/ImageServiceImageModel",ImageServiceListItemFactory:"factories/ImageServiceListItem",ImageServiceErrors:"factories/ImageServiceErrors",ImageServiceConnector:"components/ImageServiceConnector",ImageServiceUploader:"components/ImageServiceUploader",ImageServiceSettings:"components/ImageServiceSettings",ImageServiceFinder:"components/ImageServiceFinder",ImageServicePresets:"components/ImageServicePresets",ImageServiceMessaging:"components/ImageServiceMessaging",ImageServiceList:"components/ImageServiceList",ImageServiceConfig:"components/ImageServiceConfig",ImageServiceGlobals:"components/ImageServiceGlobals",ImageServiceListItem:"components/ImageServiceListItem",ImageServiceEntityAction:"components/ImageServiceEntityActions",ImageServicePreview:"components/ImageServicePreview",ImageServiceAttribute:"components/ImageServiceAttribute",ImageServiceAttributes:"components/ImageServiceAttributes",ImageServiceSirTrevor:"extension/sir-trevor/extension"}});var CnImageService={},baseUrl=document.currentScript.getAttribute("data-extension-url");require(["ImageServiceAttributesFactory","ImageServiceImageModelFactory","ImageServiceListItemFactory","ImageServiceConnector","ImageServiceUploader","ImageServiceSettings","ImageServiceFinder","ImageServicePresets","ImageServiceMessaging","ImageServiceList","ImageServiceConfig","ImageServiceErrors","ImageServiceGlobals","ImageServiceListItem","ImageServiceEntityAction","ImageServicePreview","ImageServiceAttribute","ImageServiceAttributes","ImageServiceSirTrevor"],function(e,t,i,n,r,a,s,o,c,u,l,d,f,g,m,p,v,h,E){CnImageService=function(E){var b=this;b.store=$(E.dataElement),b.storeJson=JSON.parse(b.store.val()),b.host=$(E.hostElement),b.errors=new d(E.errors),b.config=l,b.service=new n({defaults:E.cache,baseUrl:E.serviceUrl,serviceName:E.serviceName,factory:{errors:b.errors}}),b.init=function(){b.host.addClass("imageservice-container"),b.store.hide(),$(document).trigger(l.events.LISTREADY,{instance:b})},b.modelFactory=new t({host:b.host,config:b.config,defaults:{service:E.serviceName}}),b.attributesFactory=new e({attribute:v,events:b.config.events,model:h}),b.listItemFactory=new i({model:g,events:b.config.events,actions:m,preview:p,attributes:b.attributesFactory,dataModel:b.modelFactory,config:b.config,service:b.service,definitions:{attributes:Object.assign({},E.attributes,b.config.systemAttributes)}}),b.uploader=new r({host:b.host,maxFileSize:E.maxFileSize,service:b.service,config:{events:b.config.events,labels:b.config.labels.ImageServiceUploader},factory:{model:b.modelFactory}}),b.finder=new s({host:b.host,service:b.service,config:{events:b.config.events,labels:b.config.labels.ImageServiceFinder}}),b.settings=new a({host:b.host,config:{events:b.config.events,labels:b.config.labels.ImageServiceSettings},data:b.storeJson.settings}),Object.keys(E.globals||{}).length&&(b.globals=new f({host:b.host,parentContainer:null,attributes:E.globals,service:b.service,prefix:"globals",config:{events:b.config.events,labels:b.config.labels.ImageServiceGlobals},values:{},factory:{attributes:b.attributesFactory}})),Object.keys(E.attributes||{}).length&&(b.presets=new o({host:b.host,parentContainer:null,attributes:jQuery.extend({},E.attributes,b.config.systemAttributes),service:b.service,prefix:"presets",config:{events:b.config.events,labels:b.config.labels.ImageServicePresets},values:{},factory:{attributes:b.attributesFactory}})),b.messaging=new c({host:b.host,events:{error:b.config.events.MESSAGEERROR,warning:b.config.events.MESSAGEWARNING,info:b.config.events.MESSAGEINFO}}),b.list=new u({hostElement:b.host,items:JSON.parse(b.store.val()),maxItems:E.maxFiles||null,config:{events:b.config.events},factory:{listItem:b.listItemFactory,model:b.modelFactory}}),b.save=function(e){if(b.list.dirty){e=e||new Event(b.config.events.LISTSAVED),e.preventDefault(),e.stopImmediatePropagation();var t=b.list.getData();b.service.imageSave({async:!1,items:t.items,files:t.files,callback:function(e){var t={items:e,settings:b.settings.getData()};$(b.store).val(JSON.stringify(t)),$(b.host).trigger(b.config.events.LISTSAVED,t)},warning:function(e){e.forEach(function(e){console.warn(e),b.host.trigger(b.config.events.MESSAGEWARNING,b.errors.create(e.code)+" - "+e.id)})},error:function(e){console.error(e),b.host.trigger(b.config.events.MESSAGEERROR,e)}})}else $(b.host).trigger(b.config.events.LISTSAVINGSKIPPED,b.store)},b.init()};var b=new E({extensionUrl:baseUrl,model:{imageService:CnImageService}});$(document).on("SirTrevor.DynamicBlock.All",function(){$(document).trigger("SirTrevor.DynamicBlock.Add",[b])}),$(document).trigger("SirTrevor.DynamicBlock.Add",[b])}),define("cnImageService",function(){});var CnImageServiceBolt={};require(["ImageServiceConfig"],function(e){CnImageServiceBolt=new function(){var t=this,i=[],n=0,r=null;$(document).on(e.events.LISTSAVED+" "+e.events.LISTSAVINGSKIPPED,function(e,t){0==--n&&$(r.target).data("parentButton").trigger(r.type,{imageserviceskip:!0})}),$(document).on(e.events.LISTREADY,function(e,t){i.push(t.instance)}),$(document).ready(function(){$("#sidebarsavecontinuebutton, #savecontinuebutton").each(function(e){var i=$($(this).prop("outerHTML"));i.data("parentButton",$(this)),i.attr("id",i.attr("id")+"-imageservice"),i.insertBefore($(this)),i.on("click",function(e){e.stopPropagation(),e.preventDefault(),t.save(e)}),$(this).hide()})}),t.save=function(e,t){r=e,n=i.length,i.forEach(function(e){e.save()})}}}),define("CnImageServiceBolt",function(){});